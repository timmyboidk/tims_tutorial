[
  {
    "name": "README.md",
    "type": "file",
    "path": "README.md",
    "language": "markdown",
    "content": "# 短视频 SaaS 学习看板 (Short Video SaaS Dashboard)\n\n欢迎来到 **短视频 SaaS 学习看板** 项目！本项目是一个全栈工程化教学平台，采用真实的企业级业务场景（类似于 TikTok / 抖音 的后台管理与数据大盘），带你从零到一掌握现代化的大前端架构与高并发后端微服务体系。\n\n## 核心技术栈\n- **前端架构**：React 19, TypeScript, Tailwind CSS v4, Next.js (SSR / RSC), Web Workers.\n- **后端架构**：Spring Boot 3, MyBatis, Redis 缓存, Kafka 消息队列.\n- **工程化与部署**：Vite 工具链, Docker 多阶段构建, Docker Compose 容器编排, Kubernetes (K8s) 基础.\n\n---\n\n## 快速启动指引：一键运行全栈应用\n\n为了让你能在任何电脑上（Windows, Mac, Linux）无痛体验和学习整个平台，我们提供了 Docker 容器化的一键启动方案。\n\n### 前置要求\n你只需要在电脑上安装好：\n1. **[Docker Desktop](https://www.docker.com/products/docker-desktop/)** (推荐最新版)\n\n### 运行步骤\n1. **克隆/下载本仓库**到你的本地电脑。\n2. 打开终端（Terminal / PowerShell），进入**项目的根目录**。\n3. 执行一键召唤命令（这会在后台自动拉取环境并编译整个应用）：\n   ```bash\n   docker compose up -d --build\n   ```\n4. **验证启动状态：**\n   执行 `docker compose ps` 确保所有容器状态为 `running`。如果某个容器 `Exit 1`，请执行 `docker compose logs [服务名]` 查看报错。\n5. **在浏览器中打开：** [http://localhost:5173](http://localhost:5173) 即可进入沉浸式学习看板！\n\n### 连不上 http://localhost:5173 怎么办？ (Troubleshooting)\n如果你在浏览器中看到“拒绝连接”，请尝试以下排查：\n\n1. **检查本地端口冲突**：\n   可能你本地已经启动了 `npm run dev` 占用了 5173 端口。\n   - 执行 `lsof -i :5173` (Mac/Linux) 或 `netstat -ano | findstr :5173` (Windows) 检查。\n   - 如果有冲突，请先关掉本地开发进程，或在 `docker-compose.yml` 中修改映射端口（例如 `\"5174:80\"`）。\n\n2. **尝试使用 127.0.0.1**：\n   有些系统的浏览器对 `localhost` 解析有差异，请尝试访问：[http://127.0.0.1:5173](http://127.0.0.1:5173)。\n\n3. **容器未完全启动**：\n   初次启动需要下载大量镜像。请查看日志确认 Express 服务已就绪：\n   ```bash\n   docker compose logs -f frontend\n   ```\n   看到 `Server is running statically on http://0.0.0.0:80` 即表示启动成功。\n\n### 如何停止服务？\n当你学习完毕，想要释放电脑内存时：\n```bash\ndocker compose down\n```\n\n---\n\n## 本地开发指南 (如果不使用 Docker)\n\n如果你想亲自修改跑在本地的代码（开发模式），你可以分别启动前端和后端：\n\n### 1. 启动前端学习看板\n前端由 Vite 强力驱动，提供极速的 HMR（热更新）体验。\n```bash\ncd frontend\nnpm install\nnpm run dev\n```\n访问 `http://localhost:5173`。\n\n### 2. 启动后端 API (需要 Java 环境)\n*注意：本平台大部分的互动功能（如点赞、登录、拉取数据流）都依赖于后端。如果没有启动后端，前端将使用部分模拟数据。*\n```bash\ncd backend\n# 对于 Mac/Linux:\n./gradlew bootRun\n# 对于 Windows:\n.\\gradlew.bat bootRun\n```\n*备注：后端本地裸奔依赖于你本机是否安装了 MySQL, Redis 和 Kafka。强烈建议后端基础设施使用 Docker Compose 启动。*\n\n---\n\n## 课程模块大纲\n\n本平台包含两条核心学习主线，你可以通过页面左侧的星际路线图进行自由探索：\n\n### 方向一：超大规模前端架构\n- **基础架构与鉴权**：Vite 代理解决 CORS，基于 JWT 的登录状态机编写。\n- **主线程性能优化**：`React.memo` 阻止瀑布渲染，使用 Intersection Observer 实现无限瀑布流，利用 Web Workers 进行十万级数据的离线排序。\n- **服务端渲染 (SSR)**：掌握 Next.js 的 Server Components 与 Islands Architecture（岛屿架构），解决 SaaS 平台的 SEO 与首屏性能痛点。\n\n### 方向二：弹性企业后端与 DevOps\n- **高并发与中间件**：Spring Boot 整合 MyBatis 查库，利用 Redis 保护数据库免受读流量冲击，利用 Kafka 为点赞系统实现“削峰填谷”。\n- **分布式事务与弹性**：掌握微服务 Saga 模式解决跨库事务（VIP 订阅扣款问题），引入 Circuit Breaker（熔断器）防范微服务雪崩效应。\n- **容器化与运维编排**：编写极致压缩的 Dockerfile，配置 `docker-compose.yml` 组建内网通信，了解 Kubernetes (K8s) 的横向扩缩容理念。\n"
  },
  {
    "name": "add_comments_zh.js",
    "type": "file",
    "path": "add_comments_zh.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst backendDir = path.join(__dirname, 'backend/src/main/java/com/tutorial');\n\nconst replacements = [\n    {\n        file: 'CodeForgeApplication.java',\n        targets: [\n            {\n                search: `/**\n * Spring Boot entry point for the CodeForge backend.\n * Enables async processing for Kafka event handling.\n */`,\n                replace: `/**\n * CodeForge 后端项目的 Spring Boot 启动入口类。\n * 启用了 @EnableAsync 异步支持，常用于 Kafka 事件和高并发任务的背线消费。\n */`\n            }\n        ]\n    },\n    {\n        file: 'service/AuthService.java',\n        targets: [\n            {\n                search: `/**\n * Authentication service handling user registration and login.\n * Passwords are hashed with BCrypt; successful login returns a JWT token.\n */`,\n                replace: `/**\n * 核心认证服务层 (Service)，专门用于处理用户的注册和登录业务逻辑。\n * 安全规范：绝不明文存储密码，这里使用 Spring Security 的 BCrypt 算法进行不可逆哈希加密；\n * 状态管理：抛弃传统的 Session 方案，登录成功后直接向客户端签发无状态的 JWT 令牌。\n */`\n            },\n            {\n                search: `// Check for existing username`,\n                replace: `// 【第一步】防御性校验：检查数据库中是否已存在被注册的用户名（保持数据唯一性）`\n            },\n            {\n                search: `// Check for existing email`,\n                replace: `// 【第二步】校验防重：确保该邮箱尚未与系统内的其它账号绑定`\n            }\n        ]\n    },\n    {\n        file: 'config/JwtFilter.java',\n        targets: [\n            {\n                search: `/**\n * JWT filter that intercepts incoming requests, extracts the Bearer token\n * from the Authorization header, validates it, and sets the SecurityContext.\n */`,\n                replace: `/**\n * JWT 全局请求过滤器（继承自 OncePerRequestFilter 确保每次请求只执行一次）。\n * 作用机理：\n * 1. 它会拦截所有前端发来的请求，并读取 \\`Authorization\\` 请求头。\n * 2. 剥离 \\`Bearer \\` 前缀提取出真正的 JWT 令牌。\n * 3. 校验其数字签名，一旦合法，就利用提权后的上下文为其在本次请求放行并生成 \\`SecurityContext\\`。\n */`\n            },\n            {\n                search: `// Invalid token — skip authentication, let SecurityConfig handle 401`,\n                replace: `// 若捕获到令牌失效或篡改伪造（Invalid/Expired），不再主动报错，\n                // 而是将此次身份置空，放开闸门让下游的 SecurityConfig 默认的 401 未授权机制去处理。`\n            }\n        ]\n    },\n    {\n        file: 'service/StockService.java',\n        targets: [\n            {\n                search: `/**\n * Stock management service with Redis caching layer.\n * Caches individual stock lookups for 5 minutes to reduce DB load.\n */`,\n                replace: `/**\n * 具有高性能 Redis 缓存保护层的商品/库存服务 (Stock Management)。\n * 核心优势：对于 C 端的频繁查询请求，将会把数据缓存至 Redis 内存中（TTL 为 5 分钟），\n * 藉此抵挡大流量直击底层 MySQL 数据库，也就是常说的“读写分离及缓存抗压”。\n */`\n            },\n            {\n                search: `// Invalidate cache on update`,\n                replace: `// 【双写一致性保障】发生更新事件时，必须主动销毁 Redis 中残留的旧缓存 (Invalidate)，强制下次查询走数据库`\n            },\n            {\n                search: `// Invalidate cache on delete`,\n                replace: `// 【缓存双删/淘汰】物理删除记录后，连同缓存池中的残留一并抹除`\n            }\n        ]\n    },\n    {\n        file: 'consumer/PaymentConsumer.java',\n        targets: [\n            {\n                search: `/**\n * Kafka consumer that processes payment events asynchronously.\n * Simulates a payment gateway processing delay, then updates\n * the payment status in both MySQL and Redis.\n */`,\n                replace: `/**\n * 基于 Kafka 的异步消息消费者（事件驱动模型核心组件）。\n * 用途：用于承接由其它微服务投递过来的高耗时【支付计算】事件。\n * 它模拟了第三方支付网关的延迟，经过异步等待和算力消耗后，将支付的最终状态\n * 录入回传至核心业务数据库 MySQL 以及热缓存 Redis 之中。\n */`\n            },\n            {\n                search: `/**\n     * Listens for payment events on the \"payment-events\" Kafka topic.\n     * Simulates async processing and updates the payment status.\n     */`,\n                replace: `/**\n     * @KafkaListener 注解：使当前方法成为指定 Topic（\"payment-events\"）的监听通道。\n     * 当生产者在该队列中挂载了哪怕一条支付指令，本消费者就会被立即唤醒并吸取该消息进行计算。\n     */`\n            },\n            {\n                search: `// Simulate payment gateway processing delay (1-3 seconds)`,\n                replace: `// 这里手动阻塞线程，模拟真实世界中调用支付宝或微信支付接口所必须等待的公网通讯延迟 (1~3 秒)`\n            },\n            {\n                search: `// Simulate success (90% chance) vs failure (10% chance)`,\n                replace: `// 高级工程化模拟：引入 10% 的失败几率以体现真实网络环境下的支付掉单、余额不足或网络波动异常`\n            },\n            {\n                search: `// Update status in database`,\n                replace: `// [持久化落盘] 将敲定的最终支付状态 UPDATE 回 MySQL 物理表`\n            },\n            {\n                search: `// Update status in Redis cache`,\n                replace: `// [缓存回写] 将这个凭证放入 Redis 并设置半小时过期，方便前端频繁发起轮询接口查单时瞬间返回（抗压高并发）`\n            }\n        ]\n    }\n];\n\nreplacements.forEach(({ file, targets }) => {\n    const filePath = path.join(backendDir, file);\n    if (fs.existsSync(filePath)) {\n        let content = fs.readFileSync(filePath, 'utf8');\n        targets.forEach(t => {\n            content = content.replace(t.search, t.replace);\n        });\n        fs.writeFileSync(filePath, content, 'utf8');\n        console.log(`Updated comments in ${file}`);\n    }\n});\n"
  },
  {
    "name": "backend",
    "type": "directory",
    "path": "backend",
    "children": [
      {
        "name": "bin",
        "type": "directory",
        "path": "backend/bin",
        "children": [
          {
            "name": "main",
            "type": "directory",
            "path": "backend/bin/main",
            "children": [
              {
                "name": "application.yml",
                "type": "file",
                "path": "backend/bin/main/application.yml",
                "language": "yaml",
                "content": "# ─────────────────────────────────────────────────\n# CodeForge Backend Configuration\n# ─────────────────────────────────────────────────\n\nserver:\n  port: 8080\n\nspring:\n  application:\n    name: codeforge-backend\n\n  # ── MySQL / DataSource ──\n  datasource:\n    url: jdbc:mysql://localhost:3306/codeforge?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC\n    username: root\n    password: root\n    driver-class-name: com.mysql.cj.jdbc.Driver\n\n  # ── Redis ──\n  data:\n    redis:\n      host: localhost\n      port: 6379\n      timeout: 5000ms\n\n  # ── Kafka ──\n  kafka:\n    bootstrap-servers: localhost:9092\n    consumer:\n      group-id: codeforge-group\n      auto-offset-reset: earliest\n      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n    producer:\n      key-serializer: org.apache.kafka.common.serialization.StringSerializer\n      value-serializer: org.apache.kafka.common.serialization.StringSerializer\n\n# ── MyBatis ──\nmybatis:\n  mapper-locations: classpath:mapper/*.xml\n  type-aliases-package: com.tutorial.model\n  configuration:\n    map-underscore-to-camel-case: true\n\n# ── JWT ──\njwt:\n  secret: Y29kZWZvcmdlLXNlY3JldC1rZXktMjAyNC1wcm9kdWN0aW9uLXJlYWR5\n  expiration: 86400000  # 24 hours in milliseconds\n\n# ── Logging ──\nlogging:\n  level:\n    com.tutorial: DEBUG\n    org.springframework.security: INFO\n    org.mybatis: DEBUG\n"
              },
              {
                "name": "mapper",
                "type": "directory",
                "path": "backend/bin/main/mapper",
                "children": [
                  {
                    "name": "PaymentMapper.xml",
                    "type": "file",
                    "path": "backend/bin/main/mapper/PaymentMapper.xml",
                    "language": "xml",
                    "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.tutorial.mapper.PaymentMapper\">\n\n    <resultMap id=\"PaymentResultMap\" type=\"com.tutorial.model.Payment\">\n        <id property=\"id\" column=\"id\"/>\n        <result property=\"paymentId\" column=\"payment_id\"/>\n        <result property=\"userId\" column=\"user_id\"/>\n        <result property=\"amount\" column=\"amount\"/>\n        <result property=\"currency\" column=\"currency\"/>\n        <result property=\"status\" column=\"status\"/>\n        <result property=\"description\" column=\"description\"/>\n        <result property=\"createdAt\" column=\"created_at\"/>\n        <result property=\"updatedAt\" column=\"updated_at\"/>\n    </resultMap>\n\n    <select id=\"findById\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE id = #{id}\n    </select>\n\n    <select id=\"findByPaymentId\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE payment_id = #{paymentId}\n    </select>\n\n    <select id=\"findByUserId\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE user_id = #{userId} ORDER BY created_at DESC\n    </select>\n\n    <select id=\"findByStatus\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE status = #{status}\n    </select>\n\n    <insert id=\"insert\" parameterType=\"com.tutorial.model.Payment\" useGeneratedKeys=\"true\" keyProperty=\"id\">\n        INSERT INTO payments (payment_id, user_id, amount, currency, status, description)\n        VALUES (#{paymentId}, #{userId}, #{amount}, #{currency}, #{status}, #{description})\n    </insert>\n\n    <update id=\"updateStatus\">\n        UPDATE payments SET status = #{status} WHERE payment_id = #{paymentId}\n    </update>\n\n</mapper>\n"
                  },
                  {
                    "name": "StockMapper.xml",
                    "type": "file",
                    "path": "backend/bin/main/mapper/StockMapper.xml",
                    "language": "xml",
                    "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.tutorial.mapper.StockMapper\">\n\n    <resultMap id=\"StockResultMap\" type=\"com.tutorial.model.Stock\">\n        <id property=\"id\" column=\"id\"/>\n        <result property=\"symbol\" column=\"symbol\"/>\n        <result property=\"name\" column=\"name\"/>\n        <result property=\"price\" column=\"price\"/>\n        <result property=\"quantity\" column=\"quantity\"/>\n        <result property=\"category\" column=\"category\"/>\n        <result property=\"createdAt\" column=\"created_at\"/>\n        <result property=\"updatedAt\" column=\"updated_at\"/>\n    </resultMap>\n\n    <select id=\"findAll\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks ORDER BY symbol\n    </select>\n\n    <select id=\"findById\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks WHERE id = #{id}\n    </select>\n\n    <select id=\"findBySymbol\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks WHERE symbol = #{symbol}\n    </select>\n\n    <select id=\"findByCategory\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks WHERE category = #{category} ORDER BY symbol\n    </select>\n\n    <insert id=\"insert\" parameterType=\"com.tutorial.model.Stock\" useGeneratedKeys=\"true\" keyProperty=\"id\">\n        INSERT INTO stocks (symbol, name, price, quantity, category)\n        VALUES (#{symbol}, #{name}, #{price}, #{quantity}, #{category})\n    </insert>\n\n    <update id=\"update\" parameterType=\"com.tutorial.model.Stock\">\n        UPDATE stocks\n        SET symbol = #{symbol}, name = #{name}, price = #{price},\n            quantity = #{quantity}, category = #{category}\n        WHERE id = #{id}\n    </update>\n\n    <delete id=\"deleteById\">\n        DELETE FROM stocks WHERE id = #{id}\n    </delete>\n\n</mapper>\n"
                  },
                  {
                    "name": "UserMapper.xml",
                    "type": "file",
                    "path": "backend/bin/main/mapper/UserMapper.xml",
                    "language": "xml",
                    "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.tutorial.mapper.UserMapper\">\n\n    <resultMap id=\"UserResultMap\" type=\"com.tutorial.model.User\">\n        <id property=\"id\" column=\"id\"/>\n        <result property=\"username\" column=\"username\"/>\n        <result property=\"email\" column=\"email\"/>\n        <result property=\"password\" column=\"password\"/>\n        <result property=\"role\" column=\"role\"/>\n        <result property=\"createdAt\" column=\"created_at\"/>\n        <result property=\"updatedAt\" column=\"updated_at\"/>\n    </resultMap>\n\n    <select id=\"findById\" resultMap=\"UserResultMap\">\n        SELECT * FROM users WHERE id = #{id}\n    </select>\n\n    <select id=\"findByUsername\" resultMap=\"UserResultMap\">\n        SELECT * FROM users WHERE username = #{username}\n    </select>\n\n    <select id=\"findByEmail\" resultMap=\"UserResultMap\">\n        SELECT * FROM users WHERE email = #{email}\n    </select>\n\n    <insert id=\"insert\" parameterType=\"com.tutorial.model.User\" useGeneratedKeys=\"true\" keyProperty=\"id\">\n        INSERT INTO users (username, email, password, role)\n        VALUES (#{username}, #{email}, #{password}, #{role})\n    </insert>\n\n    <update id=\"update\" parameterType=\"com.tutorial.model.User\">\n        UPDATE users\n        SET username = #{username}, email = #{email}, password = #{password}, role = #{role}\n        WHERE id = #{id}\n    </update>\n\n    <delete id=\"deleteById\">\n        DELETE FROM users WHERE id = #{id}\n    </delete>\n\n</mapper>\n"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "name": "pom.xml",
        "type": "file",
        "path": "backend/pom.xml",
        "language": "xml",
        "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.3.4</version>\n        <relativePath/>\n    </parent>\n\n    <groupId>com.tutorial</groupId>\n    <artifactId>codeforge-backend</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>CodeForge Backend</name>\n    <description>Spring Boot 后端：MyBatis + Redis + Kafka 集成</description>\n\n    <properties>\n        <java.version>17</java.version>\n        <jjwt.version>0.12.6</jjwt.version>\n    </properties>\n\n    <dependencies>\n        <!-- Spring Boot Starters -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-security</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-validation</artifactId>\n        </dependency>\n\n        <!-- Kafka -->\n        <dependency>\n            <groupId>org.springframework.kafka</groupId>\n            <artifactId>spring-kafka</artifactId>\n        </dependency>\n\n        <!-- MyBatis -->\n        <dependency>\n            <groupId>org.mybatis.spring.boot</groupId>\n            <artifactId>mybatis-spring-boot-starter</artifactId>\n            <version>3.0.3</version>\n        </dependency>\n\n        <!-- JWT (jjwt) -->\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt-api</artifactId>\n            <version>${jjwt.version}</version>\n        </dependency>\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt-impl</artifactId>\n            <version>${jjwt.version}</version>\n            <scope>runtime</scope>\n        </dependency>\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt-jackson</artifactId>\n            <version>${jjwt.version}</version>\n            <scope>runtime</scope>\n        </dependency>\n\n        <!-- Database -->\n        <dependency>\n            <groupId>com.mysql</groupId>\n            <artifactId>mysql-connector-j</artifactId>\n            <scope>runtime</scope>\n        </dependency>\n\n        <!-- Lombok -->\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        <!-- Jackson JSON -->\n        <dependency>\n            <groupId>com.fasterxml.jackson.core</groupId>\n            <artifactId>jackson-databind</artifactId>\n        </dependency>\n\n        <!-- Test -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.security</groupId>\n            <artifactId>spring-security-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <excludes>\n                        <exclude>\n                            <groupId>org.projectlombok</groupId>\n                            <artifactId>lombok</artifactId>\n                        </exclude>\n                    </excludes>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n"
      },
      {
        "name": "src",
        "type": "directory",
        "path": "backend/src",
        "children": [
          {
            "name": "main",
            "type": "directory",
            "path": "backend/src/main",
            "children": [
              {
                "name": "java",
                "type": "directory",
                "path": "backend/src/main/java",
                "children": [
                  {
                    "name": "com",
                    "type": "directory",
                    "path": "backend/src/main/java/com",
                    "children": [
                      {
                        "name": "tutorial",
                        "type": "directory",
                        "path": "backend/src/main/java/com/tutorial",
                        "children": [
                          {
                            "name": "CodeForgeApplication.java",
                            "type": "file",
                            "path": "backend/src/main/java/com/tutorial/CodeForgeApplication.java",
                            "language": "java",
                            "content": "package com.tutorial;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.scheduling.annotation.EnableAsync;\n\n/**\n * CodeForge 后端项目的 Spring Boot 启动入口类。\n * 启用了 @EnableAsync 异步支持，常用于 Kafka 事件和高并发任务的背线消费。\n */\n@SpringBootApplication\n@EnableAsync\npublic class CodeForgeApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(CodeForgeApplication.class, args);\n    }\n}\n"
                          },
                          {
                            "name": "config",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/config",
                            "children": [
                              {
                                "name": "JwtFilter.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/config/JwtFilter.java",
                                "language": "java",
                                "content": "package com.tutorial.config;\n\nimport com.tutorial.util.JwtUtil;\nimport jakarta.servlet.FilterChain;\nimport jakarta.servlet.ServletException;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.filter.OncePerRequestFilter;\n\nimport java.io.IOException;\nimport java.util.Collections;\n\n/**\n * JWT 全局请求过滤器（继承自 OncePerRequestFilter 确保每次请求只执行一次）。\n * 作用机理：\n * 1. 它会拦截所有前端发来的请求，并读取 `Authorization` 请求头。\n * 2. 剥离 `Bearer ` 前缀提取出真正的 JWT 令牌。\n * 3. 校验其数字签名，一旦合法，就利用提权后的上下文为其在本次请求放行并生成 `SecurityContext`。\n */\n@Component\npublic class JwtFilter extends OncePerRequestFilter {\n\n    private final JwtUtil jwtUtil;\n\n    public JwtFilter(JwtUtil jwtUtil) {\n        this.jwtUtil = jwtUtil;\n    }\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request,\n            HttpServletResponse response,\n            FilterChain filterChain) throws ServletException, IOException {\n\n        String authHeader = request.getHeader(\"Authorization\");\n\n        if (authHeader != null && authHeader.startsWith(\"Bearer \")) {\n            String token = authHeader.substring(7);\n\n            try {\n                String username = jwtUtil.extractUsername(token);\n\n                if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {\n                    if (jwtUtil.validateToken(token, username)) {\n                        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(\n                                username,\n                                null,\n                                Collections.singletonList(new SimpleGrantedAuthority(\"ROLE_USER\")));\n                        SecurityContextHolder.getContext().setAuthentication(authentication);\n                    }\n                }\n            } catch (Exception e) {\n                // 若捕获到令牌失效或篡改伪造（Invalid/Expired），不再主动报错，\n                // 而是将此次身份置空，放开闸门让下游的 SecurityConfig 默认的 401 未授权机制去处理。\n                logger.debug(\"Invalid JWT token: \" + e.getMessage());\n            }\n        }\n\n        filterChain.doFilter(request, response);\n    }\n}\n"
                              },
                              {
                                "name": "KafkaConfig.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/config/KafkaConfig.java",
                                "language": "java",
                                "content": "package com.tutorial.config;\n\nimport org.apache.kafka.clients.admin.NewTopic;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.kafka.config.TopicBuilder;\n\n/**\n * Kafka configuration: creates required topics on startup.\n * Producer and consumer factories are auto-configured by Spring Boot\n * via application.yml properties.\n */\n@Configuration\npublic class KafkaConfig {\n\n    public static final String PAYMENT_TOPIC = \"payment-events\";\n    public static final String STOCK_TOPIC = \"stock-events\";\n\n    @Bean\n    public NewTopic paymentTopic() {\n        return TopicBuilder.name(PAYMENT_TOPIC)\n                .partitions(3)\n                .replicas(1)\n                .build();\n    }\n\n    @Bean\n    public NewTopic stockTopic() {\n        return TopicBuilder.name(STOCK_TOPIC)\n                .partitions(3)\n                .replicas(1)\n                .build();\n    }\n}\n"
                              },
                              {
                                "name": "RedisConfig.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/config/RedisConfig.java",
                                "language": "java",
                                "content": "package com.tutorial.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n/**\n * Redis configuration providing a RedisTemplate with JSON value serialization.\n * Keys are stored as strings, values as Jackson-serialized JSON.\n */\n@Configuration\npublic class RedisConfig {\n\n    @Bean\n    public RedisTemplate<String, String> redisTemplate(RedisConnectionFactory connectionFactory) {\n        RedisTemplate<String, String> template = new RedisTemplate<>();\n        template.setConnectionFactory(connectionFactory);\n\n        // Key serialization\n        template.setKeySerializer(new StringRedisSerializer());\n        template.setHashKeySerializer(new StringRedisSerializer());\n\n        // Value serialization (JSON)\n        template.setValueSerializer(new StringRedisSerializer());\n        template.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());\n\n        template.afterPropertiesSet();\n        return template;\n    }\n}\n"
                              },
                              {
                                "name": "SecurityConfig.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/config/SecurityConfig.java",
                                "language": "java",
                                "content": "package com.tutorial.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;\nimport java.util.List;\n\n/**\n * Spring Security configuration:\n * - Stateless session (JWT-based)\n * - CORS enabled for frontend dev server\n * - Public endpoints for auth, protected for everything else\n */\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n    private final JwtFilter jwtFilter;\n\n    public SecurityConfig(JwtFilter jwtFilter) {\n        this.jwtFilter = jwtFilter;\n    }\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        return http\n                .csrf(AbstractHttpConfigurer::disable)\n                .cors(cors -> cors.configurationSource(corsConfigurationSource()))\n                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\n                .authorizeHttpRequests(auth -> auth\n                        .requestMatchers(\"/api/auth/**\").permitAll()\n                        .requestMatchers(\"/api/lessons/**\").permitAll()\n                        .anyRequest().authenticated())\n                .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)\n                .build();\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    @Bean\n    public CorsConfigurationSource corsConfigurationSource() {\n        CorsConfiguration configuration = new CorsConfiguration();\n        configuration.setAllowedOrigins(List.of(\"http://localhost:5173\", \"http://localhost:3000\"));\n        configuration.setAllowedMethods(Arrays.asList(\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"));\n        configuration.setAllowedHeaders(List.of(\"*\"));\n        configuration.setAllowCredentials(true);\n        configuration.setMaxAge(3600L);\n\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        source.registerCorsConfiguration(\"/**\", configuration);\n        return source;\n    }\n}\n"
                              }
                            ]
                          },
                          {
                            "name": "consumer",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/consumer",
                            "children": [
                              {
                                "name": "PaymentConsumer.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/consumer/PaymentConsumer.java",
                                "language": "java",
                                "content": "package com.tutorial.consumer;\n\nimport com.tutorial.mapper.PaymentMapper;\nimport com.tutorial.model.Payment;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.stereotype.Component;\n\nimport java.time.Duration;\n\n/**\n * 基于 Kafka 的异步消息消费者（事件驱动模型核心组件）。\n * 用途：用于承接由其它微服务投递过来的高耗时【支付计算】事件。\n * 它模拟了第三方支付网关的延迟，经过异步等待和算力消耗后，将支付的最终状态\n * 录入回传至核心业务数据库 MySQL 以及热缓存 Redis 之中。\n */\n@Component\npublic class PaymentConsumer {\n\n    private static final Logger log = LoggerFactory.getLogger(PaymentConsumer.class);\n\n    private final PaymentMapper paymentMapper;\n    private final RedisTemplate<String, String> redisTemplate;\n\n    public PaymentConsumer(PaymentMapper paymentMapper, RedisTemplate<String, String> redisTemplate) {\n        this.paymentMapper = paymentMapper;\n        this.redisTemplate = redisTemplate;\n    }\n\n    /**\n     * @KafkaListener 注解：使当前方法成为指定 Topic（\"payment-events\"）的监听通道。\n     * 当生产者在该队列中挂载了哪怕一条支付指令，本消费者就会被立即唤醒并吸取该消息进行计算。\n     */\n    @KafkaListener(topics = \"payment-events\", groupId = \"codeforge-group\")\n    public void consumePaymentEvent(String message) {\n        try {\n            Payment payment = Payment.fromJson(message);\n            String paymentId = payment.getPaymentId();\n\n            log.info(\"Processing payment event: id={}, amount={} {}\",\n                    paymentId, payment.getAmount(), payment.getCurrency());\n\n            // 这里手动阻塞线程，模拟真实世界中调用支付宝或微信支付接口所必须等待的公网通讯延迟 (1~3 秒)\n            Thread.sleep(1000 + (long) (Math.random() * 2000));\n\n            // 高级工程化模拟：引入 10% 的失败几率以体现真实网络环境下的支付掉单、余额不足或网络波动异常\n            String newStatus;\n            if (Math.random() < 0.9) {\n                newStatus = \"COMPLETED\";\n                log.info(\"Payment completed successfully: id={}\", paymentId);\n            } else {\n                newStatus = \"FAILED\";\n                log.warn(\"Payment failed (simulated): id={}\", paymentId);\n            }\n\n            // [持久化落盘] 将敲定的最终支付状态 UPDATE 回 MySQL 物理表\n            paymentMapper.updateStatus(paymentId, newStatus);\n\n            // [缓存回写] 将这个凭证放入 Redis 并设置半小时过期，方便前端频繁发起轮询接口查单时瞬间返回（抗压高并发）\n            redisTemplate.opsForValue().set(\n                    \"payment:\" + paymentId,\n                    newStatus,\n                    Duration.ofMinutes(30));\n\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            log.error(\"Payment processing interrupted\", e);\n        } catch (Exception e) {\n            log.error(\"Error processing payment event: {}\", e.getMessage(), e);\n        }\n    }\n}\n"
                              }
                            ]
                          },
                          {
                            "name": "controller",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/controller",
                            "children": [
                              {
                                "name": "AuthController.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/controller/AuthController.java",
                                "language": "java",
                                "content": "package com.tutorial.controller;\n\nimport com.tutorial.service.AuthService;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n/**\n * Authentication REST controller.\n * Provides public endpoints for user registration and login.\n */\n@RestController\n@RequestMapping(\"/api/auth\")\npublic class AuthController {\n\n    private final AuthService authService;\n\n    public AuthController(AuthService authService) {\n        this.authService = authService;\n    }\n\n    /**\n     * POST /api/auth/register — Register a new user.\n     * Request body: { \"username\": \"...\", \"email\": \"...\", \"password\": \"...\" }\n     */\n    @PostMapping(\"/register\")\n    public ResponseEntity<?> register(@RequestBody Map<String, String> request) {\n        try {\n            String username = request.get(\"username\");\n            String email = request.get(\"email\");\n            String password = request.get(\"password\");\n\n            if (username == null || email == null || password == null) {\n                return ResponseEntity.badRequest()\n                        .body(Map.of(\"error\", \"Missing required fields: username, email, password\"));\n            }\n\n            Map<String, Object> result = authService.register(username, email, password);\n            return ResponseEntity.status(201).body(result);\n\n        } catch (IllegalArgumentException e) {\n            return ResponseEntity.badRequest()\n                    .body(Map.of(\"error\", e.getMessage()));\n        }\n    }\n\n    /**\n     * POST /api/auth/login — Authenticate and get a JWT token.\n     * Request body: { \"username\": \"...\", \"password\": \"...\" }\n     */\n    @PostMapping(\"/login\")\n    public ResponseEntity<?> login(@RequestBody Map<String, String> request) {\n        try {\n            String username = request.get(\"username\");\n            String password = request.get(\"password\");\n\n            if (username == null || password == null) {\n                return ResponseEntity.badRequest()\n                        .body(Map.of(\"error\", \"Missing required fields: username, password\"));\n            }\n\n            Map<String, Object> result = authService.login(username, password);\n            return ResponseEntity.ok(result);\n\n        } catch (IllegalArgumentException e) {\n            return ResponseEntity.status(401)\n                    .body(Map.of(\"error\", e.getMessage()));\n        }\n    }\n}\n"
                              },
                              {
                                "name": "LessonController.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/controller/LessonController.java",
                                "language": "java",
                                "content": "package com.tutorial.controller;\n\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * Lesson API controller.\n * Serves lesson catalog data to the frontend learning platform.\n * This endpoint is public (no auth required).\n */\n@RestController\n@RequestMapping(\"/api/lessons\")\npublic class LessonController {\n\n    /**\n     * GET /api/lessons — Returns the lesson catalog.\n     * In production, this would fetch from a database.\n     * Currently returns a static catalog for the learning platform.\n     */\n    @GetMapping\n    public List<Map<String, Object>> getAllLessons() {\n        return List.of(\n                Map.of(\n                        \"id\", \"react-counter\",\n                        \"type\", \"frontend\",\n                        \"title\", \"Build a React Counter\",\n                        \"category\", \"React Fundamentals\",\n                        \"language\", \"typescript\"),\n                Map.of(\n                        \"id\", \"tailwind-card\",\n                        \"type\", \"frontend\",\n                        \"title\", \"Style a Dashboard Card\",\n                        \"category\", \"Tailwind CSS\",\n                        \"language\", \"typescript\"),\n                Map.of(\n                        \"id\", \"spring-controller\",\n                        \"type\", \"backend\",\n                        \"title\", \"Spring Boot REST Controller\",\n                        \"category\", \"Spring Boot\",\n                        \"language\", \"java\"),\n                Map.of(\n                        \"id\", \"kafka-producer\",\n                        \"type\", \"backend\",\n                        \"title\", \"Kafka Event Producer\",\n                        \"category\", \"Apache Kafka\",\n                        \"language\", \"java\"));\n    }\n}\n"
                              },
                              {
                                "name": "PaymentController.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/controller/PaymentController.java",
                                "language": "java",
                                "content": "package com.tutorial.controller;\n\nimport com.tutorial.model.Payment;\nimport com.tutorial.service.PaymentService;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Map;\n\n/**\n * Payment REST controller.\n * Provides endpoints for processing payments and querying status.\n */\n@RestController\n@RequestMapping(\"/api/payments\")\npublic class PaymentController {\n\n    private final PaymentService paymentService;\n\n    public PaymentController(PaymentService paymentService) {\n        this.paymentService = paymentService;\n    }\n\n    /**\n     * POST /api/payments/process — Submit a payment for processing.\n     * The payment is persisted, cached in Redis, and sent to Kafka\n     * for asynchronous processing by the PaymentConsumer.\n     */\n    @PostMapping(\"/process\")\n    public ResponseEntity<Map<String, Object>> processPayment(@RequestBody Payment payment) {\n        String paymentId = paymentService.processPayment(payment);\n        return ResponseEntity.accepted()\n                .body(Map.of(\n                        \"paymentId\", paymentId,\n                        \"status\", \"PENDING\",\n                        \"message\", \"Payment is being processed asynchronously\"));\n    }\n\n    /**\n     * GET /api/payments/status/{id} — Query the current status of a payment.\n     * Checks Redis cache first for fast lookups, falls back to MySQL.\n     */\n    @GetMapping(\"/status/{id}\")\n    public ResponseEntity<Map<String, String>> getPaymentStatus(@PathVariable(\"id\") String paymentId) {\n        String status = paymentService.getPaymentStatus(paymentId);\n        if (\"NOT_FOUND\".equals(status)) {\n            return ResponseEntity.notFound().build();\n        }\n        return ResponseEntity.ok(Map.of(\n                \"paymentId\", paymentId,\n                \"status\", status));\n    }\n}\n"
                              },
                              {
                                "name": "StockController.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/controller/StockController.java",
                                "language": "java",
                                "content": "package com.tutorial.controller;\n\nimport com.tutorial.model.Stock;\nimport com.tutorial.service.StockService;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\n\n/**\n * Stock/Inventory REST controller.\n * Full CRUD operations for stock items with Redis-cached reads.\n */\n@RestController\n@RequestMapping(\"/api/stocks\")\npublic class StockController {\n\n    private final StockService stockService;\n\n    public StockController(StockService stockService) {\n        this.stockService = stockService;\n    }\n\n    /**\n     * GET /api/stocks — List all stock items.\n     */\n    @GetMapping\n    public ResponseEntity<List<Stock>> getAllStocks() {\n        List<Stock> stocks = stockService.findAll();\n        return ResponseEntity.ok(stocks);\n    }\n\n    /**\n     * GET /api/stocks/{id} — Get a single stock by ID.\n     */\n    @GetMapping(\"/{id}\")\n    public ResponseEntity<Stock> getStockById(@PathVariable Long id) {\n        Stock stock = stockService.findById(id);\n        if (stock == null) {\n            return ResponseEntity.notFound().build();\n        }\n        return ResponseEntity.ok(stock);\n    }\n\n    /**\n     * GET /api/stocks/symbol/{symbol} — Lookup a stock by ticker symbol.\n     */\n    @GetMapping(\"/symbol/{symbol}\")\n    public ResponseEntity<Stock> getStockBySymbol(@PathVariable String symbol) {\n        Stock stock = stockService.findBySymbol(symbol.toUpperCase());\n        if (stock == null) {\n            return ResponseEntity.notFound().build();\n        }\n        return ResponseEntity.ok(stock);\n    }\n\n    /**\n     * POST /api/stocks — Create a new stock item.\n     */\n    @PostMapping\n    public ResponseEntity<Stock> createStock(@RequestBody Stock stock) {\n        Stock created = stockService.create(stock);\n        return ResponseEntity.status(201).body(created);\n    }\n\n    /**\n     * PUT /api/stocks/{id} — Update an existing stock item.\n     */\n    @PutMapping(\"/{id}\")\n    public ResponseEntity<Stock> updateStock(@PathVariable Long id, @RequestBody Stock stock) {\n        stock.setId(id);\n        Stock updated = stockService.update(stock);\n        return ResponseEntity.ok(updated);\n    }\n\n    /**\n     * DELETE /api/stocks/{id} — Delete a stock item.\n     */\n    @DeleteMapping(\"/{id}\")\n    public ResponseEntity<Void> deleteStock(@PathVariable Long id) {\n        stockService.delete(id);\n        return ResponseEntity.noContent().build();\n    }\n}\n"
                              }
                            ]
                          },
                          {
                            "name": "mapper",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/mapper",
                            "children": [
                              {
                                "name": "PaymentMapper.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/mapper/PaymentMapper.java",
                                "language": "java",
                                "content": "package com.tutorial.mapper;\n\nimport com.tutorial.model.Payment;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Param;\n\nimport java.util.List;\n\n/**\n * MyBatis mapper interface for Payment entity operations.\n */\n@Mapper\npublic interface PaymentMapper {\n\n    Payment findById(@Param(\"id\") Long id);\n\n    Payment findByPaymentId(@Param(\"paymentId\") String paymentId);\n\n    List<Payment> findByUserId(@Param(\"userId\") Long userId);\n\n    List<Payment> findByStatus(@Param(\"status\") String status);\n\n    int insert(Payment payment);\n\n    int updateStatus(@Param(\"paymentId\") String paymentId, @Param(\"status\") String status);\n}\n"
                              },
                              {
                                "name": "StockMapper.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/mapper/StockMapper.java",
                                "language": "java",
                                "content": "package com.tutorial.mapper;\n\nimport com.tutorial.model.Stock;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Param;\n\nimport java.util.List;\n\n/**\n * MyBatis mapper interface for Stock entity CRUD operations.\n */\n@Mapper\npublic interface StockMapper {\n\n    List<Stock> findAll();\n\n    Stock findById(@Param(\"id\") Long id);\n\n    Stock findBySymbol(@Param(\"symbol\") String symbol);\n\n    List<Stock> findByCategory(@Param(\"category\") String category);\n\n    int insert(Stock stock);\n\n    int update(Stock stock);\n\n    int deleteById(@Param(\"id\") Long id);\n}\n"
                              },
                              {
                                "name": "UserMapper.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/mapper/UserMapper.java",
                                "language": "java",
                                "content": "package com.tutorial.mapper;\n\nimport com.tutorial.model.User;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Param;\n\n/**\n * MyBatis mapper interface for User entity CRUD operations.\n * SQL definitions are in resources/mapper/UserMapper.xml.\n */\n@Mapper\npublic interface UserMapper {\n\n    User findById(@Param(\"id\") Long id);\n\n    User findByUsername(@Param(\"username\") String username);\n\n    User findByEmail(@Param(\"email\") String email);\n\n    int insert(User user);\n\n    int update(User user);\n\n    int deleteById(@Param(\"id\") Long id);\n}\n"
                              }
                            ]
                          },
                          {
                            "name": "model",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/model",
                            "children": [
                              {
                                "name": "Payment.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/model/Payment.java",
                                "language": "java",
                                "content": "package com.tutorial.model;\n\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDateTime;\n\n/**\n * Payment entity mapped to the `payments` table.\n * Supports JSON serialization for Kafka message payloads.\n */\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Payment {\n\n    private static final ObjectMapper MAPPER = new ObjectMapper();\n\n    private Long id;\n    private String paymentId;\n    private Long userId;\n    private BigDecimal amount;\n\n    @Builder.Default\n    private String currency = \"USD\";\n\n    @Builder.Default\n    private String status = \"PENDING\";\n\n    private String description;\n    private LocalDateTime createdAt;\n    private LocalDateTime updatedAt;\n\n    /**\n     * Serialize this Payment to a JSON string for Kafka publishing.\n     */\n    public String toJson() {\n        try {\n            return MAPPER.writeValueAsString(this);\n        } catch (JsonProcessingException e) {\n            throw new RuntimeException(\"Failed to serialize Payment to JSON\", e);\n        }\n    }\n\n    /**\n     * Deserialize a JSON string into a Payment object.\n     */\n    public static Payment fromJson(String json) {\n        try {\n            return MAPPER.readValue(json, Payment.class);\n        } catch (JsonProcessingException e) {\n            throw new RuntimeException(\"Failed to deserialize Payment from JSON\", e);\n        }\n    }\n}\n"
                              },
                              {
                                "name": "Stock.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/model/Stock.java",
                                "language": "java",
                                "content": "package com.tutorial.model;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDateTime;\n\n/**\n * Stock entity mapped to the `stocks` table.\n * Represents an inventory item with price and quantity tracking.\n */\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Stock {\n\n    private Long id;\n    private String symbol;\n    private String name;\n    private BigDecimal price;\n    private Integer quantity;\n    private String category;\n    private LocalDateTime createdAt;\n    private LocalDateTime updatedAt;\n}\n"
                              },
                              {
                                "name": "User.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/model/User.java",
                                "language": "java",
                                "content": "package com.tutorial.model;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.time.LocalDateTime;\n\n/**\n * User entity mapped to the `users` table.\n */\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class User {\n\n    private Long id;\n    private String username;\n    private String email;\n    private String password;\n\n    @Builder.Default\n    private String role = \"USER\";\n\n    private LocalDateTime createdAt;\n    private LocalDateTime updatedAt;\n}\n"
                              }
                            ]
                          },
                          {
                            "name": "service",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/service",
                            "children": [
                              {
                                "name": "AuthService.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/service/AuthService.java",
                                "language": "java",
                                "content": "package com.tutorial.service;\n\nimport com.tutorial.mapper.UserMapper;\nimport com.tutorial.model.User;\nimport com.tutorial.util.JwtUtil;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.stereotype.Service;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * 核心认证服务层 (Service)，专门用于处理用户的注册和登录业务逻辑。\n * 安全规范：绝不明文存储密码，这里使用 Spring Security 的 BCrypt 算法进行不可逆哈希加密；\n * 状态管理：抛弃传统的 Session 方案，登录成功后直接向客户端签发无状态的 JWT 令牌。\n */\n@Service\npublic class AuthService {\n\n    private final UserMapper userMapper;\n    private final PasswordEncoder passwordEncoder;\n    private final JwtUtil jwtUtil;\n\n    public AuthService(UserMapper userMapper, PasswordEncoder passwordEncoder, JwtUtil jwtUtil) {\n        this.userMapper = userMapper;\n        this.passwordEncoder = passwordEncoder;\n        this.jwtUtil = jwtUtil;\n    }\n\n    /**\n     * Register a new user. Returns a map with user info and JWT token.\n     *\n     * @throws IllegalArgumentException if username or email already exists\n     */\n    public Map<String, Object> register(String username, String email, String password) {\n        // 【第一步】防御性校验：检查数据库中是否已存在被注册的用户名（保持数据唯一性）\n        if (userMapper.findByUsername(username) != null) {\n            throw new IllegalArgumentException(\"Username already exists\");\n        }\n        // 【第二步】校验防重：确保该邮箱尚未与系统内的其它账号绑定\n        if (userMapper.findByEmail(email) != null) {\n            throw new IllegalArgumentException(\"Email already exists\");\n        }\n\n        User user = User.builder()\n                .username(username)\n                .email(email)\n                .password(passwordEncoder.encode(password))\n                .role(\"USER\")\n                .build();\n\n        userMapper.insert(user);\n\n        String token = jwtUtil.generateToken(username, \"USER\");\n\n        Map<String, Object> result = new HashMap<>();\n        result.put(\"userId\", user.getId());\n        result.put(\"username\", username);\n        result.put(\"email\", email);\n        result.put(\"token\", token);\n        return result;\n    }\n\n    /**\n     * Authenticate a user by username and password. Returns JWT token on success.\n     *\n     * @throws IllegalArgumentException if credentials are invalid\n     */\n    public Map<String, Object> login(String username, String password) {\n        User user = userMapper.findByUsername(username);\n        if (user == null) {\n            throw new IllegalArgumentException(\"Invalid username or password\");\n        }\n\n        if (!passwordEncoder.matches(password, user.getPassword())) {\n            throw new IllegalArgumentException(\"Invalid username or password\");\n        }\n\n        String token = jwtUtil.generateToken(username, user.getRole());\n\n        Map<String, Object> result = new HashMap<>();\n        result.put(\"userId\", user.getId());\n        result.put(\"username\", username);\n        result.put(\"token\", token);\n        return result;\n    }\n}\n"
                              },
                              {
                                "name": "PaymentService.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/service/PaymentService.java",
                                "language": "java",
                                "content": "package com.tutorial.service;\n\nimport com.tutorial.model.Payment;\nimport com.tutorial.mapper.PaymentMapper;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.UUID;\n\n/**\n * Payment processing service.\n * - Persists payment records via MyBatis\n * - Caches status in Redis for fast lookups\n * - Publishes payment events to Kafka for async processing\n */\n@Service\npublic class PaymentService {\n\n    private static final Logger log = LoggerFactory.getLogger(PaymentService.class);\n    private static final String PAYMENT_TOPIC = \"payment-events\";\n\n    private final KafkaTemplate<String, String> kafkaTemplate;\n    private final RedisTemplate<String, String> redisTemplate;\n    private final PaymentMapper paymentMapper;\n\n    public PaymentService(KafkaTemplate<String, String> kafkaTemplate,\n            RedisTemplate<String, String> redisTemplate,\n            PaymentMapper paymentMapper) {\n        this.kafkaTemplate = kafkaTemplate;\n        this.redisTemplate = redisTemplate;\n        this.paymentMapper = paymentMapper;\n    }\n\n    /**\n     * Initiate a payment: persist to DB, cache in Redis, send Kafka event.\n     *\n     * @return the generated payment ID\n     */\n    public String processPayment(Payment payment) {\n        String paymentId = UUID.randomUUID().toString();\n        payment.setPaymentId(paymentId);\n        payment.setStatus(\"PENDING\");\n\n        // Persist to MySQL via MyBatis\n        paymentMapper.insert(payment);\n\n        // Cache the PENDING status in Redis with 30-minute TTL\n        redisTemplate.opsForValue().set(\n                \"payment:\" + paymentId,\n                \"PENDING\",\n                Duration.ofMinutes(30));\n\n        // Publish event to Kafka for async processing\n        kafkaTemplate.send(PAYMENT_TOPIC, paymentId, payment.toJson())\n                .whenComplete((result, ex) -> {\n                    if (ex == null) {\n                        log.info(\"Payment event sent: id={}, topic={}, offset={}\",\n                                paymentId,\n                                result.getRecordMetadata().topic(),\n                                result.getRecordMetadata().offset());\n                    } else {\n                        log.error(\"Failed to send payment event: id={}\", paymentId, ex);\n                        // Update Redis with FAILED status\n                        redisTemplate.opsForValue().set(\n                                \"payment:\" + paymentId,\n                                \"FAILED\",\n                                Duration.ofMinutes(30));\n                    }\n                });\n\n        return paymentId;\n    }\n\n    /**\n     * Get the current status of a payment.\n     * Checks Redis cache first, falls back to database.\n     */\n    public String getPaymentStatus(String paymentId) {\n        // Try Redis cache first for speed\n        String cached = redisTemplate.opsForValue().get(\"payment:\" + paymentId);\n        if (cached != null) {\n            return cached;\n        }\n\n        // Fallback to database\n        Payment payment = paymentMapper.findByPaymentId(paymentId);\n        return payment != null ? payment.getStatus() : \"NOT_FOUND\";\n    }\n}\n"
                              },
                              {
                                "name": "StockService.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/service/StockService.java",
                                "language": "java",
                                "content": "package com.tutorial.service;\n\nimport com.tutorial.mapper.StockMapper;\nimport com.tutorial.model.Stock;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.List;\n\n/**\n * 具有高性能 Redis 缓存保护层的商品/库存服务 (Stock Management)。\n * 核心优势：对于 C 端的频繁查询请求，将会把数据缓存至 Redis 内存中（TTL 为 5 分钟），\n * 藉此抵挡大流量直击底层 MySQL 数据库，也就是常说的“读写分离及缓存抗压”。\n */\n@Service\npublic class StockService {\n\n    private static final Logger log = LoggerFactory.getLogger(StockService.class);\n    private static final String CACHE_PREFIX = \"stock:\";\n    private static final Duration CACHE_TTL = Duration.ofMinutes(5);\n\n    private final StockMapper stockMapper;\n    private final RedisTemplate<String, String> redisTemplate;\n\n    public StockService(StockMapper stockMapper, RedisTemplate<String, String> redisTemplate) {\n        this.stockMapper = stockMapper;\n        this.redisTemplate = redisTemplate;\n    }\n\n    public List<Stock> findAll() {\n        return stockMapper.findAll();\n    }\n\n    public Stock findById(Long id) {\n        return stockMapper.findById(id);\n    }\n\n    public Stock findBySymbol(String symbol) {\n        return stockMapper.findBySymbol(symbol);\n    }\n\n    public Stock create(Stock stock) {\n        stockMapper.insert(stock);\n        log.info(\"Created stock: symbol={}, id={}\", stock.getSymbol(), stock.getId());\n        return stock;\n    }\n\n    public Stock update(Stock stock) {\n        stockMapper.update(stock);\n        // 【双写一致性保障】发生更新事件时，必须主动销毁 Redis 中残留的旧缓存 (Invalidate)，强制下次查询走数据库\n        redisTemplate.delete(CACHE_PREFIX + stock.getId());\n        log.info(\"Updated stock: id={}, symbol={}\", stock.getId(), stock.getSymbol());\n        return stock;\n    }\n\n    public void delete(Long id) {\n        stockMapper.deleteById(id);\n        // 【缓存双删/淘汰】物理删除记录后，连同缓存池中的残留一并抹除\n        redisTemplate.delete(CACHE_PREFIX + id);\n        log.info(\"Deleted stock: id={}\", id);\n    }\n}\n"
                              }
                            ]
                          },
                          {
                            "name": "util",
                            "type": "directory",
                            "path": "backend/src/main/java/com/tutorial/util",
                            "children": [
                              {
                                "name": "JwtUtil.java",
                                "type": "file",
                                "path": "backend/src/main/java/com/tutorial/util/JwtUtil.java",
                                "language": "java",
                                "content": "package com.tutorial.util;\n\nimport io.jsonwebtoken.Claims;\nimport io.jsonwebtoken.JwtException;\nimport io.jsonwebtoken.Jwts;\nimport io.jsonwebtoken.security.Keys;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.SecretKey;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * JWT utility class for token generation and validation.\n * Uses HMAC-SHA256 signing with configurable secret and expiration.\n */\n@Component\npublic class JwtUtil {\n\n    private final SecretKey key;\n    private final long expiration;\n\n    public JwtUtil(@Value(\"${jwt.secret}\") String secret,\n            @Value(\"${jwt.expiration}\") long expiration) {\n        this.key = Keys.hmacShaKeyFor(secret.getBytes(StandardCharsets.UTF_8));\n        this.expiration = expiration;\n    }\n\n    /**\n     * Generate a JWT token for the given username with optional extra claims.\n     */\n    public String generateToken(String username, String role) {\n        Map<String, Object> claims = new HashMap<>();\n        claims.put(\"role\", role);\n\n        return Jwts.builder()\n                .claims(claims)\n                .subject(username)\n                .issuedAt(new Date())\n                .expiration(new Date(System.currentTimeMillis() + expiration))\n                .signWith(key)\n                .compact();\n    }\n\n    /**\n     * Extract the username (subject) from a JWT token.\n     */\n    public String extractUsername(String token) {\n        return extractAllClaims(token).getSubject();\n    }\n\n    /**\n     * Validate a token: checks signature and expiration.\n     */\n    public boolean validateToken(String token, String username) {\n        try {\n            String extractedUsername = extractUsername(token);\n            return extractedUsername.equals(username) && !isTokenExpired(token);\n        } catch (JwtException e) {\n            return false;\n        }\n    }\n\n    /**\n     * Check if the token has expired.\n     */\n    public boolean isTokenExpired(String token) {\n        return extractAllClaims(token).getExpiration().before(new Date());\n    }\n\n    private Claims extractAllClaims(String token) {\n        return Jwts.parser()\n                .verifyWith(key)\n                .build()\n                .parseSignedClaims(token)\n                .getPayload();\n    }\n}\n"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              {
                "name": "resources",
                "type": "directory",
                "path": "backend/src/main/resources",
                "children": [
                  {
                    "name": "application.yml",
                    "type": "file",
                    "path": "backend/src/main/resources/application.yml",
                    "language": "yaml",
                    "content": "# ─────────────────────────────────────────────────\n# CodeForge Backend Configuration\n# ─────────────────────────────────────────────────\n\nserver:\n  port: 8080\n\nspring:\n  application:\n    name: codeforge-backend\n\n  # ── MySQL / DataSource ──\n  datasource:\n    url: jdbc:mysql://localhost:3306/codeforge?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC\n    username: root\n    password: root\n    driver-class-name: com.mysql.cj.jdbc.Driver\n\n  # ── Redis ──\n  data:\n    redis:\n      host: localhost\n      port: 6379\n      timeout: 5000ms\n\n  # ── Kafka ──\n  kafka:\n    bootstrap-servers: localhost:9092\n    consumer:\n      group-id: codeforge-group\n      auto-offset-reset: earliest\n      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n    producer:\n      key-serializer: org.apache.kafka.common.serialization.StringSerializer\n      value-serializer: org.apache.kafka.common.serialization.StringSerializer\n\n# ── MyBatis ──\nmybatis:\n  mapper-locations: classpath:mapper/*.xml\n  type-aliases-package: com.tutorial.model\n  configuration:\n    map-underscore-to-camel-case: true\n\n# ── JWT ──\njwt:\n  secret: Y29kZWZvcmdlLXNlY3JldC1rZXktMjAyNC1wcm9kdWN0aW9uLXJlYWR5\n  expiration: 86400000  # 24 hours in milliseconds\n\n# ── Logging ──\nlogging:\n  level:\n    com.tutorial: DEBUG\n    org.springframework.security: INFO\n    org.mybatis: DEBUG\n"
                  },
                  {
                    "name": "mapper",
                    "type": "directory",
                    "path": "backend/src/main/resources/mapper",
                    "children": [
                      {
                        "name": "PaymentMapper.xml",
                        "type": "file",
                        "path": "backend/src/main/resources/mapper/PaymentMapper.xml",
                        "language": "xml",
                        "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.tutorial.mapper.PaymentMapper\">\n\n    <resultMap id=\"PaymentResultMap\" type=\"com.tutorial.model.Payment\">\n        <id property=\"id\" column=\"id\"/>\n        <result property=\"paymentId\" column=\"payment_id\"/>\n        <result property=\"userId\" column=\"user_id\"/>\n        <result property=\"amount\" column=\"amount\"/>\n        <result property=\"currency\" column=\"currency\"/>\n        <result property=\"status\" column=\"status\"/>\n        <result property=\"description\" column=\"description\"/>\n        <result property=\"createdAt\" column=\"created_at\"/>\n        <result property=\"updatedAt\" column=\"updated_at\"/>\n    </resultMap>\n\n    <select id=\"findById\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE id = #{id}\n    </select>\n\n    <select id=\"findByPaymentId\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE payment_id = #{paymentId}\n    </select>\n\n    <select id=\"findByUserId\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE user_id = #{userId} ORDER BY created_at DESC\n    </select>\n\n    <select id=\"findByStatus\" resultMap=\"PaymentResultMap\">\n        SELECT * FROM payments WHERE status = #{status}\n    </select>\n\n    <insert id=\"insert\" parameterType=\"com.tutorial.model.Payment\" useGeneratedKeys=\"true\" keyProperty=\"id\">\n        INSERT INTO payments (payment_id, user_id, amount, currency, status, description)\n        VALUES (#{paymentId}, #{userId}, #{amount}, #{currency}, #{status}, #{description})\n    </insert>\n\n    <update id=\"updateStatus\">\n        UPDATE payments SET status = #{status} WHERE payment_id = #{paymentId}\n    </update>\n\n</mapper>\n"
                      },
                      {
                        "name": "StockMapper.xml",
                        "type": "file",
                        "path": "backend/src/main/resources/mapper/StockMapper.xml",
                        "language": "xml",
                        "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.tutorial.mapper.StockMapper\">\n\n    <resultMap id=\"StockResultMap\" type=\"com.tutorial.model.Stock\">\n        <id property=\"id\" column=\"id\"/>\n        <result property=\"symbol\" column=\"symbol\"/>\n        <result property=\"name\" column=\"name\"/>\n        <result property=\"price\" column=\"price\"/>\n        <result property=\"quantity\" column=\"quantity\"/>\n        <result property=\"category\" column=\"category\"/>\n        <result property=\"createdAt\" column=\"created_at\"/>\n        <result property=\"updatedAt\" column=\"updated_at\"/>\n    </resultMap>\n\n    <select id=\"findAll\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks ORDER BY symbol\n    </select>\n\n    <select id=\"findById\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks WHERE id = #{id}\n    </select>\n\n    <select id=\"findBySymbol\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks WHERE symbol = #{symbol}\n    </select>\n\n    <select id=\"findByCategory\" resultMap=\"StockResultMap\">\n        SELECT * FROM stocks WHERE category = #{category} ORDER BY symbol\n    </select>\n\n    <insert id=\"insert\" parameterType=\"com.tutorial.model.Stock\" useGeneratedKeys=\"true\" keyProperty=\"id\">\n        INSERT INTO stocks (symbol, name, price, quantity, category)\n        VALUES (#{symbol}, #{name}, #{price}, #{quantity}, #{category})\n    </insert>\n\n    <update id=\"update\" parameterType=\"com.tutorial.model.Stock\">\n        UPDATE stocks\n        SET symbol = #{symbol}, name = #{name}, price = #{price},\n            quantity = #{quantity}, category = #{category}\n        WHERE id = #{id}\n    </update>\n\n    <delete id=\"deleteById\">\n        DELETE FROM stocks WHERE id = #{id}\n    </delete>\n\n</mapper>\n"
                      },
                      {
                        "name": "UserMapper.xml",
                        "type": "file",
                        "path": "backend/src/main/resources/mapper/UserMapper.xml",
                        "language": "xml",
                        "content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.tutorial.mapper.UserMapper\">\n\n    <resultMap id=\"UserResultMap\" type=\"com.tutorial.model.User\">\n        <id property=\"id\" column=\"id\"/>\n        <result property=\"username\" column=\"username\"/>\n        <result property=\"email\" column=\"email\"/>\n        <result property=\"password\" column=\"password\"/>\n        <result property=\"role\" column=\"role\"/>\n        <result property=\"createdAt\" column=\"created_at\"/>\n        <result property=\"updatedAt\" column=\"updated_at\"/>\n    </resultMap>\n\n    <select id=\"findById\" resultMap=\"UserResultMap\">\n        SELECT * FROM users WHERE id = #{id}\n    </select>\n\n    <select id=\"findByUsername\" resultMap=\"UserResultMap\">\n        SELECT * FROM users WHERE username = #{username}\n    </select>\n\n    <select id=\"findByEmail\" resultMap=\"UserResultMap\">\n        SELECT * FROM users WHERE email = #{email}\n    </select>\n\n    <insert id=\"insert\" parameterType=\"com.tutorial.model.User\" useGeneratedKeys=\"true\" keyProperty=\"id\">\n        INSERT INTO users (username, email, password, role)\n        VALUES (#{username}, #{email}, #{password}, #{role})\n    </insert>\n\n    <update id=\"update\" parameterType=\"com.tutorial.model.User\">\n        UPDATE users\n        SET username = #{username}, email = #{email}, password = #{password}, role = #{role}\n        WHERE id = #{id}\n    </update>\n\n    <delete id=\"deleteById\">\n        DELETE FROM users WHERE id = #{id}\n    </delete>\n\n</mapper>\n"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "name": "convert-lessons.js",
    "type": "file",
    "path": "convert-lessons.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst dataDir = path.join(__dirname, 'frontend/src/data');\nconst files = fs.readdirSync(dataDir).filter(f => f.endsWith('.ts') && f !== 'lessons.ts');\n\nfiles.forEach(file => {\n    const filePath = path.join(dataDir, file);\n    let content = fs.readFileSync(filePath, 'utf8');\n\n    // Simple regex replacement: find instructions and targetCode, append targetCode to instructions\n    // We can't do this easily with regex if there are backticks inside the strings.\n    // Instead we will rely on injecting after \"instructions: `...`,\"\n    // Actually, doing this with regex for nested backticks is hard in JS. \n    // Wait, the files export a standard format.\n    // Let's print the files to see if we can just append it manually or write a robust parser.\n});\nconsole.log(files);\n"
  },
  {
    "name": "docker-compose.yml",
    "type": "file",
    "path": "docker-compose.yml",
    "language": "yaml",
    "content": "services:\n  # ==============================\n  # 💡 1. 核心应用层 (Application)\n  # ==============================\n\n  # 1.1 前端：短视频 SaaS React 看板\n  frontend:\n    build: ./frontend\n    ports:\n      - \"5173:80\" # 将主机的 5173 路由到 Nginx/Express 的 80\n    environment:\n      - MONGO_URI=mongodb://mongo:27017/progress_db\n    depends_on:\n      - api\n      - mongo\n    networks:\n      - saas-network\n\n  api:\n    build: ./backend\n    ports:\n      - \"8080:8080\"\n    environment:\n      - SPRING_PROFILES_ACTIVE=prod\n      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/video_saas_db\n      - SPRING_REDIS_HOST=redis\n      - SPRING_KAFKA_BOOTSTRAP_SERVERS=kafka:9092\n    depends_on:\n      mysql:\n        condition: service_healthy\n      redis:\n        condition: service_started\n      kafka:\n        condition: service_started\n    networks:\n      - saas-network\n\n  # ==============================\n  # 💡 2. 数据与中间件层 (Infrastructure)\n  # ==============================\n\n  # 2.1 关系型数据库 MySQL (官方支持 ARM64)\n  mysql:\n    image: mysql:8.0\n    # ports:\n    #  - \"3306:3306\" # 💡 绝不允许对公网暴露 3306 端口，只允许 Docker 内网的服务（如 API）进行访问！\n    environment:\n      - MYSQL_ROOT_PASSWORD=saas_root_pwd\n      - MYSQL_DATABASE=video_saas_db\n      - MYSQL_USER=saas_user\n      - MYSQL_PASSWORD=saas_pwd\n    healthcheck:\n      test: [ \"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\" ]\n      timeout: 20s\n      retries: 5\n    volumes:\n      - mysql-data:/var/lib/mysql\n    networks:\n      - saas-network\n\n  # 2.2 课程进度数据库 MongoDB (官方支持 ARM64)\n  mongo:\n    image: mongo:7.0\n    volumes:\n      - mongo-data:/data/db\n    networks:\n      - saas-network\n\n  # 2.3 内存缓存 Redis (加速字典查询与热门视频)\n  redis:\n    image: redis:alpine\n    command: redis-server --appendonly yes\n    volumes:\n      - redis-data:/data\n    networks:\n      - saas-network\n\n  # 2.4 分布式流处理平台 (使用官方 Apache 版 Zookeeper + Kafka)\n  zookeeper:\n    image: zookeeper:latest\n    networks:\n      - saas-network\n\n  kafka:\n    image: apache/kafka:latest\n    depends_on:\n      - zookeeper\n    environment:\n      - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181\n      - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092\n    networks:\n      - saas-network\n\n# 💡 定义具名持久化卷，保证数据库重启不丢数据\nvolumes:\n  mysql-data:\n  redis-data:\n  mongo-data:\n\n    # 💡 声明整个系统所在的私有网段\nnetworks:\n  saas-network:\n    driver: bridge\n"
  },
  {
    "name": "fix.js",
    "type": "file",
    "path": "fix.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nlet content = fs.readFileSync('frontend/src/data/frontend-m3-m5.ts', 'utf8');\n\nconst regex = /instructions:\\s*(`[\\s\\S]*?`),\\s*targetCode:\\s*(`[\\s\\S]*?`),/g;\n\ncontent = content.replace(regex, (match, p1, p2) => {\n    if (p1.includes('## 📝 完整参考代码')) {\n        return match;\n    }\n\n    let targetCodeContent = p2.substring(1, p2.length - 1);\n    targetCodeContent = targetCodeContent.replace(/\\\\n/g, '\\n');\n\n    // As explained, targetCodeContent is ALREADY ESCAPED correctly for TS template strings!\n    // No need to touch `$`, `\\``, `\\\\` anymore! Just drop it in!\n\n    const newInstructions = p1.substring(0, p1.length - 1) +\n        '\\\\n\\\\n## 📝 完整参考代码\\\\n\\\\`\\\\`\\\\`typescript\\\\n' +\n        targetCodeContent +\n        '\\\\n\\\\`\\\\`\\\\`' + '`';\n\n    return `instructions: ${newInstructions},\\n        targetCode: ${p2},`;\n});\n\nfs.writeFileSync('frontend/src/data/frontend-m3-m5.ts', content, 'utf8');\n"
  },
  {
    "name": "fix_duplicates.js",
    "type": "file",
    "path": "fix_duplicates.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst srcDir = path.join(__dirname, 'frontend/src/data');\n\nconst files = fs.readdirSync(srcDir).filter(f => f.endsWith('.ts') && f !== 'types.ts' && f !== 'lessons.ts');\nfiles.forEach(f => {\n    let content = fs.readFileSync(path.join(srcDir, f), 'utf8');\n    // Replace duplicate illustrationUrl: '...', entries\n    // We only want ONE per block. We can just replace two occurrences of it placed next to each other.\n    // Specifically:\n    //         illustrationUrl: '/illustrations/frontend_architecture.png',\n    //         illustrationUrl: '/illustrations/frontend_architecture.png',\n\n    content = content.replace(/((\\s*)illustrationUrl:\\s*['\"][^'\"]+['\"],\\n)(\\s*illustrationUrl:\\s*['\"][^'\"]+['\"],\\n)+/g, '$1');\n\n    fs.writeFileSync(path.join(srcDir, f), content);\n    console.log('Fixed ', f);\n});\n"
  },
  {
    "name": "frontend",
    "type": "directory",
    "path": "frontend",
    "children": [
      {
        "name": "index.html",
        "type": "file",
        "path": "frontend/index.html",
        "language": "html",
        "content": "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>CodeForge — Interactive Coding Academy</title>\n  <meta name=\"description\"\n    content=\"An interactive coding learning platform with a heuristic ghost-text IDE engine. Master React, Spring Boot, Kafka, and more.\" />\n  <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n  <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin />\n  <link\n    href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap\"\n    rel=\"stylesheet\" />\n</head>\n\n<body>\n  <div id=\"root\"></div>\n  <script type=\"module\" src=\"/src/main.tsx\"></script>\n</body>\n\n</html>"
      },
      {
        "name": "package.json",
        "type": "file",
        "path": "frontend/package.json",
        "language": "json",
        "content": "{\n  \"name\": \"codeforge-frontend\",\n  \"private\": true,\n  \"version\": \"1.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"predev\": \"node ../generate_codebase.js || echo 'Skipping codebase generation'\",\n    \"dev\": \"vite\",\n    \"prebuild\": \"node ../generate_codebase.js || echo 'Skipping codebase generation'\",\n    \"build\": \"tsc && vite build\",\n    \"preview\": \"vite preview\"\n  },\n  \"dependencies\": {\n    \"mermaid\": \"^11.4.1\",\n    \"react\": \"^19.0.0\",\n    \"react-dom\": \"^19.0.0\",\n    \"react-markdown\": \"^9.0.3\",\n    \"react-syntax-highlighter\": \"^16.1.0\",\n    \"remark-gfm\": \"^4.0.0\"\n  },\n  \"devDependencies\": {\n    \"@tailwindcss/vite\": \"^4.0.9\",\n    \"@types/node\": \"^25.3.0\",\n    \"@types/react\": \"^19.0.8\",\n    \"@types/react-dom\": \"^19.0.3\",\n    \"@types/react-syntax-highlighter\": \"^15.5.13\",\n    \"@vitejs/plugin-react\": \"^4.3.4\",\n    \"tailwindcss\": \"^4.0.9\",\n    \"typescript\": \"~5.7.2\",\n    \"vite\": \"^6.1.0\"\n  }\n}"
      },
      {
        "name": "src",
        "type": "directory",
        "path": "frontend/src",
        "children": [
          {
            "name": "App.tsx",
            "type": "file",
            "path": "frontend/src/App.tsx",
            "language": "typescript",
            "content": "import { useState } from 'react';\nimport Header from './components/Header';\nimport LessonSidebar from './components/LessonSidebar';\nimport InstructionPane from './components/InstructionPane';\nimport LandingPage from './components/LandingPage';\nimport AppendixIDE from './components/AppendixIDE';\nimport { lessons } from './data/lessons';/* ================================================================\n * App — Root component composing the split-pane layout:\n *   Sidebar | InstructionPane | GhostEditor\n * ================================================================ */\n\nexport default function App() {\n    const [currentView, setCurrentView] = useState<'landing' | 'ide' | 'appendix'>('landing');\n    const [activeLessonId, setActiveLessonId] = useState(lessons[0].id);\n    const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\n\n    const activeLesson = lessons.find((l) => l.id === activeLessonId) || lessons[0];\n\n    return (\n        <div className=\"h-screen w-screen flex flex-col bg-white overflow-hidden\">\n            {currentView === 'ide' ? (\n                <>\n                    {/* Top bar */}\n                    <Header\n                        lessonTitle={activeLesson.title}\n                        onBackToRoadmap={() => setCurrentView('landing')}\n                    />\n\n                    {/* Main area: sidebar + split panes */}\n                    <div className=\"flex-1 flex overflow-hidden\">\n                        {/* Lesson navigation sidebar */}\n                        <LessonSidebar\n                            lessons={lessons}\n                            activeLessonId={activeLessonId}\n                            onSelectLesson={setActiveLessonId}\n                            collapsed={sidebarCollapsed}\n                            onToggleCollapse={() => setSidebarCollapsed((c: boolean) => !c)}\n                        />\n\n                        {/* Central pane: Instructions / Content */}\n                        <div className=\"flex-1 h-full overflow-y-auto bg-[#F8FAFC]\">\n                            <InstructionPane\n                                lesson={activeLesson}\n                            />\n                        </div>\n                    </div>\n                </>\n            ) : currentView === 'appendix' ? (\n                <AppendixIDE onBack={() => setCurrentView('landing')} />\n            ) : (\n                <LandingPage\n                    onSelectLesson={(id: string) => {\n                        setActiveLessonId(id);\n                        setCurrentView('ide');\n                    }}\n                    onOpenAppendix={() => setCurrentView('appendix')}\n                />\n            )}\n        </div>\n    );\n}\n"
          },
          {
            "name": "components",
            "type": "directory",
            "path": "frontend/src/components",
            "children": [
              {
                "name": "AppendixIDE.tsx",
                "type": "file",
                "path": "frontend/src/components/AppendixIDE.tsx",
                "language": "typescript",
                "content": "import React, { useState, useEffect } from 'react';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { vs } from 'react-syntax-highlighter/dist/esm/styles/prism';\n\ninterface FileNode {\n    name: string;\n    type: 'file' | 'directory';\n    path: string;\n    language?: string;\n    content?: string;\n    children?: FileNode[];\n}\n\ninterface AppendixIDEProps {\n    onBack: () => void;\n}\n\nconst FileTreeItem: React.FC<{ node: FileNode; level: number; onSelect: (node: FileNode) => void; selectedPath: string }> = ({ node, level, onSelect, selectedPath }) => {\n    const [expanded, setExpanded] = useState(false);\n\n    const isSelected = selectedPath === node.path;\n    const isDir = node.type === 'directory';\n\n    const handleClick = () => {\n        if (isDir) {\n            setExpanded(!expanded);\n        } else {\n            onSelect(node);\n        }\n    };\n\n    return (\n        <div>\n            <div\n                onClick={handleClick}\n                className={`flex items-center py-1.5 px-2 cursor-pointer text-[13px] hover:bg-black/5 transition-colors ${isSelected ? 'bg-blue-100/60 text-blue-700 font-medium' : 'text-gray-700'}`}\n                style={{ paddingLeft: `${level * 16 + 8}px` }}\n            >\n                <span className={`mr-2 w-4 text-center ${isDir ? 'opacity-50' : 'opacity-80'}`}>\n                    {isDir ? (expanded ? '▾' : '▸') : '📄'}\n                </span>\n                <span className=\"truncate\">{node.name}</span>\n            </div>\n            {isDir && expanded && node.children && (\n                <div>\n                    {node.children.map((child, idx) => (\n                        <FileTreeItem key={idx} node={child} level={level + 1} onSelect={onSelect} selectedPath={selectedPath} />\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default function AppendixIDE({ onBack }: AppendixIDEProps) {\n    const [tree, setTree] = useState<FileNode[]>([]);\n    const [selectedFile, setSelectedFile] = useState<FileNode | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        fetch('/codebase.json')\n            .then(res => res.json())\n            .then(data => {\n                setTree(data);\n                setLoading(false);\n            })\n            .catch(err => {\n                console.error('Failed to load codebase.json', err);\n                setLoading(false);\n            });\n    }, []);\n\n    return (\n        <div className=\"h-screen w-screen flex flex-col bg-white text-gray-900 overflow-hidden\">\n            {/* Header */}\n            <div className=\"h-14 bg-white border-b border-gray-200 flex items-center justify-between px-6 shrink-0 shadow-sm z-10\">\n                <div className=\"flex items-center gap-3\">\n                    <button onClick={onBack} className=\"text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-colors flex items-center gap-1 text-sm px-3 py-1.5 rounded-md font-medium\">\n                        ← 返回路线图\n                    </button>\n                    <div className=\"font-semibold ml-4 text-gray-800 text-sm\">项目全局代码库探索区 (Project Appendix)</div>\n                </div>\n                <div className=\"text-[11px] font-mono font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded\">Read-Only Mode</div>\n            </div>\n\n            <div className=\"flex-1 flex overflow-hidden\">\n                {/* Sidebar */}\n                <div className=\"w-72 bg-[#F8FAFC] border-r border-gray-200 flex flex-col h-full shrink-0\">\n                    <div className=\"px-4 py-2 text-[11px] font-bold text-gray-500 uppercase tracking-widest border-b border-gray-200 bg-[#F1F5F9]\">\n                        Explorer\n                    </div>\n                    <div className=\"flex-1 overflow-y-auto py-2\">\n                        {loading ? (\n                            <div className=\"text-center text-sm text-gray-500 mt-10\">Loading tree...</div>\n                        ) : (\n                            tree.map((node, idx) => (\n                                <FileTreeItem key={idx} node={node} level={0} onSelect={setSelectedFile} selectedPath={selectedFile?.path || ''} />\n                            ))\n                        )}\n                    </div>\n                </div>\n\n                {/* Editor Area */}\n                <div className=\"flex-1 bg-white flex flex-col overflow-hidden relative\">\n                    {selectedFile ? (\n                        <div className=\"flex-1 flex flex-col h-full w-full\">\n                            <div className=\"h-10 bg-[#F8FAFC] flex items-center px-4 shrink-0 border-b border-gray-200\">\n                                <span className=\"text-sm font-mono text-gray-600 flex items-center gap-2\">\n                                    📄 {selectedFile.path}\n                                </span>\n                            </div>\n                            <div className=\"flex-1 overflow-auto\">\n                                <SyntaxHighlighter\n                                    language={selectedFile.language || 'text'}\n                                    style={vs}\n                                    customStyle={{ margin: 0, padding: '1.5rem', fontSize: '14px', minHeight: '100%', backgroundColor: '#ffffff' }}\n                                    showLineNumbers={true}\n                                >\n                                    {selectedFile.content || ''}\n                                </SyntaxHighlighter>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"flex-1 flex items-center justify-center text-gray-400 flex-col gap-4 bg-[#F8FAFC]/50\">\n                            <svg className=\"w-16 h-16 opacity-30\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4\" /></svg>\n                            <p className=\"text-lg font-medium text-gray-500\">从左侧选择一个文件进行查看</p>\n                            <p className=\"text-sm opacity-70\">Select a file from the explorer to view its contents</p>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n"
              },
              {
                "name": "Header.tsx",
                "type": "file",
                "path": "frontend/src/components/Header.tsx",
                "language": "typescript",
                "content": "/* ================================================================\n * Header — Top navigation bar with Google-style branding\n * Light theme · Google Material palette\n * ================================================================ */\n\ninterface HeaderProps {\n    lessonTitle: string;\n    onBackToRoadmap?: () => void;\n}\n\nexport default function Header({ lessonTitle, onBackToRoadmap }: HeaderProps) {\n\n    return (\n        <header className=\"flex items-center justify-between px-6 h-16 bg-[#282A35] shrink-0 z-10 relative\">\n            {/* Branding */}\n            <div className=\"flex items-center gap-4\">\n                {onBackToRoadmap && (\n                    <button\n                        onClick={onBackToRoadmap}\n                        className=\"flex items-center justify-center text-white hover:text-white hover:bg-[#04AA6D] px-4 py-2 rounded transition-colors text-sm font-semibold mr-2\"\n                        title=\"返回路线图\"\n                    >\n                        ← HOME\n                    </button>\n                )}\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xl font-bold text-white tracking-widest\">\n                        CODE<span className=\"text-[#04AA6D]\">FORGE</span>\n                    </span>\n                    <span className=\"text-gray-400 mx-2 font-light\">|</span>\n                    <span className=\"text-sm text-gray-300 font-medium tracking-wide\">{lessonTitle}</span>\n                </div>\n            </div>\n\n            {/* Mock Right Side Options */}\n            <div className=\"hidden md:flex items-center gap-1\">\n                <button className=\"text-white hover:bg-black/30 px-3 py-2 rounded text-sm transition-colors\">TUTORIALS</button>\n                <button className=\"text-white hover:bg-black/30 px-3 py-2 rounded text-sm transition-colors\">EXERCISES</button>\n                <button className=\"text-white hover:bg-black/30 px-3 py-2 rounded text-sm transition-colors\">CERTIFICATES</button>\n                <div className=\"ml-4 flex items-center gap-2\">\n                    <button className=\"bg-[#04AA6D] hover:bg-[#059862] text-white px-5 py-2 rounded-full font-bold text-sm transition-colors\">Pro</button>\n                    <button className=\"bg-[#FFF4A3] hover:bg-[#EBE094] text-black px-5 py-2 rounded-full font-bold text-sm transition-colors\">Log in</button>\n                </div>\n            </div>\n\n        </header>\n    );\n}\n"
              },
              {
                "name": "InstructionPane.tsx",
                "type": "file",
                "path": "frontend/src/components/InstructionPane.tsx",
                "language": "typescript",
                "content": "import { useMemo } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport MermaidDiagram from './MermaidDiagram';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { vs } from 'react-syntax-highlighter/dist/esm/styles/prism';\nimport type { Lesson } from '../types';\n\n/* ================================================================\n * InstructionPane — Light theme with Google Material palette\n * Better margins/padding, clean typography\n * ================================================================ */\n\ninterface InstructionPaneProps {\n    lesson: Lesson;\n}\n\nexport default function InstructionPane({\n    lesson,\n}: InstructionPaneProps) {\n    const completedSteps = 7;\n\n    return (\n        <div className=\"flex flex-col py-0 md:py-6 px-0 md:px-4 min-h-full\">\n            <div className=\"max-w-5xl w-full mx-auto bg-white min-h-full md:min-h-0 md:h-auto shadow-sm md:shadow-lg md:shadow-gray-200/50 md:rounded-2xl border-x md:border border-gray-200 overflow-hidden\">\n                {/* Header */}\n                <div className=\"shrink-0 px-8 py-8 md:py-10 bg-white\">\n                    <h1 className=\"text-[38px] leading-[1.2] font-normal text-[#282A35] font-sans pb-4\">\n                        {lesson.title}\n                    </h1>\n                    <div className=\"flex items-center gap-3\">\n                        <button className=\"bg-[#04AA6D] hover:bg-[#059862] text-white px-5 py-2 rounded text-[15px] font-sans transition-colors cursor-pointer\">\n                            ❮ Previous\n                        </button>\n                        <button className=\"bg-[#04AA6D] hover:bg-[#059862] text-white px-5 py-2 rounded text-[15px] font-sans transition-colors cursor-pointer\">\n                            Next ❯\n                        </button>\n                    </div>\n                </div>\n\n                {/* Content area */}\n                <div className=\"flex-1 pb-16\">\n                    {/* Markdown instructions */}\n                    <div className=\"px-8 prose max-w-none\n          [&_h2]:text-[32px] [&_h2]:font-normal [&_h2]:mt-10 [&_h2]:mb-4 [&_h2]:text-[#282A35] [&_h2]:border-b [&_h2]:border-[#E5E5E5] [&_h2]:pb-2\n          [&_h3]:text-[24px] [&_h3]:font-normal [&_h3]:mt-8 [&_h3]:mb-3 [&_h3]:text-[#282A35]\n          [&_p]:text-[15px] [&_p]:mb-4 [&_p]:leading-normal [&_p]:text-[#282A35] [&_p]:font-sans\n          [&_ul]:mb-6 [&_ul]:pl-10 [&_ul]:space-y-1 [&_ul]:list-disc\n          [&_li]:text-[15px] [&_li]:leading-normal [&_li]:text-[#282A35] [&_li]:font-sans\n          [&_strong]:font-bold [&_strong]:text-[#282A35]\n          [&_:not(pre)>code]:text-[15px] [&_:not(pre)>code]:text-[#E01E5A] [&_:not(pre)>code]:bg-[#f1f1f1] [&_:not(pre)>code]:px-1.5 [&_:not(pre)>code]:py-0.5 [&_:not(pre)>code]:rounded-sm\n          [&_pre_code]:bg-transparent [&_pre_code]:p-0\n          [&_img]:shadow-md [&_img]:my-8 [&_img]:w-full [&_img]:max-w-3xl [&_img]:object-cover\n          [&_blockquote]:border-l-4 [&_blockquote]:border-[#04AA6D] [&_blockquote]:pl-4 [&_blockquote]:py-1 [&_blockquote]:text-[#282A35] [&_blockquote]:bg-[#E7E9EB] [&_blockquote]:my-5\">\n                        <ReactMarkdown\n                            remarkPlugins={[remarkGfm]}\n                            components={{\n                                code({ node, inline, className, children, ...props }: any) {\n                                    const match = /language-(\\w+)/.exec(className || '');\n                                    return !inline && match ? (\n                                        <div className=\"my-6 bg-[#E7E9EB] rounded px-4 py-4 md:px-5 md:py-5 font-sans\">\n                                            <h3 className=\"text-lg font-normal text-[#282A35] mt-0 mb-3\">Example</h3>\n                                            <div className=\"bg-white p-4 border-l-4 border-[#04AA6D] overflow-x-auto\">\n                                                <SyntaxHighlighter\n                                                    {...props}\n                                                    children={String(children).replace(/\\n$/, '')}\n                                                    style={vs}\n                                                    language={match[1]}\n                                                    PreTag=\"div\"\n                                                    customStyle={{ margin: 0, padding: 0, fontSize: '15px', fontFamily: 'Consolas, \"Courier New\", monospace', backgroundColor: 'transparent' }}\n                                                />\n                                            </div>\n                                        </div>\n                                    ) : (\n                                        <code {...props} className={className}>\n                                            {children}\n                                        </code>\n                                    );\n                                }\n                            }}\n                        >\n                            {lesson.instructions}\n                        </ReactMarkdown>\n                    </div>\n\n                    {/* Explanatory Illustration Feature */}\n                    {lesson.illustrationUrl && (\n                        <div className=\"px-8 pb-10\">\n                            <hr className=\"border-[#E5E5E5] my-6\" />\n                            <h2 className=\"text-[32px] font-normal text-[#282A35] mb-4 font-sans\">\n                                Architecture Illustration\n                            </h2>\n                            <div className=\"bg-[#E7E9EB] p-4 rounded\">\n                                <img src={lesson.illustrationUrl} alt=\"课程说明性插图\" className=\"w-full object-cover bg-white p-2\" />\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Backend: Mermaid diagram */}\n                    {lesson.type === 'backend' && lesson.diagramMarkup && (\n                        <div className=\"px-8 pb-8\">\n                            <h3 className=\"text-xs font-semibold text-[#80868B] uppercase tracking-wider mb-4\">\n                                架构流程\n                            </h3>\n                            <MermaidDiagram\n                                markup={lesson.diagramMarkup}\n                                completedSteps={completedSteps}\n                            />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n"
              },
              {
                "name": "LandingPage.tsx",
                "type": "file",
                "path": "frontend/src/components/LandingPage.tsx",
                "language": "typescript",
                "content": "import React, { useEffect, useRef } from 'react';\nimport mermaid from 'mermaid';\nimport { lessons } from '../data/lessons';\n\ninterface LandingPageProps {\n    onSelectLesson: (id: string) => void;\n    onOpenAppendix: () => void;\n}\n\nexport default function LandingPage({ onSelectLesson, onOpenAppendix }: LandingPageProps) {\n    const mermaidRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        const renderMermaid = async () => {\n            if (mermaidRef.current) {\n                try {\n                    const id = `landing-mermaid-${Date.now()}`;\n                    const { svg } = await mermaid.render(\n                        id,\n                        `graph TD\n    Client[\"Frontend (React / Next.js)\"]\n    API[\"Spring Boot REST API\"]\n    Redis[(\"Redis (Cache & Session)\")]\n    Kafka{\"Kafka (Event Bus) DLQ\"}\n    DB[(\"MySQL (Persistent Storage)\")]\n    \n    Client -- \"1. Login / Fetch Feed\" --> API\n    Client -- \"2. Like Video\" --> API\n    API -- \"3. Read/Write Cache\" --> Redis\n    API -- \"4. Publish Like Event\" --> Kafka\n    Kafka -- \"5. Consume & Aggregate\" --> DB\n    \n    style Client fill:#E8F0FE,stroke:#4285F4,stroke-width:2px,color:#202124\n    style API fill:#E6F4EA,stroke:#34A853,stroke-width:2px,color:#202124\n    style Redis fill:#FCE8E6,stroke:#EA4335,stroke-width:2px,color:#202124\n    style Kafka fill:#FEF7E0,stroke:#FBBC05,stroke-width:2px,color:#202124\n    style DB fill:#E8F0FE,stroke:#4285F4,stroke-width:2px,color:#202124`\n                    );\n                    mermaidRef.current.innerHTML = svg;\n                } catch (e) {\n                    console.error('Mermaid render failed', e);\n                    if (mermaidRef.current) {\n                        mermaidRef.current.innerHTML = '<div class=\"text-red-500\">Failed to load architecture diagram.</div>';\n                    }\n                }\n            }\n        };\n\n        renderMermaid();\n    }, []);\n\n    // Group lessons by module (or just category)\n    const categories = Array.from(new Set(lessons.map((l) => l.category)));\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 flex flex-col items-center py-10 px-4 overflow-y-auto w-full h-full\">\n            <div className=\"max-w-6xl w-full\">\n                <h1 className=\"text-4xl font-bold text-center text-gray-900 mb-2\">短视频 SaaS 看板项目实战全栈架构</h1>\n                <p className=\"text-center text-gray-600 mb-10 text-lg\">从零开始构建一个支撑高并发的高可用体系</p>\n\n                {/* Architecture Diagram */}\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-8 mb-12 flex justify-center\">\n                    <div ref={mermaidRef} className=\"text-center w-full max-w-3xl\" />\n                </div>\n\n                {/* Roadmap Grid */}\n                <h2 className=\"text-2xl font-bold text-gray-800 mb-6\">实战闯关地图 (Roadmap)</h2>\n                <div className=\"space-y-8 pb-12\">\n                    {categories.map((category) => {\n                        const catLessons = lessons.filter((l) => l.category === category);\n                        return (\n                            <div key={category} className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n                                <h3 className=\"text-xl font-bold text-gray-800 mb-4 pb-2 border-b border-gray-100\">{category}</h3>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                                    {catLessons.map((lesson) => {\n                                        return (\n                                            <div\n                                                key={lesson.id}\n                                                onClick={() => onSelectLesson(lesson.id)}\n                                                className=\"group relative rounded-xl border border-gray-200 hover:border-[#4285F4] hover:shadow-xl hover:-translate-y-1 cursor-pointer transition-all duration-300 bg-white flex flex-col justify-between overflow-hidden\"\n                                            >\n                                                {/* Image Header */}\n                                                {lesson.illustrationUrl && (\n                                                    <div className=\"w-full h-40 overflow-hidden relative bg-gray-100\">\n                                                        <img src={lesson.illustrationUrl} className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\" alt={lesson.title} />\n                                                        <div className=\"absolute inset-0 bg-linear-to-t from-gray-900/60 via-transparent to-transparent\"></div>\n                                                        <div className=\"absolute top-3 left-3\">\n                                                            <span className={`text-[10px] uppercase tracking-wider font-bold px-2.5 py-1 rounded-full backdrop-blur-md shadow-sm border border-white/20 ${lesson.type === 'frontend' ? 'bg-blue-500/90 text-white' : 'bg-green-500/90 text-white'}`}>\n                                                                {lesson.type === 'frontend' ? '前端 / Frontend' : '后端 / Backend'}\n                                                            </span>\n                                                        </div>\n                                                    </div>\n                                                )}\n\n                                                <div className=\"p-5\">\n                                                    {!lesson.illustrationUrl && (\n                                                        <div className=\"flex items-start justify-between mb-2\">\n                                                            <span className={`text-xs font-bold px-2 py-1 rounded ${lesson.type === 'frontend' ? 'bg-[#E8F0FE] text-[#1967D2]' : 'bg-[#E6F4EA] text-[#137333]'}`}>\n                                                                {lesson.type === 'frontend' ? '前端' : '后端'}\n                                                            </span>\n                                                        </div>\n                                                    )}\n                                                    <h4 className=\"font-bold text-gray-800 group-hover:text-[#4285F4] transition-colors line-clamp-2 text-[15px] leading-tight mt-1\">\n                                                        {lesson.title}\n                                                    </h4>\n                                                </div>\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            </div>\n                        );\n                    })}\n                </div>\n\n                {/* Appendix Button */}\n                <div className=\"mt-8 text-center pb-20\">\n                    <button onClick={onOpenAppendix} className=\"bg-linear-to-r from-gray-900 to-gray-800 text-white px-8 py-4 rounded-full font-bold shadow-xl shadow-gray-900/20 hover:scale-105 hover:shadow-gray-900/40 transition-all duration-300 flex items-center justify-center gap-3 mx-auto\">\n                        <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4\" /></svg>\n                        探索项目全局代码库 (IDE附录)\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"
              },
              {
                "name": "LessonSidebar.tsx",
                "type": "file",
                "path": "frontend/src/components/LessonSidebar.tsx",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\n/* ================================================================\n * LessonSidebar — Light theme with Google Material palette\n * Clean spacing, no emoji, proper margins\n * ================================================================ */\n\ninterface LessonSidebarProps {\n    lessons: Lesson[];\n    activeLessonId: string;\n    onSelectLesson: (id: string) => void;\n    collapsed: boolean;\n    onToggleCollapse: () => void;\n}\n\n/** Group lessons by their category */\nfunction groupByCategory(lessons: Lesson[]): Record<string, Lesson[]> {\n    const groups: Record<string, Lesson[]> = {};\n    for (const lesson of lessons) {\n        if (!groups[lesson.category]) groups[lesson.category] = [];\n        groups[lesson.category].push(lesson);\n    }\n    return groups;\n}\n\nexport default function LessonSidebar({\n    lessons,\n    activeLessonId,\n    onSelectLesson,\n    collapsed,\n    onToggleCollapse,\n}: LessonSidebarProps) {\n    const groups = groupByCategory(lessons);\n\n    if (collapsed) {\n        return (\n            <div className=\"flex flex-col items-center py-5 w-14 bg-[#F2F2F2] border-r border-[#E5E5E5] shrink-0\">\n                <button\n                    onClick={onToggleCollapse}\n                    className=\"p-2 rounded hover:bg-[#D9D9D9] text-[#282A35] transition-colors\"\n                    aria-label=\"展开侧边栏\"\n                >\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 5l7 7-7 7M5 5l7 7-7 7\" />\n                    </svg>\n                </button>\n                <div className=\"mt-6 flex flex-col gap-2 w-full px-2\">\n                    {lessons.map((lesson, idx) => {\n                        const isActive = lesson.id === activeLessonId;\n                        return (\n                            <button\n                                key={lesson.id}\n                                onClick={() => onSelectLesson(lesson.id)}\n                                className={`w-full py-2 flex items-center justify-center text-xs font-bold transition-all ${isActive\n                                    ? 'bg-[#04AA6D] text-white'\n                                    : 'text-[#282A35] hover:bg-[#D9D9D9]'\n                                    }`}\n                                title={lesson.title}\n                            >\n                                {idx + 1}\n                            </button>\n                        );\n                    })}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex flex-col w-64 bg-[#F2F2F2] shrink-0 border-r border-[#E5E5E5] overflow-hidden\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between px-4 py-4 border-b border-[#E5E5E5]\">\n                <h3 className=\"text-[15px] font-bold text-[#282A35]\">Tutorial Menu</h3>\n                <button\n                    onClick={onToggleCollapse}\n                    className=\"p-1 rounded hover:bg-[#D9D9D9] text-[#282A35] transition-colors\"\n                    aria-label=\"折叠侧边栏\"\n                >\n                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 19l-7-7 7-7m8 14l-7-7 7-7\" />\n                    </svg>\n                </button>\n            </div>\n\n            {/* Lesson list */}\n            <nav className=\"flex-1 overflow-y-auto w-full custom-scrollbar\">\n                {Object.entries(groups).map(([category, categoryLessons]) => (\n                    <div key={category} className=\"mb-2\">\n                        <h4 className=\"px-4 pt-5 pb-2 text-[13px] font-bold text-[#282A35] uppercase tracking-wider bg-[#E5E5E5]/50\">\n                            {category}\n                        </h4>\n                        <ul className=\"flex flex-col\">\n                            {categoryLessons.map((lesson) => {\n                                const isActive = lesson.id === activeLessonId;\n                                return (\n                                    <li key={lesson.id} className=\"w-full\">\n                                        <button\n                                            onClick={() => onSelectLesson(lesson.id)}\n                                            className={`w-full text-left px-4 py-2.5 text-[15px] transition-colors font-sans ${isActive\n                                                ? 'bg-[#04AA6D] text-white hover:bg-[#059862]'\n                                                : 'text-[#282A35] hover:bg-[#D9D9D9]'\n                                                }`}\n                                        >\n                                            {lesson.title}\n                                        </button>\n                                    </li>\n                                );\n                            })}\n                        </ul>\n                    </div>\n                ))}\n            </nav>\n        </div>\n    );\n}\n"
              },
              {
                "name": "MermaidDiagram.tsx",
                "type": "file",
                "path": "frontend/src/components/MermaidDiagram.tsx",
                "language": "typescript",
                "content": "import { useEffect, useRef, useCallback } from 'react';\nimport mermaid from 'mermaid';\n\n/* ================================================================\n * MermaidDiagram — Renders Mermaid.js diagrams and highlights\n * completed architecture nodes based on user progress.\n * ================================================================ */\n\ninterface MermaidDiagramProps {\n    /** Raw Mermaid markup string */\n    markup: string;\n    /** How many logical steps the user has finished (0-based) */\n    completedSteps: number;\n}\n\n/** Initialize mermaid with dark theme once */\nmermaid.initialize({\n    startOnLoad: false,\n    theme: 'dark',\n    themeVariables: {\n        primaryColor: '#334155',\n        primaryTextColor: '#e2e8f0',\n        primaryBorderColor: '#64748b',\n        lineColor: '#64748b',\n        secondaryColor: '#1e293b',\n        tertiaryColor: '#0f172a',\n        fontFamily: 'Inter, sans-serif',\n        fontSize: '14px',\n    },\n    flowchart: {\n        htmlLabels: true,\n        curve: 'basis',\n    },\n});\n\n/** Node IDs in the order they appear in the architecture diagram */\nconst NODE_IDS = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];\nconst HIGHLIGHT_FILL = '#059669';    // emerald-600\nconst HIGHLIGHT_STROKE = '#34d399';  // emerald-400\nconst HIGHLIGHT_TEXT = '#ffffff';\n\nexport default function MermaidDiagram({ markup, completedSteps }: MermaidDiagramProps) {\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    /** Inject highlight styles for completed nodes into the markup */\n    const getHighlightedMarkup = useCallback(() => {\n        let result = markup;\n\n        // Only apply node styles to flowcharts/graphs\n        if (!markup.trim().startsWith('graph') && !markup.trim().startsWith('flowchart')) {\n            return result;\n        }\n\n        // Remove all existing style lines so we can rewrite them\n        result = result.replace(/\\n\\s*style\\s+\\w+\\s+fill:.*$/gm, '');\n\n        // Add style directives for each node\n        const styleLines = NODE_IDS.map((id, index) => {\n            if (index < completedSteps) {\n                return `    style ${id} fill:${HIGHLIGHT_FILL},stroke:${HIGHLIGHT_STROKE},color:${HIGHLIGHT_TEXT}`;\n            }\n            return `    style ${id} fill:#334155,stroke:#64748b,color:#e2e8f0`;\n        });\n\n        return result + '\\n' + styleLines.join('\\n');\n    }, [markup, completedSteps]);\n\n    useEffect(() => {\n        const render = async () => {\n            if (!containerRef.current) return;\n\n            try {\n                const id = `mermaid-${Date.now()}`;\n                const highlighted = getHighlightedMarkup();\n                const { svg } = await mermaid.render(id, highlighted);\n                containerRef.current.innerHTML = svg;\n\n                // Make the SVG responsive\n                const svgEl = containerRef.current.querySelector('svg');\n                if (svgEl) {\n                    svgEl.style.maxWidth = '100%';\n                    svgEl.style.height = 'auto';\n                }\n            } catch (err) {\n                console.warn('Mermaid render error:', err);\n                if (containerRef.current) {\n                    containerRef.current.innerHTML =\n                        '<p class=\"text-slate-500 text-sm\">Diagram rendering...</p>';\n                }\n            }\n        };\n\n        render();\n    }, [getHighlightedMarkup]);\n\n    return (\n        <div\n            ref={containerRef}\n            className=\"w-full p-4 flex justify-center items-center bg-slate-900/50 rounded-xl border border-slate-700/50\"\n        />\n    );\n}\n"
              }
            ]
          },
          {
            "name": "data",
            "type": "directory",
            "path": "frontend/src/data",
            "children": [
              {
                "name": "advanced-frontend.ts",
                "type": "file",
                "path": "frontend/src/data/advanced-frontend.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const advancedFrontend: Lesson[] = [\n  {\n    id: 'fe-adv-state', type: 'frontend',\n    title: 'Zustand 企业级状态管理',\n    category: '进阶：高级前端架构', track: '前端架构',\n    moduleNumber: 6, lessonNumber: 1, language: 'typescript',\n        illustrationUrl: '/illustrations/w3_react_hooks_flow_1771635574572.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 引入 Zustand 替代 Context API\n\n## 业务上下文\n在复杂的企业级 React SaaS 应用中，跨组件层级的状态共享是核心痛点。虽然 React 提供了自带的原生 Context API，但如果将其用于存储高频度变动的数据源（如输入框实时联动、鼠标坐标系追踪），Context 内置的消费模式会导致订阅在 Provider 节点下方的所有组件无论是否使用了该变动字段，全部遭遇无条件的级联强制重渲染（Re-render Cascades）。\n为解决该性能消耗瓶颈，利用第三方状态管理微内核如 **Zustand** 构建独立于组件树外的单一全局状态流引擎，并实现精准颗粒度的按需订阅范式是业界公认的高端实现方案。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport { create } from 'zustand';\n\n// 1. 基干层状态树全览类型设定\ninterface ConfigState {\n  theme: 'dark' | 'light';\n  sidebarOpen: boolean;\n  toggleSidebar: () => void;\n  setTheme: (theme: 'dark' | 'light') => void;\n}\n\n// 2. Zustand 核心状态槽生成模型：摆脱 React 生命周期干涉的超脱型 Store \nexport const useConfigStore = create<ConfigState>((set) => ({\n  theme: 'light',\n  sidebarOpen: true,\n  // set 修改器会采用 Object.assign 机制自动并合前序层叠状态，无需全量回写\n  toggleSidebar: () => set((state) => ({ sidebarOpen: !state.sidebarOpen })),\n  setTheme: (theme) => set({ theme }),\n}));\n\n// 组件域实际接入侧应用：\nexport function SidebarToggle() {\n  // 3. 极细化精准分片（Selector 机制）\n  // 这里的读取声明等于告知状态机：本组件只有在 sidebarOpen 发生绝对值变化时才会被触发被动重绘\n  const sidebarOpen = useConfigStore((state) => state.sidebarOpen);\n  const toggle = useConfigStore((state) => state.toggleSidebar);\n\n  return (\n    <button onClick={toggle}>\n      {sidebarOpen ? '收起系统侧边总枢' : '全展面板详情布局'}\n    </button>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Zustand 的观察者模式 (Observer Pattern) 与不可变态 (Immutability)**：\n相较于 React 内部极度依赖虚拟 DOM 比较向下散列的流式循环推送，Zustand 在其底层实际上是建立了一套极简的 **Pub/Sub (发布-订阅) 数据流引擎模型**。\n当你执行 \\`create\\` 环节后，它便在 JS 独立堆内存节点中划分出一块封地存放该对象实体。并在框架外部保留了一组注册着无数对应各依赖组件 \\`forceUpdate\\` 挂钩函数的集合。一旦 \\`set()\\` 驱动了某个节点的绝对不可变指针更新，其内部系统将通过比照 (Object.is) 寻觅哪些具体的选针器（Selector）的返回值脱离了锚点，随后精确通知该部分对应的函数列触发强行的 \\`render\\` 生命周期。这彻底截断了层层剥皮传递比对导致的高昂系统效能开支。`\n  },\n  {\n    id: 'fe-adv-perf', type: 'frontend',\n    title: 'React 终极性能优化',\n    category: '进阶：高级前端架构', track: '前端架构',\n    moduleNumber: 6, lessonNumber: 2, language: 'typescript',\n        illustrationUrl: '/illustrations/w3_react_optimizations_1771635739563.png',\n    startingCode: '', targetCode: '',\n    instructions: `# React 性能防卫：useMemo 与闭包引用击穿\n\n## 业务上下文\n面临客户端中重度复杂密集计算需求（如千万级数组元素的深层迭代过滤排序解析，或是重型高宽幅列表）场景时。上层节点的其它状态变更行为常常引发当前作用域内计算过程反复多次运转，极易引爆主线程拥堵阻塞与掉帧现象（Jank）。此时应当动用体系内的 **useMemo** 与 **useCallback** 防范屏障针对相关纯函数结果进行空间时间置换并对防危引用进行地址锚定封存。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport React, { useState, useMemo, useCallback } from 'react';\n\ninterface ExpensiveListProps {\n  items: string[];\n  onItemClick: (item: string) => void;\n}\n\n// 1. 对于底层深重列表视图加入静态防御阻绝网 React.memo()\nconst ExpensiveList = React.memo(({ items, onItemClick }: ExpensiveListProps) => {\n  return (\n    <ul>\n      {items.map((it) => (\n        <li key={it} onClick={() => onItemClick(it)}>{it}</li>\n      ))}\n    </ul>\n  );\n});\n\nexport default function FilterView() {\n  const [query, setQuery] = useState('');\n  const [clicks, setClicks] = useState(0);\n\n  // 模拟出需要极致性能支撑运转的前端伪万量级长排数据集体\n  const rawData = Array.from({ length: 10000 }, (_, i) => \\`Item \\${i}\\`);\n\n  // 2. 算力开销阻滞器：通过依赖探针包裹将无意义反复进行的全列重构阻挡在墙外\n  const filtered = useMemo(() => {\n    // 此时仅在 query 更改事件触发才会解锁重放进行重新遍历\n    if (!query) return rawData.slice(0, 100);\n    return rawData.filter(i => i.includes(query)).slice(0, 100);\n  }, [query]); \n\n  // 3. 内存地址防滑钉：对回调指针实施绝对定死锁定策略\n  const handleClick = useCallback((item: string) => {\n    console.log(\\`交互回调确认击发： \\${item}\\`);\n  }, []);\n\n  return (\n    <div>\n      <input value={query} onChange={e => setQuery(e.target.value)} placeholder=\"Filter...\" />\n      {/* 任意操作此纯状态切换组件并不会波及引发对下方长列表与重算区的数据池连带刷新 */}\n      <button onClick={() => setClicks(c => c + 1)}>不相关按钮交互频率: {clicks}</button>\n      <ExpensiveList items={filtered} onItemClick={handleClick} />\n    </div>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**纯函数稳定性引用与堆栈对象比对穿透失控**：\n一切以 \\`{}\\`, \\`[]\\`, \\`() => {}\\` 匿名符号声明的对象及函数体类型都从属于宿主堆内存系统内的引用传参范畴体系。\n若在渲染环内裸写 \\`const handle = () => {}\\`，每一帧调度的该作用域便会在内存表里另分配一片全新序列空间的同构异形体。\\n处于最内核受防级的 \\`ExpensiveList\\` 其在浅层属性比对防线阶段（\\`prevProps.onItemClick === nextProps.onItemClick\\`），由于指针比对不同而宣告失守被强突击穿全面崩溃致使 \\`memo()\\` 成为无效掩体。\\n利用 \\`useCallback()\\` 本质上在底层 React Fiber 对象节点上建立了一个不会消失且连延持存挂载映射属性节点。不仅阻断了分配回收损耗，更保持了向后文传递时引用的同位同构不堕逻辑。`\n  },\n  {\n    id: 'fe-adv-next', type: 'frontend',\n    title: 'Next.js：SSG 静态站点生成',\n    category: '进阶：高级前端架构', track: '前端架构',\n    moduleNumber: 6, lessonNumber: 3, language: 'typescript',\n        illustrationUrl: '/illustrations/w3_nextjs_ssr_arch_1771635590252.png',\n    startingCode: '', targetCode: '',\n    instructions: `# SSG 预置数据静态生成架构体系\n\n## 业务上下文\n若是对于“帮助页公告中心”或是“平台固定架构协议文档”此类不掺杂私人敏感隔离属性，同时常年不做高频修正变动信息的纯静态公进展页面组群。即使使用了 SSR 也会因为存在了后端 Node.js 对于每个请求接盘而进行的实时渲染操作进而空转极大地浪费计算实例云端机位。通过指定架构退化至 **SSG (Static Site Generation 静态生成层)**，系统会在应用编译打包节点中抓取完并烧录封锁一切网络获取内容资源，最终输出一堆无懈可击纯 HTML 源文下派置全球的 CDN 边缘云节点进行极速秒开级派发。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport React from 'react';\n\n// 1. 设置 Next.js 编译器宏路由准入标志策略 \n// 斩源命令系统让该模块完全脱离运行时服务推演层\nexport const dynamic = 'force-static';\n\ninterface Post {\n  id: number;\n  title: string;\n  body: string;\n}\n\nexport default async function HelpCenterPage() {\n  // 2. Fetch API 的扩展劫持：声明预取锁止周期 \n  const res = await fetch('https://api.cms-system.com/docs/core-protocols', {\n    // 这个强制命令意味着它只会在 npm run build (构建期流水线 CI) 时拉下并固定被写死进最终输出静态体系 HTML 中\n    cache: 'force-cache',\n  });\n  const post: Post = await res.json();\n\n  return (\n    <article className=\"prose lg:prose-xl p-8 max-w-2xl mx-auto border bg-white rounded-2xl shadow-sm mt-8\">\n      <h1>{post.title}</h1>\n      <p className=\"border-b pb-4 text-gray-500\">文档最终归档版本期锁定：流水线建构时间戳位记号</p>\n      <div className=\"mt-6 text-gray-800 leading-relaxed font-serif track-wide\">{post.body}</div>\n    </article>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Time to First Byte (TTFB) 极限对撞机与 CDN 边缘网络**：\n对比传统 CSR 面临长长的时间黑洞（TTFB 甚至会因 JS 执行耗损至长达 3 秒开外）。即使 SSR 服务端渲染在每次调用期间其至少同样包含了网络握手和数据抓取的固定周期不可破 100ms~ 500ms 服务延时消耗。\n而 SSG 的纯文本导出特性，使其能够如静态大屏海报般挂载驻留推落于诸如（Cloudflare / Vercel Edge 等）CDN 内容分发网格内极其贴近用户物理家庭端侧所在的机房内。它的分派行为脱离了算力逻辑仅执行于无脑的缓存原版流复制派发任务上，所以网络响应到达下层端点时间（TTFB）可压榨拉平至于极其丧心病狂的 \\`~15 毫秒\\` 内极值。这对于大型网站优化 Google 搜录评分 (Lighthouse Metrics) 是决胜指标操作。`\n  },\n  {\n    id: 'fe-adv-ws', type: 'frontend',\n    title: '全双工战线：WebSockets 实时推送',\n    category: '进阶：高级前端架构', track: '前端架构',\n    moduleNumber: 6, lessonNumber: 4, language: 'typescript',\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# WebSocket 双全工长连接通道架构\n\n## 业务上下文\n在短时视频高容量迸发的流媒体平台上，如果试图展示主播房间内实时汇集的密集关注人气流量波动跳级展示。过去使用的 HTTP 短轮询（Pooling：前端靠 \\`setInterval\\` 定期轮番扫寻砸门索取结果）将会造成成千上万无效包头协议载荷对网关系统的暴风洗劫拖垮。\n引接浏览器端全原生协议底层内建的 **WebSocket (WS)** 构建恒流持存隧道链路，它搭建起一条彻底免除掉传统 HTTP 一问一答枷锁闭环限制的双向奔流通路管线。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport React, { useEffect, useState, useRef } from 'react';\n\ninterface ActiveViewer {\n  videoId: string;\n  count: number;\n}\n\nexport function RealtimeViewerDashboard() {\n  const [viewers, setViewers] = useState<ActiveViewer[]>([]);\n  // 1. 设置越限钩子引用来存贮隧道接驳持存引用以应对注销撤档控制\n  const wsRef = useRef<WebSocket | null>(null);\n\n  useEffect(() => {\n    // 2. 将底层协议族从 http:// 转拉为 ws:// 发出升级晋升网络挂接请求信息\n    const ws = new WebSocket('ws://api-service.cluster.local:8080/ws/viewers/trends');\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      console.log('协议升级连贯，通道已进入长守恒放开态：Ready');\n    };\n\n    // 3. 拦截服务端单向自由下抛的字节文本消息序列并映射进虚拟呈现树组态内\n    ws.onmessage = (event) => {\n      try {\n        const data: ActiveViewer[] = JSON.parse(event.data);\n        setViewers(data);\n      } catch (err) {\n        console.error('序列转换抛落结构解析断点防沉迷', err);\n      }\n    };\n\n    // 4. 安全阀清理析构函数：保证组件遭遇下架回收拆毁退避周期中彻底清空死握链接进程通道\n    return () => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.close();\n      }\n    };\n  }, []); // 空挂载列表意为伴随组件存续的全周期间只建立并打通那一根独苗连接管道通道\n\n  return (\n    <div className=\"bg-[#111827] text-white p-6 rounded-xl shadow-2xl border border-gray-800\">\n      <h2 className=\"text-xl font-bold flex items-center mb-6\">\n        <span className=\"w-2.5 h-2.5 rounded-full bg-red-400 animate-pulse mr-3 shadow-[0_0_8px_rgba(248,113,113,0.8)]\"></span>\n        高通量时流中控面板列矩阵\n      </h2>\n      <ul className=\"space-y-3\">\n        {viewers.length === 0 && <span className=\"text-gray-500 text-sm tracking-wide\">管道序列暂空...正在维持侦探等候接驳源</span>}\n        {viewers.map((v) => (\n          <li key={v.videoId} className=\"flex justify-between items-center border-b border-gray-800/50 pb-2\">\n            <span className=\"font-mono text-sm text-cyan-400\">Stream # {v.videoId.slice(0, 8)}</span>\n            <span className=\"font-mono font-bold text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded\">\n              {v.count.toLocaleString()}\n            </span>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**HTTP 协议握手头部拥挤症侯群与 WS 信道升级握手机制**：\n每一个传统的单发 HTTP 请求均被要求在网络堆栈底部配备体积肥胖庞大臃肿且占位达千百字节量级的诸如 Headers、Cookies 及源头校验体。如果在高频请求域中发送这将发生极为高比例的无效废柴数据占比拖行阻塞问题。\nWebSocket 的底层连接发源本质也是一条 HTTP 探针，它在前导包体内携带着要求进行协议跃升的标头：\\`Connection: Upgrade\\`, 和 \\`Upgrade: websocket\\` 。\n一旦拥有对向拦截解析力的服务器系统对标识别并给予成功接收（往往回执以 \\`HTTP 101 Switching Protocols\\` 状态命令报），该 TCP 底层信标连接层再不会进行被动释放切断，而是转交退位于完全剔除掉了啰嗦额外网络元信息头标的纯真态精简帧传递格式层执行（只持有 \\`2 bytes\\` 耗能包附着层架构）。这也就为达成百万级平行并发信道集群建立起可能。`\n  }\n];\n"
              },
              {
                "name": "backend-advanced.ts",
                "type": "file",
                "path": "frontend/src/data/backend-advanced.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const advancedBackend: Lesson[] = [\n    {\n        id: 'be-adv-oauth2', type: 'backend',\n        title: 'Spring Security OAuth2.0 与社交登录',\n        category: '进阶：系统架构与网关安全', track: '后端工程',\n        moduleNumber: 7, lessonNumber: 1, language: 'java',\n        illustrationUrl: '/illustrations/backend_microservices.png',\n        startingCode: '', targetCode: '',\n        instructions: `# 引入 OAuth2.0 与 OIDC 分布式授权\n\n## 业务上下文\n在现代商业 SaaS 应用架构中，为消减新用户构建专属通行密钥（账号密码）时的转化率阻力，往往采用集成第三方可信 Identity Provider (IdP，身份提供商，如 Google, GitHub) 进行单点越权颁发登录体系。\nSpring Security 生态内建的 **OAuth2 Client** 及 **OIDC (OpenID Connect)** 协议引擎能将繁重且存在安全漏洞风险的手工 Token 交换重定向流层层接管，并在底层建立起极其可靠的鉴权流链路。\n\n## 代码与配置解析\n\n\\`\\`\\`java\npackage com.codeforge.security;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\npublic class SecurityConfig {\n\n    // 1. 挂载过滤器矩阵网段配置\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            // 声明 HTTP 请求级别的端点准入资源边界\n            .authorizeHttpRequests(auth -> auth\n                .requestMatchers(\"/api/public/**\").permitAll()\n                .requestMatchers(\"/api/admin/**\").hasRole(\"ADMIN\")\n                .anyRequest().authenticated()\n            )\n            // 2. 启用内部状态机无缝托管底层 OAuth2 Code 转换换源验证链路\n            // 开发只需在 application.yml 里给足 Registration ClientID 和 Secret 凭证即可\n            .oauth2Login(oauth2 -> oauth2\n                .defaultSuccessUrl(\"/dashboard\", true)\n            )\n            // 3. 架构降权：对于纯 API 驱动的前后端解耦系统，剔除由后端吐出渲染界面的 Form 表单机制\n            .formLogin(form -> form.disable())\n            // 彻底关停跨站请求伪造 (CSRF) 屏障防御网（因为 JWT Token 将取代 Cookie-Session 机制主宰防护）\n            .csrf(csrf -> csrf.disable());\n\n        return http.build();\n    }\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**OAuth2 协议的 Authorization Code (授权码) 模式流程**：\n此套方案是 OAuth2 中最为稳妥严谨的授权范型，专门针对暴露在极容易被反编译的终端（如浏览器或手机 App）。\n当未具备本端权限系统的用户访问时：\n1. **第一次换域重定向**：前端或者 Spring 后端网关发还 \\`HTTP 302\\`，强制将其导引至 Google 认证防线域，这一跳带有 \\`client_id\\` 及验证发起方特征的密态随机 \\`state\\` 字串以防止 CSRF 干涉。\n2. **授权中心派授 Code 票据**：用户在 Google 侧填报无误并签署授权许可后，Google 再次发生回环重定向（Callback），向 Spring 的 \\`/login/oauth2/code/google\\` 抛出一条极短暂寿命（通常仅几十秒）的 \\`Code\\` 和刚送出去做核对核验对撞比对用的 \\`state\\` 返回核销。\\n3. **后端黑盒下的 Token 置换（Back-channel Security）**：最致命、最关键的一环。Spring 接收到这枚瞬息失效的 \\`Code\\` 后。绝不是交给前端，而是 **在其后台物理机之间的服务端网络深处** 发起高等级的内网网络通信并向 Google 的 \\`/token\\` 接口质押这枚 \\`Code\\` 外加保存在机器内存绝对不会外泄给使用者的 \\`client_secret\\` 换防提取出代表了全局操作权的 \\`Access Token\\` 和个人信息的 \\`ID Token\\`。此黑盒结构杜绝了 Token 在网线公域飞行的暴露窃取可能。`,\n        diagramMarkup: `sequenceDiagram\n    participant User as 用户终端\n    participant API as Spring Boot (Oauth2 Client)\n    participant Google as 外部身份域 (Authorization Server)\n    \n    User->>API: 1. 请求接入安全防卫线\n    API-->>User: 2. [302 跳转] 发送往 Google 下发 state\n    User->>Google: 3. 用户出示密钥执行许可授权\n    Google-->>API: 4. [前端可见] 回抛带有短暂效力票据 Code\n    API->>Google: 5. [暗网黑盒端] 携带 Secret 和 Code 潜行通信取回令牌\n    Google-->>API: 6. 下发承载 Access Token 加密串\n    API-->>User: 7. 框架接手数据并执行本地落盘建档`\n    },\n    {\n        id: 'be-adv-rate', type: 'backend',\n        title: 'Redis 高并发限流 (Rate Limiting)',\n        category: '进阶：系统架构与网关安全', track: '后端工程',\n        moduleNumber: 7, lessonNumber: 2, language: 'java',\n        illustrationUrl: '/illustrations/w3_redis_cache_1771635654039.png',\n        startingCode: '', targetCode: '',\n        instructions: `# 利用 Lua 脚本与 Redis 构建分布式限流引擎\n\n## 业务上下文\n在遭受短线洪压、竞品恶意重压扫描或因代码死循环造成对于像“核心注册、下抛验证短信息验证码”这种产生高昂第三方财务结算费用的计费级 API 并发踩踏时，毫无掩体的微服务将受到毁灭级财务及负载摧毁。\n通过部署基于**原子态算法层级下的限流护卫 (Rate Limiting) 防御系统**极为必要。我们将引入内存介质 **Redis** 搭载并执行 **Lua 脚本** 的联合技术实现无锁化、具备极低损耗且绝对并发一致性严谨防护墙。\n\n## 代码与配置解析\n\n\\`\\`\\`java\npackage com.codeforge.security.ratelimit;\n\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.annotation.Aspect;\nimport org.springframework.data.redis.core.StringRedisTemplate;\nimport org.springframework.data.redis.core.script.DefaultRedisScript;\nimport org.springframework.stereotype.Component;\nimport jakarta.servlet.http.HttpServletRequest;\n\nimport java.util.Collections;\n\n@Aspect\n@Component\npublic class RateLimitAspect {\n\n    private final StringRedisTemplate redisTemplate;\n    private final HttpServletRequest request;\n    \n    // 1. 硬编嵌装 Lua 原子态限流计数探查脚本器\n    //  极简精悍指令规避分布式中读取与核写发生的竞态隔离崩塌问题\n    private static final String LUA_SCRIPT = \n        \"local current = redis.call('get', KEYS[1]) \" +\n        \"if current and tonumber(current) >= tonumber(ARGV[1]) then return 0 end \" +\n        \"if current then redis.call('incr', KEYS[1]) else redis.call('set', KEYS[1], 1, 'EX', tonumber(ARGV[2])) end \" +\n        \"return 1\";\n\n    public RateLimitAspect(StringRedisTemplate redisTemplate, HttpServletRequest request) {\n        this.redisTemplate = redisTemplate;\n        this.request = request;\n    }\n\n    // 2. 借助 AOP 切面面向拦截环绕模型 (Around Advice)\n    @Around(\"@annotation(rateLimit)\")\n    public Object enforceLimit(ProceedingJoinPoint joinPoint, RateLimit rateLimit) throws Throwable {\n        String clientIp = request.getRemoteAddr();\n        // 编织生成极具离散性质的防撞库健名拼接\n        String key = \"ratelimit:\" + joinPoint.getSignature().getName() + \":\" + clientIp;\n\n        // 3. 一次下发传输至极速缓存引擎内评估比对放流\n        Long isAllowed = redisTemplate.execute(\n            new DefaultRedisScript<>(LUA_SCRIPT, Long.class),\n            Collections.singletonList(key),\n            String.valueOf(rateLimit.maxCalls()),\n            String.valueOf(rateLimit.timeWindowSeconds())\n        );\n\n        if (isAllowed == null || isAllowed == 0L) {\n            throw new RuntimeException(\"Http 429 Too Many Requests: QPS 超出阀值并执行限控流操作。\");\n        }\n\n        // 透穿防御阵允许直行接入系统耗时底层库服务算力开销核心中\n        return joinPoint.proceed();\n    }\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**纯函数稳定性引用与 Lua 原文嵌入下的多路竞态规避**：\n如果采用普通代码逻辑“先执行 GET 查下数量，再做比对，最后执行 INCR 叠加”，在多节点并行大吞吐狂飙时，这三段离散命令之间的网络时延差必定会导致多个独立线程挤占进入判断前沿造成 “超发或遗漏” 这类典型的并发数据竞态冲突危机。\n而由于 **Redis 实例自身为单操作线核心架构**，当其收到含有 \\`EVAL\\` 标识封装成块的 **Lua 脚本** 进行触发推演计算时，Redis 的指令序列阵列将会视这整片代码为不可分割的一个总体原子指令段并予以绝对占用的锁拥权限，在其推行这段逻辑的一两毫秒切片内，外部系统的一切挤压调用全数挂起后置。这彻底杜绝了多服务器查核时间间隙差。`\n    },\n    {\n        id: 'be-adv-gateway', type: 'backend',\n        title: 'Spring Cloud Gateway 微服务网关',\n        category: '进阶：系统架构与网关安全', track: '后端工程',\n        moduleNumber: 7, lessonNumber: 3, language: 'java',\n        illustrationUrl: '/illustrations/backend_microservices.png',\n        startingCode: '', targetCode: '',\n        instructions: `# 构建微服务边界基石：Spring Cloud Gateway\n\n## 业务上下文\n随着产品功能膨胀，单体被被撕裂成“用户中心”(微服端口 8081)、“计费系统”(8084)、“基础资料库”(8083) 等十几个割裂的局域内网进程服务域。客户端如果分别记忆与各自交互，会导致极度混乱的路由以及不可回避的浏览 CORS 交火风暴。\n作为系统边界的最前沿护城墙阵线，我们将架构部署 **Spring Cloud Gateway**，其在底层运用 \\`Project Reactor\\` 和 \\`Netty\\` 建立的无阻塞非延时异步流向事件管理架构处理所有的前突路由分拨分发，并完成统一授权洗牌梳理。\n\n## 代码与配置解析\n\n\\`\\`\\`java\npackage com.codeforge.gateway;\n\nimport org.springframework.cloud.gateway.route.RouteLocator;\nimport org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\npublic class GatewayRouter {\n\n    // 1. 通过流式构建型 DSL 书写明确系统层总线分发协议\n    @Bean\n    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {\n        return builder.routes()\n            \n            // 2. 划拨定义模块网格切入口。所有向网关打来且形近于 /api/users/** 的包裹全数吸取统合\n            .route(\"user_microservice_route\", r -> r\n                .path(\"/api/users/**\")\n                \n                // 对打向后方的结构进行重写梳理过滤加工。如截肢卸掉外端用于分发的公共前缀：/api\n                .filters(f -> f.stripPrefix(1)) \n                \n                // 无缝对接隐藏并处于深潜状态的独立机群\n                .uri(\"http://localhost:8081\")\n            )\n            \n            // 3. 为打向流量池重区的管线预埋标记性安全信息防伪头信息\n            .route(\"video_microservice_route\", r -> r\n                .path(\"/api/videos/**\")\n                .filters(f -> f\n                    .stripPrefix(1)\n                    // 在请求跨界时段，为其嵌入网关独占识别防伪签名头，借此令内网服务只接受来自它放行的合法通过流量请求\n                    .addRequestHeader(\"X-Gateway-Audited\", \"Verified-Internal-Safe-Level\")\n                )\n                .uri(\"http://localhost:8083\")\n            )\n            .build();\n    }\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**网关体系架构下的 Netty 事件分派无阻塞底座引擎 (NIO 模型) 与反应式编程 (Reactive Programming)**：\n传统的 Tomcat 引擎由于使用的是同步阻塞 IO 容器体系 (BIO) 处理。任何一个打上来的连接都被要求由服务器从珍贵的硬件系统资源池硬割分配开辟一条绝对私有专属 Thread 执行线程从头追尾贯通整个处理链。由于网关层并不从事计算仅充当转发数据层，如果是传统 Tomcat 层压着这成万条处于等待被转发节点回应回复态的死停数据请求流线程池，瞬间内存池就被耗干击穿阻死。\nSpring Cloud Gateway 直接抛置更换基底引擎底盘换上基底搭载具备纯高响应强度的 **Netty** 与 Spring WebFlux。通过使用 NIO 层通过复用事件监测核心 \\`epoll\\` 获取全事件切面消息轮番唤醒执行态，彻底将海量 IO 受困的连接解放悬挂释放出去，仅采用寥寥几根的处理器物理核心数极高压迫高周转的高效分配计算算例模型实现了能跨量级硬吃千万级别 C10K 高压负载量数据泵透传转发的终极极限系统极差设计。`,\n        diagramMarkup: `flowchart TD\n    Frontend[Web / Mobile 客户端层]\n    Gateway{总边界 Spring Cloud Gateway 唯一集入集市层} \n    UserSV[鉴权计费域微服集 (User)]\n    VideoSV[核心物料存储域微服集 (Content)]\n    \n    Frontend -->|GET /api/videos/catalog| Gateway\n    Gateway -->|基于 Predicate 解析与 HTTP 头信息重新解组编排封包再重写剥离| VideoSV\n    Frontend -->|POST /api/users/auth| Gateway\n    Gateway -->|路由转输底层| UserSV`\n    },\n    {\n        id: 'be-adv-graphql', type: 'backend',\n        title: 'Spring GraphQL 构建超级图谱',\n        category: '进阶：系统架构与网关安全', track: '后端工程',\n        moduleNumber: 7, lessonNumber: 4, language: 'java',\n        illustrationUrl: '/illustrations/w3_graphql_1771635760642.png',\n        startingCode: '', targetCode: '',\n        instructions: `# 构建强关联业务下的 GraphQL 组合查询态引擎\n\n## 业务上下文\n遭遇繁芜且关联性极强的内容组群渲染请求时，传统的 REST API 将彻底暴露其固执死板架构设计盲区 —— **过载捞取 (Over-fetching)** 及 **缺失索取 (Under-fetching)** 灾害链。\\n前者致使带宽通道被迫超载下传了上百 KB 用户极根本不调用的无意义如作者传记等长内容串。而后者迫使用户针对深层评论内容要另外向多达数个不同切点重放进行重复网络协议建立请求消耗。\\n接入 **GraphQL** 定义协议，它的强类型层不仅具备提供极精细化定级自取索求的“定制大餐”系统结构，更允许用仅有单单一次 HTTP 指令网络互锁循环传输获得结构繁复杂叠且由不同模块供应汇接的数据信息大图网集。\n\n## 代码与配置解析\n\n\\`\\`\\`java\npackage com.codeforge.video.graphql;\n\nimport org.springframework.graphql.data.method.annotation.Argument;\nimport org.springframework.graphql.data.method.annotation.QueryMapping;\nimport org.springframework.graphql.data.method.annotation.SchemaMapping;\nimport org.springframework.stereotype.Controller;\nimport java.util.Optional;\n\n// 1. 这里是传统 MVC 极度收敛后的表现态\n// 转而全面依托在总集 /graphql 服务下利用特制控制反转路由框架体系解析流进行导向\n@Controller\npublic class VideoGraphController {\n\n    private final VideoRepository repo;\n    private final AuthorService authorService;\n\n    public VideoGraphController(VideoRepository repo, AuthorService authorService) {\n        this.repo = repo;\n        this.authorService = authorService;\n    }\n\n    // 2. 将类比 Rest 的映射转写接入底层构建定义在 resources 下 GraphQL Schema Query\n    @QueryMapping\n    public Optional<VideoEntity> videoById(@Argument String id) {\n        // 进行顶级域数据的根系寻迹搜源获取并直接上抛挂架给 Spring 转化分拣系接手\n        return repo.findById(id);\n    }\n\n    // 3. N+1 解压隔离网路：图谱化深浅连挂的精髓延迟按需激活操作逻辑\n    @SchemaMapping(typeName = \"Video\", field = \"authorDetails\")\n    public Author authorDetails(VideoEntity video) {\n        // 这一刀代码段的隔离屏蔽逻辑保证了：\n        // 唯独并在仅当：客户端利用请求 JSON 参数里面用字面量强硬标指指明向要获取这个节点内部的子集时。此部分代码执行的寻库读取算力方可获得挂架释放命令驱动，这根除一切多余无妄 DB 查询请求开支。\n        return authorService.getAuthorSnapshot(video.getAuthorId());\n    }\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**无状态端点与 DataFetcher 数据分拨解析器的装配原理与按需装填 (Lazy Evaluation)**：\n传统的 REST 引擎下 \\`/api/videos\\` 强制绑定运行一个包含对子节点 SQL 解析等硬连接死锁定全套封装的方法流程。\nGraphQL 对于客户端发下的一串如同嵌套对象结构一样的请求层例如：\\`{ videoById(id: 1) { title, authorDetails { name } } }\\` 的本质。是在服务端运行时建立生成一棵具备极高泛用解析性抽象解析语法树 AST。\n系统底架构通过内置执行图引擎剥丝抽茧层进。\n1. 首先识别最顶端根节点要求命中寻获被 \\`@QueryMapping\\` 引射标注了的 \\`videoById\\` 获取基础基干属性元对象数据。\n2. 内部引擎再往树下潜，发现了具备深层索取要求的 \\`authorDetails\\` 请求配置节点。此时，内部数据处理器模块 （DataFetcher 组）会被精准激活并定向击发由 \\`@SchemaMapping\\` 所标记着专事对接分枝这块代码片段落逻辑补挂装接完成。\n在这极为精密的组接过程中所有未被调用和波及的实体类关联和属性都陷入休眠待分配冷态静默不再启动。这不仅重铸重构了服务数据资源极巨减压降耗消耗的调取方式也赋予客户端绝对零冗余的极度结构完美纯粹收纳集合体会。`\n    }\n];\n"
              },
              {
                "name": "backend-m1-m3.ts",
                "type": "file",
                "path": "frontend/src/data/backend-m1-m3.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const backendM1M3: Lesson[] = [\n    {\n        id: 'be-1-1', type: 'backend',\n        title: '课程 1.1：Spring Boot 3.5.9 SaaS 基础设施',\n        category: '模块1：核心架构与容器启动', track: '后端工程',\n        moduleNumber: 1, lessonNumber: 1, language: 'java',\n        illustrationUrl: '/illustrations/w3_springboot_arch_1771635622918.png',\n        startingCode: '',\n        instructions: `# Spring Boot 3.5.9 与 IoC 容器底层机制\n\n## 业务上下文\n在构建大型企业级后台应用（如视频流媒体系统的用户、支付、分析服务）时，组件之间的强耦合会导致维护成本呈指数级上升。Spring Boot 3.5.9 配合 AOT 编译优化，提供了一套基于控制反转（IoC）的高效解耦方案。作为现代 Java 领域的核心基础设施，它通过在启动时预装配各项自动化配置（Auto-configuration），极大地简化了应用环境的搭建。\n\n## 代码与配置解析\n- **\\`@SpringBootApplication\\`**：这是一个高度组合化的注解，内部聚合了 \\`@Configuration\\`, \\`@EnableAutoConfiguration\\`, 和 \\`@ComponentScan\\`。它指示 Spring Boot 扫描当前包及子包下的所有组件，并尝试根据 \\`pom.xml\\` 中的依赖进行默认的自动化配置（如内嵌 Tomcat 和数据源等）。\n- **\\`@RestController\\`**：这是 \\`@Controller\\` 和 \\`@ResponseBody\\` 的组合注解，标识该类用于开发 RESTful web 服务。返回的 Java 对象将被底层 \\`HttpMessageConverter\\`（如 Jackson）直接序列化为 JSON 格式响应给客户端，而非进行传统的视图模板解析。\n- **\\`SpringApplication.run\\`**：Java 程序的 \\`main\\` 执行入口。调用此方法会触发整个 Spring 容器的上下文初始化，加载并实例化所有的 Bean 组件。\n\n## 底层原理深度剖析\n**IoC（控制反转）与 Bean 生命周期机制：**\n在传统的面向对象编程中，若组件 A 依赖于组件 B，A 需要在内部自行 \\`new\\` 创建 B 的实例，这构成了强耦合。IoC 容器推翻了这种模式，将对象创建与依赖管理的控制权从开发者手中交还给框架。\nSpring 容器在启动时，主要经历两个阶段：\n1. **Bean 定义加载阶段**：通过扫描特定注解（如 \\`@Service\\`, \\`@Component\\`），将这些类的元数据解析为 \\`BeanDefinition\\` 注册到容器。\n2. **实例化与依赖注入（DI）**：通过反射机制调用构造器或工厂方法，统一生存在 \\`BeanFactory\\` 级别的对象池内（默认为单例模式 Singleton）。当其他组件需要使用时，通过构造器注入，将内存中已存在的 Bean 引用无缝关联到该组件，从而构建出松散分离但在运行时又高度聚合的企业级应用大网。\n`,\n        targetCode: `package com.codeforge.video;\\n\\nimport org.springframework.boot.SpringApplication;\\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\\nimport org.springframework.web.bind.annotation.GetMapping;\\nimport org.springframework.web.bind.annotation.RestController;\\n\\n// 启用 Spring Boot 3.5.9 的自动配置机制与组件扫描\\n@SpringBootApplication\\n// 声明 RESTful 接口控制器，默认返回 JSON 数据\\n@RestController\\npublic class VideoSaaSApplication {\\n\\n    // 应用程序入口\\n    public static void main(String[] args) {\\n        SpringApplication.run(VideoSaaSApplication.class, args);\\n    }\\n\\n    // 提供基础的健康检查探针点，方便 Kubernetes 等编排工具探活\\n    @GetMapping(\"/api/health\")\\n    public String healthCheck() {\\n        return \"Video SaaS Backend is Running and Green!\";\\n    }\\n}\\n`,\n        comments: [\n            { line: 9, text: '// 初始化 Spring 引擎与上下文环境' },\n            { line: 11, text: '// 为前后端分离架构提供 API 响应支持' },\n            { line: 19, text: '// 声明简单的存活与就绪状态探针' },\n        ],\n    },\n    {\n        id: 'be-1-2', type: 'backend',\n        title: '课程 1.2：三层架构与 MyBatis 动态持久化',\n        category: '模块1：核心架构与容器启动', track: '后端工程',\n        moduleNumber: 1, lessonNumber: 2, language: 'java',\n        illustrationUrl: '/illustrations/backend_microservices.png',\n        startingCode: '',\n        instructions: `# 经典三层架构与 MyBatis 持久化机制\n\n## 业务上下文\n在复杂的企业工程中，如果将参数校验、业务逻辑处理、数据库调用全部耦合在 Controller 层，会形成极差的架构反模式。为了实现职责分离与高度可维护性，应用通常遵循标准的三层架构：**Controller 层（接口分发与校验） -> Service 层（核心业务逻辑处理） -> Mapper/DAO 层（数据持久化）**。本应用采用轻量级框架 MyBatis 处理与关系型数据库的通信。\n\n## 代码与配置解析\n- **\\`@Mapper\\` 或 Mapper 接口**：声明用于数据库操作的接口。不需要手工编写实现类，只需添加诸如 \\`@Select\\` 这样的注解或配合 XML 映射文件来定义 SQL 执行语句。\n- **\\`@Service\\` 与构造器注入**：标识业务逻辑层类。采用现代 Spring 推崇的构造器注入模式，取代字段级别的依赖注入，这不仅有利于编写单元测试，也彻底杜绝了注入循环依赖的问题。\n- **防注入预编译机制**：在 MyBatis 的注解里使用 \\`#{username}\\`，底层会将其转换为 JDBC 标准的 \\`PreparedStatement\\` 中的占位符 \\`?\\`，从而在驱动级别防范常见的 SQL 注入攻击。\n\n## 底层原理深度剖析\n**MyBatis 的 JDK 动态代理机制如何简化持久层开发？**\n在传统的 JDBC 中，开发者需要手工获取连接、编写 SQL、设置参数并执行、然后遍历 \\`ResultSet\\` 手动做对象映射，同时必须管理连接关闭。\nMyBatis 将这些样板代码高度封装。当 Spring Boot 与 MyBatis 整合并在启动阶段时，MyBatis 利用 Java 的动态代理机制（如 \\`Proxy.newProxyInstance\\`），在内存中动态生成了一个实现了 \\`UserMapper\\` 接口的代理对象，并注册到 Spring IoC 容器中。\n当请求在运行时调取 \\`findByUsername\\` 时，执行流会被切入代理类的 \\`InvocationHandler.invoke()\\` 方法中，该方法解析对应方法上的元信息与绑定的 SQL，将 \\`#{}\\` 参数化处理，并向底层的 HikariCP 连接池申请连接执行查询，最终通过反射机制自动完成从数据行到实体对象字段的值映射，这就是现代化半自动 ORM 的核心原理。\n`,\n        targetCode: `package com.codeforge.video.user;\\n\\nimport org.apache.ibatis.annotations.Mapper;\\nimport org.apache.ibatis.annotations.Select;\\nimport org.springframework.stereotype.Service;\\nimport org.springframework.web.bind.annotation.GetMapping;\\nimport org.springframework.web.bind.annotation.PathVariable;\\nimport org.springframework.web.bind.annotation.RestController;\\n\\n// [Mapper层]：映射数据库操作接口\\n@Mapper\\npublic interface UserMapper {\\n    // 采用预编译 PreparedStatement 防范 SQL 注入\\n    @Select(\"SELECT * FROM users WHERE username = #{username}\")\\n    UserEntity findByUsername(String username);\\n}\\n\\n// [Service层]：业务逻辑统一处理层\\n@Service\\npublic class UserService {\\n    private final UserMapper userMapper;\\n\\n    // 推荐使用构造器注入依赖，以确保对象创建时即处于稳固的安全状态\\n    public UserService(UserMapper userMapper) {\\n        this.userMapper = userMapper;\\n    }\\n\\n    public UserEntity getUserData(String username) {\\n        return userMapper.findByUsername(username);\\n    }\\n}\\n\\n// [Controller层]：HTTP 接口层，负责请求接受与响应\\n@RestController\\npublic class UserController {\\n    private final UserService userService;\\n\\n    public UserController(UserService userService) {\\n        this.userService = userService;\\n    }\\n\\n    // 路径变量映射提取参数\\n    @GetMapping(\"/api/users/{username}\")\\n    public UserEntity getUserByUsername(@PathVariable String username) {\\n        // 将请求转发至业务层，实现层级分离\\n        return userService.getUserData(username);\\n    }\\n}\\n`,\n        comments: [\n            { line: 12, text: '// MyBatis 生成动态代理简化持久层代码' },\n            { line: 20, text: '// 业务层统筹跨模块的复合逻辑业务' },\n            { line: 34, text: '// 暴露 REST 接口供前端调用' },\n            { line: 43, text: '// 控制层不涉及处理实际的底层逻辑' },\n        ],\n    },\n    {\n        id: 'be-2-1', type: 'backend',\n        title: '课程 2.1：AOP 拦截器与 JWT 无状态认证',\n        category: '模块2：安全屏障与无状态扩展', track: '后端工程',\n        moduleNumber: 2, lessonNumber: 1, language: 'java',\n        illustrationUrl: '/illustrations/w3_jwt_auth_1771635695409.png',\n        startingCode: '',\n        instructions: `# AOP 拦截器机制与 JWT 无状态认证架构\n\n## 业务上下文\n在基于 RESTful 与前后端分离的 SaaS 后端集群中，为了保持微服务的高扩展性，系统摒弃传统的基于 Session 的状态管控体系，改用无状态的 JWT (JSON Web Token) 进行认证。\n面对成千上万受保护的内网 API 接口，若在每个业务方法中硬编码校验 Token 的逻辑，不仅造成重复冗余，更极易因遗漏导致越权漏洞。利用 Spring 的 \\`HandlerInterceptor\\`，可以在请求触达 Controller 之前实现一站式的集中身份鉴权。\n\n## 代码与配置解析\n- **\\`HandlerInterceptor\\` 接口**：用于实现横切关注点的轻量级手段。重写 \\`preHandle\\` 方法，这是由于请求在路由完毕后但尚未调用 Handler 之前触发。返回 \\`true\\` 则放行，返回 \\`false\\` 则拦截响应。\n- **\\`Jwts.parser()\\` 验签拦截**：系统提取请求头中的 \\`Authorization\\` 字段内容，然后通过配置的机密密钥 (\\`SECRET_KEY\\`) 对令牌的内容进行合法性算力校验。一旦签名验证不通过即触发 \\`JwtException\\`。\n- **请求属性 \\`setAttribute\\` 传递**：基于 HTTP 解析完成的数据会在同一次请求生命周期的线程中流通。将签发者解析出存入 request，方便后续的业务流程直接从环境中获取该身份。\n\n## 底层原理深度剖析\n**AOP (面向切面编程) 范式的工程化应用：**\nInterceptor 属于 AOP 设计思想的体现。AOP 的核心在于横切关注点隔离（Cross-cutting concerns）。不论是认证验签、全局日志记录还是链路追踪，这些逻辑都与具体的业务逻辑无关。通过将其抽离封装并在执行流截面切入，可在保持主干业务对象的专一内聚性的同时叠加防护层。\n\n**JWT 的无状态特性与 HMAC-SHA256 签名机制：**\n无状态 JWT 抛弃了服务端的映射存储需求。它的核心依赖哈希摘要运算。服务器端会在客户端登录时将基础用户标识封装为 JSON 字符串并结合内网密钥计算出密文签名（Signature）发送回去。\n随后的每次请求里，服务端收到 Token 后只需要对其明文负载部分用相同的 \\`SECRET_KEY\\` 进行单向摘要重新计算一遍，若得出的签名结果与发来的尾部串字符完全匹配，即可在数学上证明：此 Token 未曾遭到伪造或中间人篡改。这就是 JWT 保障横向扩张的计算学基石。\n`,\n        targetCode: `package com.codeforge.security;\\n\\nimport io.jsonwebtoken.Claims;\\nimport io.jsonwebtoken.Jwts;\\nimport io.jsonwebtoken.SignatureException;\\nimport io.jsonwebtoken.JwtException;\\nimport org.springframework.stereotype.Component;\\nimport org.springframework.web.servlet.HandlerInterceptor;\\nimport jakarta.servlet.http.HttpServletRequest;\\nimport jakarta.servlet.http.HttpServletResponse;\\n\\n// 建立全局请求拦截层，用于集中身份鉴权\\n@Component\\npublic class JwtAuthInterceptor implements HandlerInterceptor {\\n    \\n    // 服务端持有的机密私钥，用于 HMAC-SHA256 哈希计算\\n    private static final String SECRET_KEY = \"YourSuperSecretEnterpriseGradeKeyForSaaSApplication\";\\n\\n    @Override\\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\\n        String header = request.getHeader(\"Authorization\");\\n\\n        // 初步验证携带的基础头信息格式\\n        if (header == null || !header.startsWith(\"Bearer \")) {\\n            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\\n            return false;\\n        }\\n\\n        String token = header.substring(7);\\n        try {\\n            // 基于安全密钥的强制验签与声明解析\\n            Claims claims = Jwts.parser()\\n                .setSigningKey(SECRET_KEY.getBytes())\\n                .parseClaimsJws(token)\\n                .getBody();\\n\\n            // 萃取身份实体并置入当前请求上下文中透传\\n            request.setAttribute(\"userId\", claims.getSubject());\\n            return true; \\n        } catch (JwtException e) {\\n            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\\n            return false;\\n        }\\n    }\\n}\\n`,\n        comments: [\n            { line: 12, text: '// Web 层的集中切面拦截处理' },\n            { line: 15, text: '// 加密与验证的核心共享盐值' },\n            { line: 30, text: '// 校验签名合法性，失败则直接中断链式处理' },\n            { line: 36, text: '// 透传安全上下文数据给底层业务控制层' },\n        ],\n    },\n    {\n        id: 'be-2-2', type: 'backend',\n        title: '课程 2.2：Redis 高频热点缓存层',\n        category: '模块2：安全屏障与无状态扩展', track: '后端工程',\n        moduleNumber: 2, lessonNumber: 2, language: 'java',\n        illustrationUrl: '/illustrations/w3_redis_cache_1771635654039.png',\n        startingCode: '',\n        instructions: `# Redis 缓存体系与 LRU 淘汰机制\n\n## 业务上下文\n在高并发的短视频和电商系统中，读多写少是典型的系统特性。如果超高 QPS 流量全部透穿命中到底层基于磁盘存储的关系型数据库 (\\`MySQL\\`)，会引发现象级的系统资源耗尽。\n引入 **Redis** 构建缓冲体系，能够大幅度接管前序查询，其基于物理内存级的 IO 将使接口响应呈几个数量级跃升。\n\n## 代码与配置解析\n- **\\`@Cacheable\\`（读命中）**：Spring Data Cache 的声明式注解。在执行具体的方法体入库查询前，系统会在 Redis 缓冲层根据设定好的命名空间与 \\`key\\`（缓存主键）探寻是否已存有数据。若存在则直接返回阻断下层查询，反之则将方法实际计算结果回填入缓存池供下次读取。\n- **防碰撞命名**：如定义 \\`value = \"video\"\\`，系统实际将存储在类似 \\`video::123\\` 这样的唯一前缀空间内，避免在大容量库中的 ID 杂乱。\n- **\\`@CachePut\\`（双写刷新）**：应用于内容更新与保存方法上。不仅持久化到硬盘数据库中，还通过对应 Key 刷新 Redis 中的旧缓存条目。这是解决后端数据一致性架构的基础方案之一。\n\n## 底层原理深度剖析\n**Redis 为何能以单线程模型实现 10 万 QPS 并发？**\n由于 Redis 的操作主要涉及内存变量读写，单个 CPU 的寻址指令已经达到了纳秒级极速范畴。为了避免高昂的多线程调度上下文频繁切换损耗以及锁块开销，Redis 内核坚持采用 **单核线程 + 多路 I/O 复用机制**（即底层操作系统支持的 \\`epoll\\` 事件分发）来统辖大批量的 TCP 套接字状态变更。在这种模型下，每个核心指令操作都是原子的单线序，榨干了单点架构的吞吐量并避免了资源竞争报错。\n\n**缓存容量限制与 LRU 回收机制设计：**\n内存是极为昂贵的稀缺计算资源，无法留存全部宽泛数据。Redis 配置有数据驱逐机制来释放溢出空间，常见的做法是 **LRU (Least Recently Used，最近最少使用算法)**。\n当启动内存回收策略时，系统内部会为维护每个缓存条目的最近触发访问时间戳标记。当占用容量趋于设定峰值导致预警，Redis 引擎根据这些时间信息将长时间未被重用的冷端尾部数据进行精准销毁回收，保障缓存队列中主要吸纳和存储最具业务价值的高频热点数据。\n`,\n        targetCode: `package com.codeforge.video.service;\\n\\nimport org.springframework.cache.annotation.Cacheable;\\nimport org.springframework.cache.annotation.CachePut;\\nimport org.springframework.stereotype.Service;\\n\\n// 采用缓存服务阻隔底层 DB 压力\\n@Service\\npublic class VideoCacheService {\\n\\n    private final VideoRepository videoRepository;\\n\\n    public VideoCacheService(VideoRepository videoRepository) {\\n        this.videoRepository = videoRepository;\\n    }\\n\\n    // 查询优化：在进入 IO 瓶颈点前由 AOP 层基于键值检索内存\\n    @Cacheable(value = \"video\", key = \"#id\")\\n    public VideoEntity getVideoInfo(String id) {\\n        \\n        System.out.println(\"发生缓存穿透现象，触发源磁盘库读取操作: \" + id);\\n        return videoRepository.findById(id).orElse(null);\\n    }\\n\\n    // 缓存一致性：执行源数据强制更新并双写至内存库体系\\n    @CachePut(value = \"video\", key = \"#video.id\")\\n    public VideoEntity updateVideoInfo(VideoEntity video) {\\n        System.out.println(\"落库写盘同时推送刷新缓存域以同步实时内容: \" + video.getId());\\n        return videoRepository.save(video);\\n    }\\n}\\n`,\n        comments: [\n            { line: 19, text: '// 以极低的延迟代价拦截超过 90% 的穿透调用逻辑' },\n            { line: 23, text: '// 后台日志如果没有打印，则代表实现了高速纯缓存命中读取' },\n            { line: 28, text: '// 置换写入更新，消除数据存在的新旧背离风险' },\n        ],\n    },\n    {\n        id: 'be-3-1', type: 'backend',\n        title: '课程 3.1：Kafka 事件驱动与解耦',\n        category: '模块3：事件驱动与异步通信', track: '后端工程',\n        moduleNumber: 3, lessonNumber: 3, language: 'java',\n        illustrationUrl: '/illustrations/w3_kafka_events_1771635638993.png',\n        startingCode: '',\n        instructions: `# Kafka 事件驱动架构的高并发解耦\n\n## 业务上下文\n在现代微服务演进中，若某核心干流（如用户注册）需要同步调用众多衍生流程（例如发送通讯邮件、发放奖励、安全审计等），将导致整个请求处理链路极度拉长。任何外围服务的宕机都会引发业务的全盘异常失败。\n引入 **事件驱动架构 (Event-Driven Architecture)**，使用高吞吐量消息中间件 **Apache Kafka** 担任系统中央事件总线枢纽。系统从直接的 RPC 级联调度转变为发布-订阅模型，使得微服务环境拥有极高的弹性解耦与容灾缓冲。\n\n## 代码与配置解析\n- **\\`KafkaTemplate.send()\\`**：发起端的事件声明。将系统结构化的信息派发至既定的逻辑频道（Topic）。该动作非阻塞并且执行迅捷，它不再关注或等待后续子流程完成状况，去除了直接同步调用造成的线程积压。\n- **\\`@KafkaListener\\`**：各独立的下游消费服务通过持久化长连 Kafka 通道监听，即使遇到某个网络接收节点宕机重启，它们仍会在重启后按照 Kafka 保留的 Offset 游标位置重新拉取累积消息执行补偿，不间断恢复任务。\n\n## 底层原理深度剖析\n**传统 MQ 的吞吐瓶颈与 Kafka 的 Append-Only 顺序写及预读机制**\n许多早期的队列引擎直接将重度负载保存在非连续的磁盘指针甚至内存易丢失介质中。而 Kafka 是以高持久度磁盘为核心载体的海量级别日志系统。由于机械硬盘对顺序写入操作非常友好（大大缩短了不必要的物理寻道及跳转时间），Kafka 强制规定每个 Partition 日志采用 **Append-Only（仅后向连续追加）** 存储结构，结合内核高级别 PageCache 处理读写缓冲，令它的极大数据写入性能甚至直接比肩其它引擎单在普通内存中的运转效率指标。\n\n**Zero-Copy 零拷贝实现网卡流投递的性能飞跃**\n在下放投递环节，Kafka 没有传统应用那种【磁盘 -> 内核层 -> 进程内存层 -> 内核层Socket -> 网卡】的高衰缩开支拷贝。它依赖底层调用 \\`sendfile()\\` 等原语手段进行物理直接挂接通信，让读取的事件文件集流直接穿透到内核的传输缓冲，大大节约了 CPU 的多层态搬迁工作负载。\n\n**消费者群组（Consumer Group）实现分流并行**\n面对同一个业务 Topic，不同的下游消费群需要通过设定互异的 Group ID 获取数据拷贝（如：计费集群和风控集群互相平行获取整全信息）。若是同功能且同属于一个消费组，事件流负载会根据组内的在线机器实例进行拆散互斥分发，使得集群不仅实现模块级别功能隔离，同样支撑多态纵深水平拉伸部署架构。\n`,\n        targetCode: `package com.codeforge.events;\\n\\nimport org.springframework.kafka.core.KafkaTemplate;\\nimport org.springframework.kafka.annotation.KafkaListener;\\nimport org.springframework.stereotype.Service;\\n\\n// 事件发布端：削减主干系统的调用树依赖\\n@Service\\npublic class UserRegistrationService {\\n\\n    private final KafkaTemplate<String, String> kafkaTemplate;\\n\\n    public UserRegistrationService(KafkaTemplate<String, String> kafkaTemplate) {\\n        this.kafkaTemplate = kafkaTemplate;\\n    }\\n\\n    public void completeUserRegistration(String userId) {\\n        // 1. 完成系统内主域数据持久入库等高优必须动作\\n        System.out.println(\"源发地领域实体保存完成归档: \" + userId);\\n\\n        // 2. 将事件广播至全局领域边界总线频道中：将衍生计算投递至异构池\\n        kafkaTemplate.send(\"user-registration-events\", userId);\\n    }\\n}\\n\\n// 事件订阅端：高度自治并行的消费端下游实例处理\\n@Service\\npublic class AsyncNotificationListeners {\\n    \\n    // 基于特定消费分组配置监听群：独立派发相关通知资源\\n    @KafkaListener(topics = \"user-registration-events\", groupId = \"email-marketing-group\")\\n    public void sendWelcomeEmailStrategy(String userId) {\\n        System.out.println(\"进入独立系统队列处理分片: 发发邮件推送处理指向 - \" + userId);\\n    }\\n\\n    // 依托旁路逻辑消费分组，获取独立偏移量进度：进行审计日志计算\\n    @KafkaListener(topics = \"user-registration-events\", groupId = \"anti-fraud-security-group\")\\n    public void checkBlackListActivity(String userId) {\\n        System.out.println(\"启动独立风险计算侦测线程: 实施数据采集评估信誉 - \" + userId);\\n    }\\n}\\n`,\n        comments: [\n            { line: 20, text: '// 解耦：异步非阻塞派发总线广播消息，快速从方法栈回退' },\n            { line: 31, text: '// 定义群组名称使得订阅方可以在横向集群层面平均分配执行负载' },\n            { line: 38, text: '// 不同的 group ID 相互完全平行的截取所有事件广播序列不受他者打断' },\n        ],\n    },\n];\n"
              },
              {
                "name": "backend-m4-m6.ts",
                "type": "file",
                "path": "frontend/src/data/backend-m4-m6.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const backendM4M6: Lesson[] = [\n    {\n        id: 'be-4-1', type: 'backend',\n        title: '课程 4.1：微服务 Saga 跨库事务（购买会员）',\n        category: '模块4：分布式事务与容错', track: '后端工程',\n        moduleNumber: 4, lessonNumber: 1, language: 'java',\n        illustrationUrl: '/illustrations/w3_microservices_saga_1771635780394.png',\n        startingCode: '',\n        instructions: `# Saga 编排与分布式跨库事务\n\n## 业务上下文\n在单体架构中，购买“打赏特效套餐”涵盖扣减余额与发放特权两个步骤，可通过一个 \\`@Transactional\\` 注解依托本地数据库的 ACID 特性保证原子性。\n但在微服务架构中，计费服务和特权服务分别拥有独立的内网数据库实例。如果计费服务成功扣款后，特权服务由于网络分区或宕机导致发放失败，就会产生严重的数据不一致问题。为此，我们引入 **Saga 状态机模式与 Kafka 事件驱动引擎** 进行分布式容错与最终一致性补偿（Compensation）。\n\n## 代码与配置解析\n- **主叫方发流 \\`initiateVipPurchase\\`**：首先在一个本地 \\`@Transactional\\` 的包裹下完成安全的本域数据扣款操作。随后，向 Kafka 总线发射一个异步事件包裹（如 \\`vip-grant-requests\\`），通知下游服务推进后续流程。\n- **顺位接收执行点 \\`grantVipAccess\\`**：下游特权管理服务截取事件后执行本地的发放操作。如果在此阶段捕捉到系统内部报错或网络连接断裂导致发放授权失败，必须在 \\`Catch\\` 块中主动对外发出一封逆向的补偿追回事件（如 \\`vip-refund-compensation\\`）。\n- **终极逆流补偿 \\`executeRefund\\`**：作为最开始的资金扣流发起方，一旦监听到退单信息，立即启动与最初 \\`扣款\\` 行为具有相反属性的补账回滚逻辑 —— \\`退款补偿\\`。通过这套正反向的机制组合达到最终业务平齐。\n\n## 底层原理深度剖析\n**CAP 定理与传统两阶段提交（2PC）的瓶颈**\n分布式系统面临 CAP 定理（一致性、可用性、分区容错性无法同时绝对满足）的限制。若采用传统的 2PC 或 XA 全局事务强锁机制，所有参与的子系统必须等待统一的协调者发送提交指令。这在网络存在高延迟抖动的微服务跨库调用的场景下，极易导致大面积的数据库线程持锁不释放，从而在并发洪峰中拖垮整个系统集群的吞吐瓶颈。\n\n**Saga 柔性事务（最终一致性）的本质**\nSaga 属于 BASE 理论的典型实践，它放弃了追求强一致性的锁定开销，容忍各个独立服务在执行中间态那零点几秒的“不一致真空”窗口流产生。\n在微服务环境中，这依赖极度坚固的重试队列（Retry）与回拨对冲（Compensation）链路。即使经历网络故障，在修复后系统也能依靠订阅尚未被签收（Acknowledge）的事件消息执行自动的补账对冲，最终使数据走向总账平齐的收敛状态（**Eventual Consistency**）。这是大型电商和金融系统处理高并发分布式容灾架构唯一的标准方案。\n`,\n        targetCode: `package com.codeforge.payment.saga;\\n\\nimport org.springframework.kafka.core.KafkaTemplate;\\nimport org.springframework.kafka.annotation.KafkaListener;\\nimport org.springframework.stereotype.Service;\\nimport org.springframework.transaction.annotation.Transactional;\\n\\n// 跨越多个微服务模块的 Saga 补偿组合模式\\n@Service\\npublic class VipSubscriptionSaga {\\n\\n    // ...省略依赖注入代码\\n\\n    // [核心发源地：计费模块] 用户付款逻辑\\n    @Transactional\\n    public void initiateVipPurchase(String userId, double amount) {\\n        // 保持本地数据库事务原子性\\n        paymentRepository.deduct(userId, amount);\\n        System.out.println(\"用户账单已发生本地结算: \" + userId);\\n        \\n        // 放出异步事件流向下一环节解耦\\n        kafkaTemplate.send(\"vip-grant-requests\", userId);\\n    }\\n\\n    // [流转节点：特权发放集群] 独立于计费环境的微服务\\n    @KafkaListener(topics = \"vip-grant-requests\")\\n    public void grantVipAccess(String userId) {\\n        try {\\n            // 执行特权发放\\n            userRepository.makeVip(userId);\\n            System.out.println(\"成功下发特权标识并更新数据库态\");\\n        } catch (Exception e) {\\n            // 出现网络等异常时，极其关键的补救策略启动\\n            System.err.println(\"特权写入操作抛出异常，发射补偿拦截事件执行平账\");\\n            kafkaTemplate.send(\"vip-refund-compensation\", userId);\\n        }\\n    }\\n\\n    // [逆向流：计费模块] 接收补偿信号后的防滑回退\\n    @KafkaListener(topics = \"vip-refund-compensation\")\\n    public void executeRefund(String userId) {\\n        // 精确对冲撤销上游失效带来的错误写库影响\\n        System.out.println(\"执行对冲回退指令，补偿被误扣的额度: \" + userId);\\n        paymentRepository.refund(userId, 9.99);\\n    }\\n}\\n`,\n        comments: [\n            { line: 16, text: '// 此环节享有 RDBMS 原生的 ACID 本地保护' },\n            { line: 26, text: '// 网络分层架构下容易发生超时或连接拒绝的高危点' },\n            { line: 36, text: '// 此层逻辑必须保证幂等性（Idempotency）以防重试过度' },\n        ],\n    },\n    {\n        id: 'be-4-2', type: 'backend',\n        title: '课程 4.2：Resilience4j 断路器与雪崩防治',\n        category: '模块4：分布式事务与容错', track: '后端工程',\n        moduleNumber: 4, lessonNumber: 2, language: 'java',\n        illustrationUrl: '/illustrations/backend_microservices.png',\n        startingCode: '',\n        instructions: `# Resilience4j 断路器与雪崩效应防治\n\n## 业务上下文\n在多层次交织的微服务请求网格中，如果处在调用链最底端的边缘算法模块（如个性化推荐）由于逻辑缺陷产生响应大面积超时，不断涌入的前置 API 流量会使得其 Tomcat 内的核心承载线程悉数阻塞。在短时间内，主集群将由于被全部拖累而发生全局服务器连接宕机，这被称为**系统雪崩（Cascading Failures）**。\n我们需要引入容错中间件 \\`Resilience4j\\` 为每个不具备绝对可靠性的远端调用配置熔断机制。若探知下游错误率超标，即时切断路由防止级联拖死。\n\n## 代码与配置解析\n- **\\`@CircuitBreaker\\` 熔断注记**：声明阻断探测规则。如果被修饰调用的外部方法频繁报错或者超出时限，它将在请求触达前实现物理层面的瞬间阻回。\n- **降级后手策略 \\`fallbackMethod\\`**：在网络链路被截断后，设计者不应允许该异常溢出导致前端的白屏显示。通过指向一个通用的降级预案方法（如返回静态预置榜单数据），系统能在保留核心流运行顺畅的同时，在终端降阶性维持基础可用。\n\n## 底层原理深度剖析\n**熔断闭合与探活试探的有限状态机模型 (State Machine)**\n熔断器内核依托一个以时间环路感知的精算状态机进行动态切换：\n1. **闭合（Closed）**：系统的健康原始态。流量进行常规放行，后台统计并监控拦截执行过程中的 HTTP 错误率。\n2. **断开（Open）**：当错误率触碰预设红线阈值（如 >50%），状态机切开阻断器。后续所有试图进入的请求将直接在框架内存层被抛出 \\`CallNotPermittedException\\` 并路由进指定的 fallback 方法。此时，不稳定的远端服务得到充分的喘息空间以避免被持续压垮。\n3. **半开试探模式（Half-Open）**：断路器带有智能化的复苏设计。在经过一段缓冲的休眠时间（如 30 秒）后，系统会放入限制次数的探测请求。如果样例测试发现依然在超时或报错，则立刻降回 Open 态继续防卫挂起：如果探测通过且耗时修复至正常基准，则解除武装恢复至原始的 Closed 全挂载通道运作。\n`,\n        targetCode: `package com.codeforge.resilience;\\n\\nimport io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;\\nimport org.springframework.stereotype.Service;\\n\\n@Service\\npublic class FeedAggregatorService {\\n\\n    private final RecommendationClient recommendationClient;\\n\\n    public FeedAggregatorService(RecommendationClient recommendationClient) {\\n        this.recommendationClient = recommendationClient;\\n    }\\n\\n    // 断路器配置：\"recommendation\" 策略判定错误率越界时自动跳开拦截\\n    // 熔断抛错全平滑过度至 fallbackMethod 进行降级输出着陆\\n    @CircuitBreaker(name = \"recommendation\", fallbackMethod = \"fallbackForRecommendations\")\\n    public String getPersonalizedFeed(String userId) {\\n        \\n        // 被纳入监控包的危险第三方长跨度请求\\n        System.out.println(\"向远程服务层调集特征模型，可能遭遇网络延迟现象...\");\\n        return recommendationClient.fetch(userId);\\n    }\\n\\n    // 后备高可用兜底池：保证核心页框能在服务劣化的时候呈现默认内容\\n    public String fallbackForRecommendations(String userId, Throwable t) {\\n        System.err.println(\"熔断器开启态或下游失联：启用纯本地静态通用榜单配置防连带中断\");\\n        return \"[应用端默认排行榜]：个性化服务临时故障，为您显示通用内容...\";\\n    }\\n}\\n`,\n        comments: [\n            { line: 16, text: '// 设置状态机拦截从而保护上级连接线程不被阻塞挂起' },\n            { line: 20, text: '// 若该远程调用失败频繁，将被系统暂时阻断' },\n            { line: 25, text: '// 服务降级（Service Degradation）最佳实践之一' },\n        ],\n    },\n    {\n        id: 'be-5-1', type: 'backend',\n        title: '课程 5.1：Micrometer 与全链路遥测追踪',\n        category: '模块5：高维可观测与链路审计', track: '后端工程',\n        moduleNumber: 5, lessonNumber: 1, language: 'java',\n        illustrationUrl: '/illustrations/backend_microservices.png',\n        startingCode: '',\n        instructions: `# 全链路分布式追踪 TraceId 遥测体系\n\n## 业务上下文\n在涉及微服务多链条转发的生产故障排查中，如果一个用户支付请求先后流转了【网关】->【计费发账】->【关联库存】等多台节点，并发生了 \\`500 Error\\`。若要在多台主机的异构日志中手动关联并排查该链路中断点，将是极端的工程挑战。\n通过集成 **Micrometer Tracing 整合全链路遥测协议（OpenTelemetry）** ，我们可以配置后端在同一条请求的所有层面上打入共享关联上下文，使得穿贯整个生命周期的链路图谱能够在日志平台中集中显影闭环。\n\n## 代码与配置解析\n- **\\`TraceId\\` 与 \\`SpanId\\` 体系**：一次完整的访问流程对应一串全局唯一的辨识 TraceId (如 \\`0b64d...\\`)。沿途每一次 RPC 切口和微服务执行单元都会被加赠一条基于节点生命周期的 \\`SpanId\\`。这就形成了一个树状有向流程脉络解决跨机定位问题。\n- **向 MDC 自动写入属性层 (Mapped Diagnostic Context)**：高度依赖于 Logback 与 Micrometer 内部集成的环境拦截注入支持。开发者无需显式在方法间传递 Id 或记录逻辑声明，常规的 \\`log.info(\"生成订单\")\\` 操作会在底层结合拦截器和格式模板，被自动追加并打印为带有标识符的完整记录：\\`[backend-app, 0b64d..., span-1...] 生成订单\\`。\n\n## 底层原理深度剖析\n**跨机的 HTTP Headers 协议接力与单机的线程本地化传递：**\n为保障遥测信息能在不同物理机器和内部运行空间中被准确维系接力传递：\n1. **边界跨越网络**：在使用 \\`RestTemplate\\`, \\`FeignClient\\` 或 \\`WebClient\\` 对外发起网络交换时，系统切面机制会在报文的 \\`HTTP Headers\\` 层面自动注入并遵守 \\`B3-Propagation\\` 或 \\`W3C Trace Context\\` 的格式协定（例如写入参数 \\`tx-trace-id: 0b64dc...\\`）。\n2. **域内运转与并发分离**：次级服务的网关获取到报文标识头信息并拆解保存。该环节充分利用了 Java 线程强隔离架构 **MDC 模式 (底层依托 ThreadLocal)** 实现存储。其负责将获取到的字串信息单独赋予到分配给当前用户请求的处理线程上进行隔离。在生命周期期间所有执行的下游 DAO 调用乃至捕获出的堆栈打印，都会通过 AOP 或字节代理等模式主动访问并提取挂靠的唯一识别符。这些结构化附带识别位的海量监控碎片最终通过 Agent 同步输送至集中式的大规模观测管理体系（如 Zipkin）。\n`,\n        targetCode: `package com.codeforge.observability;\\n\\nimport org.slf4j.Logger;\\nimport org.slf4j.LoggerFactory;\\nimport org.springframework.web.bind.annotation.GetMapping;\\nimport org.springframework.web.bind.annotation.RestController;\\n\\n// 依赖 pom 集成的 micrometer 无侵入地监控应用调用链\\n@RestController\\npublic class ObservabilityController {\\n\\n    // 借助原生日志记录器输出即可自动绑定链路核心参数\\n    private static final Logger log = LoggerFactory.getLogger(ObservabilityController.class);\\n\\n    @GetMapping(\"/api/checkout/heavy-process\")\\n    public String complexCheckoutProcess() {\\n        \\n        // 在控制台查看日志输出形式将被自动包裹附加 Trace 上下文特征：\\n        // [backend-app, 7d81cc23f..., d9a3b...] 1. 开始校验订单信息特征...\\n        log.info(\"1. 开始校验订单信息特征...\");\\n        \\n        // 模拟执行链路上的重度资源访问延迟\\n        doHardWork();\\n\\n        log.info(\"2. 核对完毕通过。结账节点发送结果成功落盘。\");\\n        return \"Checkout traced completely successful.\";\\n    }\\n\\n    private void doHardWork() {\\n        try { \\n            Thread.sleep(500); \\n        } catch(InterruptedException ignored){}\\n    }\\n}\\n`,\n        comments: [\n            { line: 15, text: '// 代码逻辑解耦，底层代理机制完成上下文字串投递' },\n            { line: 24, text: '// 日志将按照模板设置定向吐出给集中式链路分析层' },\n            { line: 36, text: '// 同一线程调用栈深处发生的任何输出将与此标识强行关联绑定' },\n        ],\n    },\n    {\n        id: 'devops-m6-1', type: 'backend',\n        title: '课程 6.1：Docker 底层核心多阶段全构建',\n        category: '模块6：极致容器编排与环境脱离', track: 'DevOps & Cloud Native',\n        moduleNumber: 6, lessonNumber: 1, language: 'dockerfile',\n        illustrationUrl: '/illustrations/devops_deployment.png',\n        startingCode: '',\n        instructions: `# 容器多阶段构建与云原生环境隔离\n\n## 业务上下文\n\"在我本地运行正常\" 是阻碍团队异构网络节点部署交付的公认顽疾。传统应用程序在推向线上主机由于底层操作内核模块、共享链接库以及环境变量配置不齐常常导致启动异常。\n**Docker 容器引擎**将整套执行库和依赖生态打包整合进入标准化快照生态。业界生产环节更推崇：**多阶段分层构建 (Multi-Stage Builds)**。极度压缩去除测试套件和庞大的源头编译组件，向线上仅输送出几兆极尽轻量的高性能镜像。\n\n## 代码与配置解析\n- **基础构建环 \\`AS builder\\`**：在 Dockerfile 首个阶段引入全尺寸镜像源，包括所有编译所需的 CLI 工具及巨大的包管理器 \\`node_modules\\` 库。并进行高负荷的资源集成，打出待转移的生成产物（如 React 构建出的前端资源 \\`dist/ \\`）。\n- **第二阶段薄核级运行层**：再次书写 \\`FROM\\` 时，调用一个如 \\`alpine\\` 型只余几十兆内核体积的高净低耗版本 OS 层。\n- **\\`COPY --from=builder\\` 文件迁移**：跨边界提取。系统从首个阶段截获烧编译完成的 \\`dist\\` 构建制品，迁移拷贝进新建的无尘环境内进行集成。如此，下发的生产实例彻底抛离了高达数 G 的多余调试套件，使镜像传输及启动分配节点的耗时极速跌落缩减而且防范了源代码的安全泄漏危险。\n\n## 底层原理深度剖析\n**Namespace 进程资源隔离与 Cgroups 阈值切分**\n相较于传统的主机级完全硬件虚拟化技术模型（如 VMWare），其系统启动时间极长并严重占用了上百兆宿主机无谓 RAM 开销以挂载客户机内核进程。\nDocker 直接共享使用了基于主机现有的宿主 Linux Native 系统架构功能模块支撑起了高密度低时延轻量级平行云分布生态。两大内核调度支柱如下：\n1. **Namespaces（空间挂锁隔离）**：利用命名隔离作用域功能，阻拦不同的容器组件跨容器共享内存树且不可互相操作。容器的进程内环境能持有虚拟路由分层端口、根权限进程和网络环境分配项结构，根除应用程序争抢或网络 IP 以及环境冲突的污染风险。\n2. **Cgroups（控制组算力配额控制）**：提供硬件架构层的可配置阻断（QoS 保护器）。用以限制并划分该容器进程所能合法透支使用的系统 CPU 周期百分比以及 RAM 上界阀值。在微服务大量横向排布集群的环境下，当出现某一边缘进程恶性故障溢出越界试图吞噬算力时，内核基于配额会将其快速阻遏查杀乃至分配内存锁定阻截（OOM-Killed），从而对混合云机器的其他共生节点的执行构成极强的抗扰保护壁垒。\n`,\n        targetCode: `# 阶段 1：开发集成环境提供齐整复杂的依赖解析并拉取代码编排打包\\nFROM node:20-alpine AS builder\\nWORKDIR /app\\n# 进行庞大规模构建环境所需的文件关联依赖整合下载\\nCOPY package*.json ./\\nRUN npm install\\nCOPY . .\\nRUN npm run build\\n\\n# 阶段 2：生产运行环境建立最小化驱动基础核体，精简冗杂环境\\nFROM node:20-alpine\\nWORKDIR /app\\n\\n# 跨阶搬运：剥离系统级编译源代码栈体库，精确提取出构建产物与配置\\nCOPY --from=builder /app/dist ./dist\\nCOPY --from=builder /app/package.json ./package.json\\n\\n# 仅安装维持应用运行所需的最核心轻型基础包体依赖资源\\nRUN npm install --omit=dev\\n\\nEXPOSE 80\\nCMD [\"npx\", \"serve\", \"-s\", \"dist\", \"-l\", \"80\"]\\n`,\n        comments: [\n            { line: 2, text: '#  全功能编译阶段，提供完整构建工具链路支持' },\n            { line: 11, text: '#  轻量级纯净执行基座阶段，摒除多余依赖' },\n            { line: 16, text: '#  利用多阶段提取缓存编译件以彻底清洗并丢弃源数据代码栈' },\n            { line: 20, text: '#  排除测试及编译工具链安装，交付极致精细尺寸' },\n        ],\n    },\n];\n"
              },
              {
                "name": "devops-advanced.ts",
                "type": "file",
                "path": "frontend/src/data/devops-advanced.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const devopsAdvanced: Lesson[] = [\n  {\n    id: 'devops-adv-testbe', type: 'backend',\n    title: 'JUnit 与 Testcontainers 容器化测试',\n    category: '进阶：DevOps 与工程化', track: 'DevOps & Cloud Native',\n    moduleNumber: 8, lessonNumber: 1, language: 'java',\n        illustrationUrl: '/illustrations/devops_deployment.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 引入 Testcontainers 构建可重现的容器级集成测试\n\n## 业务上下文\n在微服务数据持久层测试中，业界曾广泛采用内存数据库（如 H2）替换生产环境中的 MySQL 作伪集群映射。但是因为 SQL 方言的隐性歧视和事物锁底层的实现互异错位，测试通过的代码一旦发版即有极速崩溃引发 P0 集群事故的系统危险。\\n为应对环境隔离问题并使得开发者获取在本机 100% 仿真再现能力，在 JUnit 的底层集成架构 **Testcontainers** 库极其必要。它能够直接操纵宿主机的 Docker 引擎守护进程（Daemon API）为测试用例物理编排并弹起一个纯净独立的临时原版介质的真实数据库组件镜像实例环境。\n\n## 代码与配置解析\n\n\\`\\`\\`java\npackage com.codeforge.testing;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.DynamicPropertyRegistry;\nimport org.springframework.test.context.DynamicPropertySource;\nimport org.testcontainers.containers.MySQLContainer;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\nimport static org.assertj.core.api.Assertions.assertThat;\n\n// 1. 激活 JUnit 针对容器生命周期的事件总线侦听接管绑定配置\n@Testcontainers\n@SpringBootTest\npublic class VideoRepositoryIntegrationTest {\n\n    // 2. 利用镜像基座声明测试期内的伴库资源实例创建需求\n    // 该环境将在所有测试启封前基于 Docker API (通过 unix:///var/run/docker.sock) 启动\n    @Container\n    static MySQLContainer<?> mysql = new MySQLContainer<>(\"mysql:8.0.32\")\n            .withDatabaseName(\"test_db\")\n            .withUsername(\"test_user\")\n            .withPassword(\"test_pass\");\n\n    // 3. 拦截覆写底层数据源环境，通过反射和延迟加载接管将原 Spring 配置转移定点注入\n    @DynamicPropertySource\n    static void configureProperties(DynamicPropertyRegistry registry) {\n        // 由于测试容器拉起的外部暴露宿主机端口为大位面高随机数防撞库，而非原宿主固定态 3306 \n        // 故必须经此完成将真实的 jdbc: 数据拨接向映射端口网关对齐动作\n        registry.add(\"spring.datasource.url\", mysql::getJdbcUrl);\n        registry.add(\"spring.datasource.username\", mysql::getUsername);\n        registry.add(\"spring.datasource.password\", mysql::getPassword);\n    }\n\n    @Autowired\n    private VideoRepository videoRepository;\n\n    @Test\n    void shouldSuccessfullyWriteAndRead() {\n        // 在不含任何 Mock 虚构包装、最为原始的生产对等存储层执行落库\n        VideoEntity video = new VideoEntity(\"101\", \"How to use Testcontainers\");\n        videoRepository.save(video);\n        \n        assertThat(videoRepository.findById(\"101\")).isPresent();\n    }\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Ryuk 守护进程机制的孤儿容器零泄露回收**：\n在并发集群测试时如果不稳定导致 JVM 主线程非正常退出熔断崩盘，原本拉设起的孤岛数据库镜像集（Containers、Volumes 网段）极易变成悬空残留占据内存吞噬磁盘空间的幽灵（Orphaned Containers）。\nTestcontainers 引擎架构设计的卓绝之处在于启动核心服务时它会伴随衍生拉起一个名为 **Ryuk (资源回收机)** 的独立高优守护容器镜像体节点驻底运行。应用主线程和 Ryuk 节点时刻通过开启的心跳端口检测维系着。应用端（如 JUnit 所在进程实例 JVM ）异常离线死亡导致长链接心跳中轴即刻截停时， Ryuk 会毫无怜悯地于一秒倒计时后接管屠戮程序扫除这批在生命期内由于该实例调用创建挂载着特定厂牌 Label 标记名目的周边全套数据库实体等附加 Docker 层资产，完成高纯粹测试空间零占用遗留环保级大清退。`\n  },\n  {\n    id: 'devops-adv-testfe', type: 'frontend',\n    title: '前端铁桶阵：React Testing Library',\n    category: '进阶：DevOps 与工程化', track: 'DevOps & Cloud Native',\n    moduleNumber: 8, lessonNumber: 2, language: 'typescript',\n        illustrationUrl: '/illustrations/w3_react_testing_1771635678554.png',\n    startingCode: '', targetCode: '',\n    instructions: `# React 语义架构下组件端对端行为测试断言\n\n## 业务上下文\n针对页面布局，如果利用传统的诸如 \\`Enzyme\\` 之类的浅渲染框架仅针对当前其 DOM 层所处节点的特定类名或 ID 值和 state 对象实体进行断言判断测试。一经由任何 CSS 模块化的轻度修改操作重构或业务变量名称翻新都会引爆断言失败阻红触发脆弱的“假报错”系统崩溃链。\\n现代开发领域普遍认同和采纳了由 **React Testing Library (RTL)** 主导发起的行为架构级测试驱动学（BDD）。其坚决主张剥离针对内部组件框架实现的细节，要求将自动化侦探视角纯粹切转入“像一位存在辅助视觉需求的用户去操作读取并感知屏幕内容”为最高导向建立极具稳固容错度能力的防御保护机制测试体系阵型。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport { render, screen, fireEvent } from '@testing-library/react';\n// 引入特设版 Matcher 断言扩宽池集增强对屏幕元素的直核断言覆盖\nimport '@testing-library/jest-dom'; \nimport { InteractiveLikeButton } from '@/components/InteractiveLikeButton';\n\ndescribe('InteractiveLikeButton 交互范式行为集测', () => {\n  \n  it('验证组件能够根据基础入参呈装出具备无障碍可达属性 (A11y) 的渲染块', () => {\n    // 1. 于纯 Node 平面利用底层集成的 jsdom 解析虚拟建树还原构建组件并载挂\n    render(<InteractiveLikeButton videoId=\"v99\" initialLikes={100} />);\n    \n    // 2. 将 CSS 选择器连根抛弃：采纳获取屏幕角色标出符合 ARIA 操作属性指引的目标元素\n    const btn = screen.getByRole('button', { name: /启动点赞追踪 100/i });\n    \n    // 验证物理界面呈现存在值域以及表象参数类\n    expect(btn).toBeInTheDocument();\n    expect(btn).toHaveClass('bg-gray-100');\n  });\n\n  it('捕获乐观更新响应交互与节点属性变更断流呈现', () => {\n    render(<InteractiveLikeButton videoId=\"v99\" initialLikes={100} />);\n    const btn = screen.getByRole('button');\n\n    // 3. 构建模拟触发实体引擎层的人工指点截断触发操作\n    fireEvent.click(btn);\n\n    // 4. 断言判定组件在面临网络调用未决（在异步微任务处理事件线间隙时）对视图进行了抢先的无缝前序重排绘制覆盖\n    expect(screen.getByText('体系已采录 101')).toBeInTheDocument();\n    expect(btn).toHaveClass('bg-blue-500');\n  });\n});\n\\`\\`\\`\n\n## 底层原理深度剖析\n**JSDOM 与 DOM 节点的可用性查询抽象隔离 (Accessibility Queries)**：\n测试代码并没有实质依赖于唤醒比如 Chromium 之类的沉重渲染外核进程，这全数依靠了内置的一套采用纯 JavaScript 编写的对浏览器级 DOM 与 HTML 标准的完美高仿实现器：**JSDOM** 引擎核。\\n配合以底层无障碍支持性标准指南（WAI-ARIA），当调度使用 \\`getByRole('button')\\` 去获取节点元素而不是通过依赖 \\`document.querySelector('.like-btn')\\` 时。这一层抽象操作真正做到了针对交互可达性的最终测试标尺检测。若是下层研发将其在优化之中替换为一个挂接有按钮 class 属性伪类图层级表现样式实则却并不是能够正确引发回连交互表单提送事件的 HTML5 \\`<div>\\` 元素时，RTL 组件库这批 Role 选择器探测器将在最前防线内极速识别出此行为盲差直接给予暴露判错封堵，确保上线交互节点合乎最原教旨般的标签事件合规准则规范。`\n  },\n  {\n    id: 'devops-adv-actions', type: 'backend',\n    title: '持续集成 (GitHub Actions) 自动化流',\n    category: '进阶：DevOps 与工程化', track: 'DevOps & Cloud Native',\n    moduleNumber: 8, lessonNumber: 3, language: 'yaml',\n        illustrationUrl: '/illustrations/devops_deployment.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 落地 GitHub Actions 持续集成准入自动化门限\n\n## 业务上下文\n一旦将代码直接在主干网手工覆盖或者部署而越过严格的人工排查或安全红线校验，必将使构建出现难以倒退的毁灭错误事件代码污染主城体系。\\n**GitHub Actions (或 GitLab CI/CD)** 把流水线式地对于程序代码进入编译检验的工兵组排查审查环节编排为了 **持续集成 (Continuous Integration, CI)** 流程序列。由机器接手充当门神对于每一个被试图并入主线分支（\\`main\\`）合并交汇请求 (Pull Request)，实行严密的包含静态体检、全面集测、沙盒演练通过后才能将网闸代码放流的封锁放闸守卫操作机制。\n\n## 代码与配置解析\n\n\\`\\`\\`yaml\nname:  Backend CI Core Defense Pipeline\n\n# 1. 拦截引线事件触发阵位器\non:\n  pull_request:\n    branches: [ \"main\" ]\n    paths:\n      # 在全栈项目中实行定点拦截切断判定：仅限于波及涵盖到后端文件区的变更才推起该线执行，极度缩减计费机器能耗时开支\n      - 'backend/**' \n\njobs:\n  # 设置此组流水线的系统载体\n  build-and-test:\n    runs-on: ubuntu-latest\n\n    steps: # 组装配置链\n      # 1⃣ 第一层：载入并复制系统目标文件层进隔离器\n      - name: Code Repository Checkout\n        uses: actions/checkout@v4\n\n      # 2⃣ 第二层：分配底层资源配置及编译器 SDK\n      - name: JDK 21 Env Initialization\n        uses: actions/setup-java@v3\n        with:\n          java-version: '21'\n          distribution: 'temurin'\n          # 设置重置级缓存：令数 GB 的包体可以跨越构建序列被下一次复取使用，避免极端的依赖下载重建空窗期\n          cache: gradle \n\n      # 3⃣ 第三层：调用系统检验工具，包括覆盖运行所有的单元测及 Testcontainers 对撞实体测试\n      - name: Comprehensive Unit & Integration Test\n        working-directory: ./backend\n        run: ./gradlew test\n\n      # 4⃣ 第四层：实施最终交付物封存编排\n      - name: Compile Fat-Jar Product Artifact\n        working-directory: ./backend\n        run: ./gradlew bootJar\n\\`\\`\\`\n\n## 底层原理深度剖析\n**容器级微隔离流水线容器 (Runner) 组置生态环境沙盒模型**：\nGitHub 所派遣的一台名唤 \\`ubuntu-latest\\` Runner 流水处理环境器在生命周期完结后是执行彻底物理焚毁重置化 (Ephemeral/Stateless) 的设计思路理念模型。\\n这即是对以往手工机房常常饱历苦难在物理机环境里产生的包含有诸如上代缓存系统环境遗臭或者未卸载旧部文件带来的依赖“伪阳通过”状态构建错误的彻底物理绝杀隔离清剿！这绝对确保了在每一次合并校验流中所有的组件、数据下载环境和系统指令编排链全数建立在一套从头无中生有干涩纯平起点的全新时空切片维度执行重构中诞生，验证该系统的编译结构具备能够在不含任何人为介入暗桩铺设的全自动裸机生态系统部署健壮容忍度架构生命力。`\n  },\n  {\n    id: 'devops-adv-k8s', type: 'backend',\n    title: 'K8s 流量分配：Ingress 路由机制',\n    category: '进阶：DevOps 与工程化', track: 'DevOps & Cloud Native',\n    moduleNumber: 8, lessonNumber: 4, language: 'yaml',\n        illustrationUrl: '/illustrations/w3_k8s_ingress_1771635714974.png',\n    startingCode: '', targetCode: '',\n    instructions: `# Ingress 流量边界控制器与内部路由网\n\n## 业务上下文\n向集群下散部署数十个内部支撑微服务（如视频组、鉴权组、计费组等核心机群）若是均采用暴露公网的物理端口组向最终用户的网段暴露提供接口并散装组合极不安全且杂乱。\n在 Kubernetes 网络体系最先沿外边界构筑设置 **Ingress** 层以承接来自外部公有环境大网的入口并充任超级 7 层逆反应用网关。配合由云服务商建立的全局 LoadBalancer 加持分配，它依靠单个端口对所有的外部路径访问（Path/Domain Routing）实现并执行统一定向拦截阻断、重发路由并完成 HTTP 包体的全向拆装、HTTPS 的解密以及集群内局域路由投发。\n\n## 代码与配置解析\n\n\\`\\`\\`yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: saas-core-ingress-router\n  annotations:\n    # 1. 宣示采用性能强悍的 NGINX 控制器挂载核层驱动支撑路由执行分发底层指令计算动作\n    kubernetes.io/ingress.class: \"nginx\"\n    \n    # 采用速率防卫护阵（Rate Limiting）：将来自单点 IP 的请求流量过压在集群边界挡外强压拒签防拖垮\n    nginx.ingress.kubernetes.io/limit-rps: \"100\"\n    \n    # 结合 cert-manager 实现并自动化完成对外部握手提供安全的加密协议通道的配置化下装对接\n    cert-manager.io/cluster-issuer: \"letsencrypt-prod\"\nspec:\n  # 2. 指定加密通讯认证所对应的持有证书密钥池\n  tls:\n    - hosts:\n      - api.codeforge-saas.com\n      secretName: saas-tls-cert\n  \n  # 3. 大流量集群分配拆入切道管网：根据包体标头请求位置向丛集深处分撒至对应不同后端承制方集群组\n  rules:\n    - host: api.codeforge-saas.com\n      http:\n        paths:\n          # 前置命中路径寻址指引向内部局域命名内网集寻域进行分载\n          - path: /user-service\n            pathType: Prefix\n            backend:\n              service:\n                name: saas-user-cluster-service # 被严密保护在只能内网流转的子服务名址（无需开通集群外露入口）\n                port:\n                  number: 80\n          \n          - path: /video-service\n            pathType: Prefix\n            backend:\n              service:\n                name: saas-video-feed-service\n                port:\n                  number: 80\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Ingress Controller 反向监听轮询重载注入模型 (Control Loop Architecture)**：\n纯粹配置这一叠 \\`ingress.yaml\\` 在集群网络生态内只是生成一具虚置数据实体资源并未涉及底层配置驱动系统实现，需要下装实实在在正在运转中的控制器 (如: ingress-nginx) 守护组件模块集群来进行实体资源响应挂载。\\n这枚基于 Go 语言编写的实体控制器层时刻依附并通过 API Server 同步机制轮询挂起（Long-polling）并拦截集群内存贮内的所产生新建出来的诸如同上文一般的路由规划记录与 Service 表项变动结构体系信息。\\n一旦监探获取规则信息变幻产生，其底层动作便极为暴力的自行利用拉下的参数规则推演自动编译并生成全新的 \\`nginx.conf\\` 最终反向推送执行了内部核心 \\`nginx -s reload\\` 使这些复杂的公网解密端口防撞网和层级派分流量管线得以瞬间在所有驻守并处在节点中的实例外围被立即加载并在毫秒间对生产环境发生阻击起效产生作用层！从而以一套高内聚配置文实现了跨云底座大规模架构代理配置的极致统一化调控系统能力建设。`\n  }\n];\n"
              },
              {
                "name": "frontend-m1-m2.ts",
                "type": "file",
                "path": "frontend/src/data/frontend-m1-m2.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const frontendM1M2: Lesson[] = [\n  {\n    id: 'fe-1-1', type: 'frontend',\n    title: '课程 1.1：配置 SaaS 项目的 React 外壳',\n    category: '模块1：现代基础架构与权限', track: '前端架构',\n    moduleNumber: 1, lessonNumber: 1,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 配置 SaaS 项目的 React 外壳与代理机制\n\n## 业务上下文\n在开启前端业务代码工程化搭建时，构建工具的选型至关重要。本项目摒弃了传统的 Webpack，转而采用 Vite 构建工具，结合 React 开发范式与 Tailwind CSS，构建现代化前端基础设施。同时，在前后端分离架构中，前端（运行于 \\`5173\\` 端口）直接请求后端服务（横跨至 \\`8080\\` 端口）会触发浏览器的同源策略（Same-Origin Policy）拦截，引致 CORS 跨域安全报错。通过在开发服务器层面上集成反向代理，可无缝规避此网络策略限制。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\n/// <reference types=\"node\" />\nimport { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport tailwindcss from '@tailwindcss/vite';\nimport path from 'path';\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    tailwindcss(),\n  ],\n  resolve: {\n    alias: {\n      '@': path.resolve(__dirname, './src'),\n    },\n  },\n  server: {\n    port: 5173,\n    proxy: {\n      '/api': {\n        target: 'http://localhost:8080',\n        changeOrigin: true, // 核心：重写请求头中的 Host 为目标服务器地址，以通过后端网关的 Host 校验\n      },\n    },\n  },\n});\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Vite 的 ESM 按需编译 vs Webpack 打包机制**：\nWebpack 在启动开发服务器前，必须通过依赖图谱递归解析并打包（Bundle）所有资源文件。随着企业级项目代码量激增，其冷启动时间呈指数级上升。Vite 革命性地利用了现代浏览器原生支持 ESM (ECMAScript Modules) 的特性。在开发模式下，Vite 不预先打包组件代码，而是将自身化作一个轻量级 HTTP 服务器。只有当浏览器真实请求某个模块（如 \\`import App from './App.tsx'\\`）时，Vite 才即时（On-demand）对该单文件进行编译并下发，这使得系统的冷启动时间被绝对压缩至毫秒级。\n\n**同源策略边界与 Proxy 代理穿透的本质**：\nCORS 跨域限制是宿主环境（浏览器）为了防止 CSRF（跨站请求伪造）等安全漏洞而设立的基础隔离机制。然而，纯服务器实例之间的 HTTP 数据请求并不包含浏览器外壳，因此天然不存在跨域拦截。Vite 的 \\`server.proxy\\` 正是利用了这一网络特性。Vite 内置的 Node.js 服务器作为中间节点，将来自浏览器的 \\`/api\\` 请求在其本地转发给目标宿主（后端 Tomcat 服务器）。这样，浏览器仅仅认为它在向同源的 \\`5173\\` 端口发起请求，进而巧妙且安全地实现了跨域通信。`\n  },\n  {\n    id: 'fe-1-2', type: 'frontend',\n    title: '课程 1.2：类型严格的 JWT 登录表单',\n    category: '模块1：现代基础架构与权限', track: '前端架构',\n    moduleNumber: 1, lessonNumber: 2,\n        illustrationUrl: '/illustrations/w3_jwt_auth_1771635695409.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 开发类型严格的 JWT 登录表单\n\n## 业务上下文\n在微服务化的 SaaS 架构下，登录认证系统全面抛弃了基于服务端内存的 Session 方案，转向基于 JWT (JSON Web Token) 的无状态（Stateless）认证。前端成功请求认证 API 后，后端返回包含签名声明的散列令牌，以及对应的领域角色元数据。在此过程中，前端需要利用 TypeScript 的强类型约束体系，为组件状态及接口响应建立严谨的数据契约（Data Contract），防止运行时未定义字段的访问异常。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React, { useState } from 'react';\n\n// 1. 定义严谨的类型契约结构\ninterface LoginResponse {\n  token: string;\n  user: {\n    id: string;\n    username: string;\n    role: 'ADMIN' | 'USER'; // 声明字符串字面量联合类型\n  };\n}\n\nexport const LoginForm: React.FC = () => {\n  const [username, setUsername] = useState<string>('');\n  const [password, setPassword] = useState<string>('');\n  // 2. 泛型状态约束：明确可能由于网络、校验等产生的异常对象类\n  const [error, setError] = useState<Error | null>(null);\n\n  const handleLogin = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    try {\n      const res = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ username, password }),\n      });\n      if (!res.ok) throw new Error('Authorization Denied');\n      \n      const data = (await res.json()) as LoginResponse;\n      // 3. 落盘至本地存储介质供全局网关拦截器提取\n      localStorage.setItem('jwt', data.token);\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error('Fatal: Login failed'));\n    }\n  };\n\n  return (\n    <form onSubmit={handleLogin} className=\"p-6 bg-white shadow-md rounded-xl\">\n      {error && <p className=\"text-red-500 mb-4\">{error.message}</p>}\n      <input className=\"block border p-2 mb-2 w-full\" type=\"text\" placeholder=\"Username\"\n        value={username} onChange={e => setUsername(e.target.value)} />\n      <input className=\"block border p-2 mb-4 w-full\" type=\"password\" placeholder=\"Password\"\n        value={password} onChange={e => setPassword(e.target.value)} />\n      <button type=\"submit\" className=\"w-full bg-blue-600\">Login</button>\n    </form>\n  );\n};\n\\`\\`\\`\n\n## 底层原理深度剖析\n**TypeScript 的编译时防线与运行时类型断言**：\nTypeScript 在编译阶段提供静态扫描机制，例如限定 \\`role\\` 必须等价于 \\`'ADMIN' | 'USER'\\`。这阻断了在界面消费该数据时意外将其认定为其他不可控类型的可能。在代码中，\\`as LoginResponse\\` 是对 fetch() 返回值的类型断言，这告知编译器将隐性推导出的 \\`any\\` 接管为确定结构。这一操作保障了后续对于 \\`data.token\\` 调用的属性安全性，从而缩减了潜在报错空间。\n\n**React SyntheticEvent (合成事件) 委托模型**：\nDOM 中的 \\`React.FormEvent\\` 代表了合成事件体系。由于各个浏览器厂商实现了相悖的事件模型（如 IE 与 W3C 的模型差异），React 并未将事件直接注册到真实的 DOM 节点上，而是在初始化时向整个应用结构的 Root 根节点绑定了一个统一的全局监听器。在触发时，框架再将原生层捕捉到的触发信息封装实例化为一个统一规范的 \\`SyntheticEvent\\` 对象，交由对应的组件接管。这大大降低了内存的句柄持有开支，并实现了多端跨浏览器行为的一致性兼容。`\n  },\n  {\n    id: 'fe-1-3', type: 'frontend',\n    title: '课程 1.3：处理认证的异步状态',\n    category: '模块1：现代基础架构与权限', track: '前端架构',\n    moduleNumber: 1, lessonNumber: 3,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 利用可区分联合体处理异步状态\n\n## 业务上下文\n在复杂的网络通信交互视图中，开发者需不断维护组件的流转状态，如【待机、网络传输中、成功响应、异常错误】。若使用多个独立的布尔状态位（例如 \\`isLoading: true\\` 同时 \\`isError: true\\`），很容易组合出逻辑上完全互斥非法的无效状态（Invalid States）。\n采用 TypeScript 的 **可区分联合体 (Discriminated Unions)** 与状态机设计模式，可建立绝对互斥的运行时状态边界管理，彻底消除边界矛盾。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport React, { useReducer } from 'react';\n\n// 1. 通过相同的键名 'status' 作为字面量识别符 (Discriminator)\n// 构建状态机节点的互斥定义集\ntype AuthState =\n  | { status: 'idle' }\n  | { status: 'loading' }\n  | { status: 'success'; token: string }\n  | { status: 'error'; error: string };\n\ntype AuthAction =\n  | { type: 'FETCH' }\n  | { type: 'SUCCESS'; token: string }\n  | { type: 'ERROR'; error: string };\n\n// 2. 调度函数：控制状态从节点 A 按照唯一明确路径跨越到节点 B\nfunction authReducer(state: AuthState, action: AuthAction): AuthState {\n  switch (action.type) {\n    case 'FETCH':\n      return { status: 'loading' };\n    case 'SUCCESS':\n      return { status: 'success', token: action.token };\n    case 'ERROR':\n      return { status: 'error', error: action.error };\n    default:\n      return state;\n  }\n}\n\n// 3. 构建高内聚的可复用业务逻辑 Hook\nexport function useAuthMachine() {\n  const [state, dispatch] = useReducer(authReducer, { status: 'idle' });\n  return { state, dispatch };\n}\n\n// 消费侧示例分析：\n// const { state } = useAuthMachine();\n// if (state.status === 'success') {\n//   // 此作用域内，TS 将其类型收缩，保证一定可以访问到 state.token\n// }\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Type Narrowing（类型收窄）系统的编译校验机制**：\n可区分联合体依托于 Type Narrowing 机制。在 TS 解析 AST 语法树时，\\`status\\` 字段被视作联合类型的 **Discriminator（辨识属性）**。当使用控制流语句（如 \\`switch\\` 或 \\`if\\`）判断其属于某一具体的字面量（例如 \\`'success'\\`）时，编译器会在该语法块内剥离掉其它的分支可能，将宽泛的联合类型收缩（Narrow）为具有 \\`token: string\\` 的精准子集合。这就使得如果我们在 \\`status === 'error'\\` 的块内企图调用 \\`state.token\\` 时，编译器能立即拦截报错，从而将逻辑隐患截杀在编码时态而不是崩溃在运行阶段。`\n  },\n  {\n    id: 'fe-1-task', type: 'frontend',\n    title: '实战：强类型组件',\n    category: '模块1：现代基础架构与权限', track: '前端架构',\n    moduleNumber: 1, lessonNumber: 4,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 实战：开发强类型 UI 组件\n\n## 业务上下文\n在现代前端工程中，频繁复制粘贴的 Tailwind 配置会导致难以维护的 HTML 结构。将其下移封装为具备复用能力的公共 UI 实体组件，是维持界面风格统一性的必要手段。使用 TypeScript，可以向组件的 Props 注入原生的浏览器属性继承特性，并且采用字典映射策略限制可用的变体及尺寸，以此来屏蔽组件随意改动的不可预见性。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React from 'react';\n\n// 1. 基约限制定义\ntype ButtonVariant = 'primary' | 'secondary' | 'danger';\ntype ButtonSize = 'sm' | 'md' | 'lg';\n\n// 2. 接口继承：合并自定义结构与原生的 HTMLButton 接口属性事件集\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant: ButtonVariant;\n  size: ButtonSize;\n}\n\n// 3. 利用映射表避免在组件中写出杂乱重复的判断嵌套语句\nconst sizeClasses: Record<ButtonSize, string> = {\n  sm: 'px-3 py-1.5 text-sm',\n  md: 'px-4 py-2 text-base',\n  lg: 'px-6 py-3 text-lg',\n};\n\nconst variantClasses: Record<ButtonVariant, string> = {\n  primary: 'bg-blue-500 text-white hover:bg-blue-600',\n  secondary: 'bg-gray-100 text-gray-700 hover:bg-gray-200',\n  danger: 'bg-red-600 text-white hover:bg-red-700',\n};\n\n// 4. 将提取出的其余属性 (...rest) 全盘接管散播给底层的真实 DOM\nexport function Button({ variant, size, children, className, ...rest }: ButtonProps) {\n  return (\n    <button\n      className={\\`font-medium transition-colors rounded-lg \\${sizeClasses[size]} \\${variantClasses[variant]} \\${className || ''}\\`}\n      {...rest}\n    >\n      {children}\n    </button>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Tailwind CSS 的静态提取扫描与 AOT (Ahead-of-Time) 本质**：\nTailwind 引擎完全不同于传统的运行时 CSS-in-JS (如 Styled-Components)。它基于源文件的纯静态字典正则提取。在 Vite 构建打包的 AST 扫描阶段，Tailwind 读取所有业务文件并捕捉其中配置好的固定类名字串合集。如果开发者为了省事利用动态模板拼接写出类似 \\`bg-\\${status}-500\\` 的代码逻辑，扫描器在编译时处于不可演算状态，自然无法将其捕捉，最终打包交付出的 \\`index.css\\` 将由于彻底遗失这些样式使得视图崩塌。因此，通过严谨的静态 \\`Record\\` 映射表定义全量可识别字面量，是保证 Tailwind 能够在 AOT 流程中精准组装层级样式文件的唯一定规。`\n  },\n  {\n    id: 'fe-2-1', type: 'frontend',\n    title: '课程 2.1：列表性能优化',\n    category: '模块2：组件架构与视频流', track: '前端架构',\n    moduleNumber: 2, lessonNumber: 1,\n        illustrationUrl: '/illustrations/w3_react_optimizations_1771635739563.png',\n    startingCode: '', targetCode: '',\n    instructions: `# React 冗余渲染优化：React.memo 陷阱突破\n\n## 业务上下文\n在内容聚合型视图（如超长无尽列表页）中存在着几百个结构相同的子实体卡片元素。依照 React 默认由始端至终端传播向下的流水线更新特性，当祖先节点的某个无关状态发生刷新时，便会对包括这成百上千张卡片进行全量的暴力重绘。针对这些只做单纯数据展现用的组件栈构建缓存防护层，对于降低浏览器的主程内存堆积和 CPU 瓶颈消耗，极为关键。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React, { useCallback } from 'react';\n\ninterface Video {\n  id: string; title: string; author: string; views: number; thumbnail: string;\n}\n\ninterface VideoCardProps {\n  video: Video;\n  onLike: (id: string) => void;\n}\n\n// 1. 利用 React.memo 高阶函数为其生成一层属性记忆阻隔层\nexport const VideoCard = React.memo(function VideoCard({ video, onLike }: VideoCardProps) {\n  console.log('子级运算组件正在进行深层更新分析：', video.id);\n  return (\n    <div className=\"flex flex-col rounded-xl overflow-hidden bg-white border border-gray-100\">\n      <img src={video.thumbnail} loading=\"lazy\" />\n      <div className=\"p-4\">\n        <h3>{video.title}</h3>\n        <button onClick={() => onLike(video.id)}> 点赞 </button>\n      </div>\n    </div>\n  );\n});\n\n// 2. 示例父容器内部的调用，强制规范化对传参句柄的稳健缓存声明：\nexport default function VideoList({ videos }: { videos: Video[] }) {\n  // 如果采用内联箭头函数，子组件每轮将会因获取新生句柄而被判定失防强制冲破缓存\n  const handleLike = useCallback((id: string) => {\n    console.log(\"执行高内聚域方法调用 - 收藏\", id);\n  }, []); // 注入依赖树空集表示长期绑定不可动摇的挂载引用\n\n  return (\n    <div>\n      {videos.map(v => <VideoCard key={v.id} video={v} onLike={handleLike} />)}\n    </div>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**Virtual DOM Diff 算法与 \\`React.memo\\` 浅比较失效根因**：\n当上层状态触发重新调和时，React 计算引擎会将构建出的最新 Virtual DOM 书与系统内原本驻留的实例树针对每一个节点层层实施 Diff 比对。\n\\`React.memo()\\` 会为该组件施加一层外挂式干预，仅对比新旧两套 \\`Props\\` 有无变更，但它的判定标准默认是 **对象的浅比较 (Shallow Compare)**。\n倘若父节点给 \\`onLike\\` 赋值时并未应用 \\`useCallback\\`，而是在 JSX 中实时书写箭头匿名函数 \\`onLike={() => ...}\\`，那么在父组件执行下一帧渲染体时，匿名函数将被分配合成出一个与旧帧内部结构毫无关联的全新堆空间内存在址。浅比较引擎比对其引用指针不同后，会直接宣告防御系统坍塌并将 \\`React.memo\\` 绕过、作废进而深度重渲后代。借由 \\`useCallback\\` 保活了该闭包对象所在堆地址唯一连贯性后，其优化机制才能正常咬合。`\n  },\n  {\n    id: 'fe-2-2', type: 'frontend',\n    title: '课程 2.2：构建无限滚动 Hook',\n    category: '模块2：组件架构与视频流', track: '前端架构',\n    moduleNumber: 2, lessonNumber: 2,\n        illustrationUrl: '/illustrations/w3_react_hooks_flow_1771635574572.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 获取无限加载挂钩并规避闭包状态陷阱\n\n## 业务上下文\n构建无限延展列表时依赖末端监测点判断用户是否划卷至视窗下沿。传统的监听全局防抖 \\`scroll\\` 方法由于会产生密集庞杂的高频回调触发（通常在数毫秒一次的评级）极易致浏览器引擎崩溃且模块关联黏性高。\n现代引擎体系引入了独立的 C++ 层执行监测接口。我们须要利用 React 抽象化封装为一个纯函数 Hook，并在过程中规避一个常见的 React 问题：捕获过期状态陷阱。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport { useEffect, useRef } from 'react';\n\n// 搭建支持泛型的交叉探视挂钩引擎逻辑集\nexport function useIntersectionObserver(\n  callback: () => void,\n  options?: IntersectionObserverInit\n) {\n  // 充当真实 DOM 的探针点\n  const targetRef = useRef<HTMLDivElement>(null);\n  \n  // 核心：维护一个用于存储并更新操作回调的非映射可变代理箱\n  const callbackRef = useRef(callback);\n  \n  // 将一切回调演化带来的新变化立即塞入 Mutable 的容器中不发生引发重渲染\n  useEffect(() => {\n    callbackRef.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    const target = targetRef.current;\n    if (!target) return;\n\n    // 当浏览器的绘制系统交融触碰边界线时，调用我们隔离在代理容器内的最新鲜句柄\n    const observer = new IntersectionObserver(([entry]) => {\n      if (entry.isIntersecting) {\n        callbackRef.current();\n      }\n    }, { threshold: 0.1, ...options });\n\n    observer.observe(target);\n    \n    // 清扫战场机制：页面隐没拆除 DOM 时将探活系统斩断防止幽灵式泄漏驻留\n    return () => observer.disconnect();\n  }, [options]);\n\n  return targetRef;\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**React 闭包执行上下文内的 stale state (过时状态) 一致性危机**：\nHooks 的函数体在每一次执行时，由于 JS 词法作用域锁定的规则，它会形成并封存那一个瞬时切片所有的变量映射状态（像胶片般定格）。如果直接在基于 \\`useEffect\\` 挂载并依赖于常量的 IntersectionObserver 中传递 \\`callback\\` 方法，引擎会将这首播版本的 \\`callback\\` 环境焊死，之后即使父级传来了全新的带有扩充后 list 的方法引介系统也不再响应——此时引爆的就是著名“闭包失效僵尸”。\n依靠向组件体系之外游离的 \\`useRef(callback)\\` 作为指针仓库，\\`useEffect\\` 由于只读取了那个常驻容器 \\`ref.current\\` 的稳定指针，就等于构建出了一条隔离在 React 单向生命溯洄体系以外的安全侧门，时刻响应读取最即刻并无污的参数值序列。`\n  },\n  {\n    id: 'fe-2-3', type: 'frontend',\n    title: '课程 2.3：使用 Web Worker',\n    category: '模块2：组件架构与视频流', track: '前端架构',\n    moduleNumber: 2, lessonNumber: 3,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 启用 Web Worker 解除单线程计算封锁\n\n## 业务上下文\n涉及到数据端量达到万级排序分流或进行哈希深度比对这般运算级工作量时若滞留于界面组件生命周期中，计算阻塞度极高。用户在屏幕上的滑动或键入这等低级命令全部停摆处于未解析停顿的 \"Frozen\"（卡死白屏）现象。\n为解决此阻塞，利用浏览器的 \\`Web Worker\\` API 建立起前端工程化下的真正并行多任务拓扑架构将计算下推。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport { useState, useEffect, useRef } from 'react';\n\n// 1. 将原逻辑结构字符化封箱处理\nconst sortWorkerStr = \\`\n  self.onmessage = function(e) {\n    const { videos, sortBy } = e.data;\n    const sorted = [...videos].sort((a, b) => {\n      if (sortBy === 'views') return b.views - a.views;\n      return a.title.localeCompare(b.title);\n    });\n    // 计算终结，将运算成果重构并投送向原生主控进程\n    self.postMessage(sorted);\n  };\n\\`;\n\n// 2. 借助 Blob 构建内部的隔离作用域代理脚本，避免构建外部打包干扰项引入\nfunction createWorker() {\n  const blob = new Blob([sortWorkerStr], { type: 'application/javascript' });\n  return new Worker(URL.createObjectURL(blob)); // 取得浏览器底层内存中的解析挂载点\n}\n\n// 3. 构建高耦合 Hook 用作数据发散和收取信道监听\nexport function useWorkerSort(videos: any[], sortBy: string) {\n  const [sorted, setSorted] = useState(videos);\n  const workerRef = useRef<Worker | null>(null);\n\n  useEffect(() => {\n    workerRef.current = createWorker();\n    workerRef.current.onmessage = (e) => setSorted(e.data); // 回笼结果写入虚拟渲染管线更新\n    \n    // 生命周期析构注销阶段，强杀挂起该隔离进程防止长期系统失血\n    return () => workerRef.current?.terminate();\n  }, []);\n\n  useEffect(() => {\n    // 父系变化驱动子工作进程运算\n    workerRef.current?.postMessage({ videos, sortBy });\n  }, [videos, sortBy]);\n\n  return sorted;\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**JavaScript V8 事件引擎架构（Event Loop）与线程剥离设计**：\n原生 JavaScript 执行域由于必须严加防范同步交替操作对 DOM 树进行摧毁性的错位改写（例如某函数试图变更 DOM 但另函数却正尝试进行移除），迫使其成为绝对限制下的单线程语言（主线程）。在 Event Loop 微/宏任务排队执行栈机制里，任何同步的高耗时函数会绝对垄断堆栈序列阻杀其它 UI Render Rendering (重绘流) 帧工作。\\nWeb Worker 实现的本质是调用内核 OS 借位创建出互不相干于原引擎环境的新操作系统 OS-Thread 线程。该线程由于被物理封控无法执行一切 \\`window.\\` 与 DOM 相关 API，杜绝了并行冲突；并通过 IPC （进程间通讯）手段、结构化克隆算法（Structured Clone Algorithm），以消息订阅复制投喂的方式完成了前端极速复杂算力的分流卸载，进而捍卫了维持 60 FPS 强交互平滑帧率基线的主栈执行生态界。`\n  },\n  {\n    id: 'fe-2-task', type: 'frontend',\n    title: '实战：组装无限列表业务闭环',\n    category: '模块2：组件架构与视频流', track: '前端架构',\n    moduleNumber: 2, lessonNumber: 4,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 实战：微服务型无线端滚动组件组构闭环\n\n## 业务上下文\n在这个综合实践节当中，我们要将模块内部分立研究的所有构建部件——包含优化缓存的展示子节点 (\\`React.memo\\`)，拦截过时状态的滚轮侦探 Hook，聚合汇合至一张主面板，从而构筑一个稳固、防止渲染爆裂、并配备单向控制与状态约束等标准商业化产品所需特性的终端无线滚动资讯页。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React, { useState, useCallback } from 'react';\nimport { useIntersectionObserver } from '@/hooks/useIntersectionObserver';\nimport { VideoCard } from '@/components/VideoCard';\n\nexport default function InfiniteFeed() {\n  // 1. 初始化容器源状态以及维护防溢出控制信号量\n  const [videos, setVideos] = useState<any[]>([]);\n  const [page, setPage] = useState(1);\n  const [loading, setLoading] = useState(false);\n\n  // 2. 利用恒定地址记忆锁闭阻断子节点重新生成的级联刷新开销\n  const fetchMore = useCallback(async () => {\n    // 防抖安全锁网闸保护，遏制同一触发线内并行的 API 重请求挤兑风暴\n    if (loading) return;\n    setLoading(true);\n    \n    try {\n      // 提取远程信息构建组列表追加运算\n      const newVideos = [{ \n        id: String(Date.now()), \n        title: 'Hook Tutorial vs Lifecycle', \n        author: 'Systems Author', \n        views: 40590, \n        thumbnail: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?q=80&w=300&auto=format&fit=crop' \n      }];\n      \n      // 执行安全基于前效的状态叠加合成变体，而不是产生依赖闭包死锁提取的重配写回\n      setVideos(prev => [...prev, ...newVideos]);\n      setPage(p => p + 1);\n    } finally {\n      // 解锁引擎许可下一次触发行为捕获放闸\n      setLoading(false);\n    }\n  }, [loading]); // 合理挂载状态以在状态翻转期间仅重发此回调构建环境\n\n  // 3. 将加载池操作绑定至视窗观测底层容器内\n  const sentinelRef = useIntersectionObserver(fetchMore);\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-8\">\n      <h1 className=\"text-2xl font-bold mb-8 text-gray-900 border-b pb-4\">趋势内容集</h1>\n      \n      {/* 应用栅格分切重分区块控制布局体系 */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {videos.map(v => (\n          <VideoCard \n            key={v.id} \n            video={v} \n            onLike={(id: string) => console.log('发送点赞业务追踪埋点信号源: ', id)} \n          />\n        ))}\n      </div>\n\n      {/* 4. 底层检测物理拦截锚点，被挂在了监听引用的尾部触点 */}\n      <div ref={sentinelRef} className=\"h-16 flex items-center justify-center mt-6\">\n        {loading && <div className=\"text-gray-500\">同步加载网络分片缓冲中...</div>}\n      </div>\n    </div>\n  );\n}\n\\`\\`\\`\n\n## 模式总结\n这是前端架构高度进化的一个标准横切面（Cross-section Framework Pattern）。它体现了严苛限制下的**单向数据流向下注入**（通过组件 \\`Props\\` 发放实体对象及事件触发槽）、**逻辑与视图彻底脱模隔离**（把重型计算或状态收集交由 Hooks 消化），以及**状态守卫防重**（以状态锁变量控制 IO 吞吐频次屏障），构成了稳定可靠、极尽克制的现代 Web 系统开发规范框架基盘。`\n  },\n];\n"
              },
              {
                "name": "frontend-m3-m5.ts",
                "type": "file",
                "path": "frontend/src/data/frontend-m3-m5.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\n\nexport const frontendM3M5: Lesson[] = [\n  {\n    id: 'fe-3-1', type: 'frontend',\n    title: '课程 3.1：Next.js SSR 处理视频详情页',\n    category: '模块3：Next.js 与服务端渲染', track: '前端架构',\n    moduleNumber: 3, lessonNumber: 1,\n        illustrationUrl: '/illustrations/w3_nextjs_ssr_arch_1771635590252.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 使用 Server-Side Rendering (SSR) 处理 SEO\n\n## 业务上下文\n在传统的 React Single Page Application (SPA) 架构中，初始加载下发的仅仅是一个绑定 \\`<div id=\"root\"></div>\\` 的空置 HTML 文档与庞大 JS 核心包。这对于依赖于页面爬虫收录索引的公共访问内容（如视频详情页）是致命的，因为爬虫抓取到的将是不含有任何业务文本内容的骨架结构。\n引入 Next.js 体系提供的 Server-Side Rendering (SSR) 机制，可以在 Node.js 后台容器中预先发起远程数据获取，并在吐回给用户客户端的物理瞬间渲染拼装出自带强特征数据的完整源生 HTML，实现 Search Engine Optimization (SEO) 及首屏极速内容到达（FCP）。\n\n![SSR Metadata Inject](/assets/ssr-metadata.png)\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport type { Metadata } from 'next';\nimport VideoPlayer from '@/components/VideoPlayer';\n\n// 1. 在服务端预执行生成针对性头标签与 OpenGraph (OG) 分享卡片\nexport async function generateMetadata({ params }: { params: { id: string } }): Promise<Metadata> {\n  const res = await fetch(\\`http://localhost:8080/api/videos/\\${params.id}\\`);\n  const video = await res.json();\n  \n  return {\n    title: \\`\\${video.title} - 高级架构实战教程\\`,\n    description: video.description,\n    openGraph: { images: [video.thumbnail] }\n  };\n}\n\n// 2. React Server Component (服务端组件)，直接使用 async/await 堵塞语法抓取外部依赖\nexport default async function VideoPage({ params }: { params: { id: string } }) {\n  const res = await fetch(\\`http://localhost:8080/api/videos/\\${params.id}\\`);\n  const video = await res.json();\n\n  return (\n    <main className=\"max-w-4xl mx-auto p-4\">\n      <h1 className=\"text-2xl font-bold mb-4 border-b border-gray-200 pb-2 text-gray-900\">{video.title}</h1>\n      {/* 复杂的嵌套渲染被留在云端推演完成 */}\n      <VideoPlayer url={video.url} />\n    </main>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**SSR 生命周期编排与 Hydration (注水) 机制本质**：\n服务端预渲染（SSR）在 Node.js V8 引擎内部借助 \\`ReactDOMServer.renderToString\\` 类底层 API，提前解析所有的 \\`React.createElement\\` 结构体并输出纯文本格式的静态标注重组串。由于它跳过了在真机环境内的 JS 下载、JS 执行、DOM 节点计算注入的漫长周期，用户访问页面便可立竿见影地读出文字内容。\n但此时返回的长 HTML 仅仅是一张缺失神经链路响应交互点击的静态壁画。**Hydration (注水)** 就是伴随着其后置缓慢下载完成的客户端框架 JS Bundle 包体启动的第二次激活战役。React 此时并不会破坏这层已展示好的真实 DOM 节点树，而是像水一般悄无声息的流过所有 HTML 骨架，挂载关联好其附带着如 \\`onClick\\` 或 \\`useState\\` 逻辑绑定的合成事件引擎，将一张毫无生气的画作转换为真实交互的存活体系。`\n  },\n  {\n    id: 'fe-3-2', type: 'frontend',\n    title: '课程 3.2：React Server Components',\n    category: '模块3：Next.js 与服务端渲染', track: '前端架构',\n    moduleNumber: 3, lessonNumber: 2,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# React Server Components (RSC) 重构渲染流水线\n\n## 业务上下文\n面临大基数评论区此类复杂嵌套视图渲染时，如果走经典的 Client-Side Rendering (CSR) 流程，不仅需依靠微弱的客户端运算算力递归建树，这成百上千条的关联 JSON 文件传输更会急遽抬高带宽高限。\\n运用 **React Server Components (RSC)** 可以颠覆性地将这批沉重的 JS 控制反转。让这套业务直接驻留在临近数据库的高性能数据中心网络机架上执行演算闭环，单向推流出绝对裁剪完工的组件片段给予最终消费者。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport React from 'react';\n\n// 限定只在服务节点进行内存组装装配\ninterface Comment {\n  id: string;\n  userId: string;\n  content: string;\n  createdAt: string;\n}\n\nexport default async function CommentsSection({ videoId }: { videoId: string }) {\n  // 利用 Fetch 劫持能力实现对高射频访问请求数据的拦截缓冲\n  // 60 秒内同一访问路径复用极速的 ISR (Incremental Static Regeneration) 缓存映射体\n  const res = await fetch(\\`http://api-service:8080/api/videos/\\${videoId}/comments\\`, {\n    next: { revalidate: 60 } \n  });\n  const comments: Comment[] = await res.json();\n\n  return (\n    <section className=\"mt-8\">\n      <h2 className=\"text-xl font-semibold mb-4 border-b pb-2\">技术探讨区 ({comments.length})</h2>\n      <div className=\"space-y-4\">\n        {comments.map((c) => (\n          {/* 将格式化时间等复杂消耗统统卸载给超配制云服务器芯片核执行 */}\n          <div key={c.id} className=\"p-4 bg-gray-50 rounded-lg\">\n            <div className=\"flex justify-between text-sm text-gray-500 mb-2\">\n              <span>架构师 {c.userId}</span>\n              <span>{new Date(c.createdAt).toLocaleDateString()}</span>\n            </div>\n            <p className=\"text-gray-800 leading-relaxed\">{c.content}</p>\n          </div>\n        ))}\n      </div>\n    </section>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**RSC 对庞大前端 Bundle 架构的极限解耦与体积零增加（Zero-Bundle-Size）特性**：\n过往基于 CSR 模式下，即便是只需要做极少量的日期换算格式或者处理 Markdown 标记，也必须将 \\`moment.js\\` 或者 \\`marked.js\\` 这些几百 KB 的重型运算依赖强行塞给前端用户下载。\nRSC 的范式突破在于：它的作用域只存在于后端的执行堆。无论在服务端组件层顶引入了何等巨大的第三方转换计算库组件链条配置，在通过流线化机制（Streaming HTML/JSON payload）串行化向下文推送的成品产物中，绝对不会夹带一丝丝执行其过程依赖库本身的 JS 代码源——对该组件一切逻辑开辟的包加载负担对于移动端消费客户产生的增加消耗是实打实的 **0 Byte**。`\n  },\n  {\n    id: 'fe-3-3', type: 'frontend',\n    title: '课程 3.3：岛屿架构与乐观更新',\n    category: '模块3：Next.js 与服务端渲染', track: '前端架构',\n    moduleNumber: 3, lessonNumber: 3,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 岛屿架构 (Islands Architecture) 与客户端挂载机制\n\n## 业务上下文\n构建出全量静态的极速主骨架之后，为了响应点赞交互等需要具备实时通讯且携带重负载动态组件特性动作的组件区块时，必须依靠混合式分层的搭建原则。\\n**岛屿架构** 的奥义就是将大片死亡静寂海洋般的 SSR 宏观模版中间，如同点缀星辰般地放置一处处能够脱离服务端环境运行，高度自激活并在运行时带有事件钩挂响应体的小型独立交互模块岛屿。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\n// 1. 核心指令：标识为 Client Component。脱离服务端渲染栈层而仅参与客户端的水化挂载与状态留存分拨\n'use client';\n\nimport { useState } from 'react';\n\nexport function InteractiveLikeButton({ videoId, initialLikes }: { videoId: string, initialLikes: number }) {\n  const [likes, setLikes] = useState(initialLikes);\n  const [isLiked, setIsLiked] = useState(false);\n\n  // 2. Optimistic UI (乐观预置响应)\n  // 当事件触发不等待那几百毫秒级别的远程微服务写入成功握手回应\n  // 系统抢先把预期理想呈现视图强制投放到本地浏览器画板层\n  const handleLike = async () => {\n    setIsLiked(!isLiked);\n    setLikes((prev) => (isLiked ? prev - 1 : prev + 1));\n\n    try {\n      await fetch(\\`/api/videos/\\${videoId}/like\\`, {\n        method: 'POST',\n        headers: { Authorization: \\`Bearer \\${localStorage.getItem('jwt')}\\` }\n      });\n    } catch (e) {\n      // 一旦异步长线校验崩绝或被阻击落库失败，利用 JS 事件循环执行后续异常捕捉实现对冲数据滚回撤销复原\n      setIsLiked(isLiked);\n      setLikes((prev) => (isLiked ? prev + 1 : prev - 1));\n      alert('网络链路校验未经过通过，已进行视图安全平滑回滚');\n    }\n  };\n\n  return (\n    <button \n      onClick={handleLike}\n      className={\\`font-bold py-2 px-6 rounded-full transition-transform active:scale-95 \\${\\n        isLiked ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-800'\\n      }\\`}\n    >\n      {isLiked ? '体系已采录' : '启动点赞追踪'} {likes.toLocaleString()}\n    </button>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**作用域强制隔离矩阵特性**：\nNext.js 使用一套非常规的树枝依赖边界切割协议约束层结构。在服务端组件树 (Server Tree) 中允许像组装叶子一般接点套入 \\`'use client'\\` 客户端独立隔离组件分支。在此边界节点向外衍生的一切代码将被脱离主框架服务器编译执行线，连缀成为要打包发送至网关浏览器侧单独推演执行的 Client Bundle 集集。\n但在此机制准则下存在不可触犯的逆流铁律：**客户端组件代码段内绝对禁止 \\`import\\` 导入带有未标记的 Server 组件体。** 任何试图强行在具备交互闭包或者全局状态存蓄功能的组件之中嵌套服务器私有计算类的行为操作，都会引致编译沙箱判定出系统极度失序且资源泄漏，而发生致命解压降级熔断。`\n  },\n  {\n    id: 'fe-4-1', type: 'frontend',\n    title: '课程 4.1：构建看板布局',\n    category: '模块4：SaaS 洞察看板', track: '前端架构',\n    moduleNumber: 4, lessonNumber: 1,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 掌握 CSS Grid 定位技巧构建大屏体系\n\n## 业务上下文\n企业级 SaaS 产品后台最引人瞩目的大规模数据统计中控面板，其布局并非是一维流水化陈列元素的粗制累积可以承受的。由于面临极密度的核心 KPI 数据方块与多元折线表盘排布，采用 **CSS Grid 网格系统** 建立多维度、双通道且带有极强轨道区域限制定位能效的展示骨架体系是业界唯一的严谨实施标准规范。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React from 'react';\n\n// 1. 无状态组件抽离与属性类型防篡改封闭设限\ninterface StatProps {\n  title: string; value: number | string; trend: number; info: string;\n}\n\nconst StatCard = ({ title, value, trend, info }: StatProps) => (\n  // 原子展示单元维持高内聚内部流性及边缘阴影层遮照设计\n  <div className=\"bg-white rounded-xl border border-gray-100 p-6 flex flex-col shadow-sm relative overflow-hidden\">\n    <h3 className=\"text-gray-500 text-sm font-medium mb-1\">{title}</h3>\n    <div className=\"text-3xl font-extrabold text-gray-900\">{value}</div>\n    \n    <div className=\"mt-4 flex items-center justify-between\">\n      <span className={\\`text-xs font-bold \\${trend > 0 ? 'text-green-500' : 'text-red-500'}\\`}>\n        {trend > 0 ? '↗' : '↘'} {Math.abs(trend)}% 相较基线期\n      </span>\n      <span className=\"text-xs text-gray-400\">{info}</span>\n    </div>\n  </div>\n);\n\n// 2. 利用 Tailwind 体系调度搭建全局性多设备分辨率弹性断点格架矩阵网\nexport default function DashboardGrid() {\n  return (\n    <div className=\"p-8 bg-gray-50 min-h-screen\">\n      <h1 className=\"text-2xl font-bold text-gray-900 mb-8 border-b border-gray-200 pb-4\">系统观测塔台</h1>\n      \n      {/* \n        利用 grid-cols-* 指令建立响应式轨道防撞排布边界锁护系统：\n        - 基础屏幕（移动级尺寸）：降维打击全屏铺平，每行挤占全部轨道 1 格展示。\n        - 中等屏幕（md 基线阈值）：拓充双线轨道矩阵切割等额阵列表。\n        - 终极带鱼宽屏（xl 基核之上）：展开完整体系为四大巨型核心矩阵 4 级。\n      */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6\">\n        <StatCard title=\"日均 QPS 洪峰\" value=\"2,405,119\" trend={12.5} info=\"监控过去 24h 峰点\" />\n        <StatCard title=\"分布式缓存覆盖击命中\" value=\"98.2%\" trend={0.4} info=\"底层 DB 零穿刺漏穿率\" />\n        <StatCard title=\"并发连接承载终端\" value=\"14,233\" trend={-2.1} info=\"维持长连接存活态\" />\n        <StatCard title=\"故障节点集群剥离数\" value=\"0\" trend={0} info=\"环境稳如磐石\" />\n      </div>\n    </div>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**网格边界 BFC (Block Formatting Context) 层架构稳定性**：\n一维 \\`flex\\` 系统以内部主轴元素挤压空间作为对齐标尺，它的高度流动性会使得复杂多元素内嵌套如果遇到异常变体内容输入尺寸激增极容易冲出界限将原本其它并列表单直接“撑破”甚至跨行挤出可视窗口引发现象级别的重排错乱（Reflow Bug）。而通过 \\`display: grid\\` 所宣告构建出空间是一种高刚性的坐标体系框架，框架外壳犹如钢筋模板设定了单元体长宽极限界线。当内生文本或嵌入体暴涨时它也会在自我 BFC 墙壁内实施阶段性隐藏（Overflow:hidden）与文字打散切断动作，以此死保整个大图模块版式不崩防，达到对界外完全毫无影响及牵涉波及的隔离维稳作用。`\n  },\n  {\n    id: 'fe-4-2', type: 'frontend',\n    title: '课程 4.2：可视化实时数据',\n    category: '模块4：SaaS 洞察看板', track: '前端架构',\n    moduleNumber: 4, lessonNumber: 2,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 规避过度依赖：构建原生 SVG 可视化映射\n\n## 业务上下文\n工程实践中时常会遇到仅需要呈现微型内嵌趋势线谱 (Sparklines) 等极其简明轻量的图形化视图数据需求。若是盲目为这么一小段展示强行牵扯加载 \\`ECharts\\` 或 \\`D3.js\\` 等动辄逼近 1MB 量级的非编译型巨石庞然大物库全集，会造成惊恐的首屏性能严重损毁惩戒以及极其过度的代码依赖膨胀。\n转而发掘使用底层 Web 标准规范中的 SVG (Scalable Vector Graphics) 解析工具系统构建自有的一套转换映射图元指令，能将复杂结构体系进行绝对降维。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React from 'react';\n\ninterface LineChartProps {\n  data: number[];\n  color?: string;\n}\n\nexport function Sparkline({ data, color = '#2563eb' }: LineChartProps) {\n  if (data.length === 0) return null;\n\n  // 1. 基点极差计算矩阵\n  const max = Math.max(...data);\n  const min = Math.min(...data);\n  const range = max - min || 1;\n\n  // 虚拟展示画布容器界定物理限制墙壁阈值\n  const height = 40;\n  const width = 100;\n\n  // 2. 数学收敛投射转换成指令文本链：提取真实数据中的离散信号组 \n  // 将极差值以归一化转换算率按比例映射降压锁定落到 100x40 的物理展示屏幕二维点区内\n  const points = data\n    .map((val, i) => {\n      const x = (i / (data.length - 1)) * width;\n      const y = height - ((val - min) / range) * height; // 浏览器 SVG 绘图系 Y 轴向下递增法则\n      return \\`\\${x},\\${y}\\`;\n    })\n    .join(' L '); // L（LineTo）挂钩绘制绝对路径游标连线\n\n  return (\n    // viewBox 提供了内聚相对维度的完美弹性比例框架以避免失真的产生\n    <svg viewBox={\\`0 0 \\${width} \\${height}\\`} className=\"w-full h-10 overflow-visible mt-4\">\n      <path\n        // M (Move To 起始移送起点触点笔触发位置)\n        d={\\`M \\${points}\\`}\n        fill=\"none\"\n        stroke={color}\n        strokeWidth=\"2.5\"\n        strokeLinecap=\"round\" // 将线条末端截断点通过几何包裹修饰为优美弧角接头\n        strokeLinejoin=\"round\" \n        className=\"drop-shadow-sm\"\n      />\n    </svg>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**SVG 声明式坐标体系的超维无损拉伸引擎**：\n我们常见的 \\`.jpg\\` 与 \\`.png\\` 图片在本质上是在二维栅格空间里按固定行与列填充每一个微粒色块（Pixel）生成的位图。当对其实行屏幕缩放等超维放大物理变距动作时其就会立即引发周围色彩色差补足马赛克污染发糊。\n而在 SVG 内部所有展示效果都是一组以类 XML 作为封皮承载框架描述的无极化几何算法路径文本体本身。这种纯代数方程式组态不仅可以在 React 框架里如组件一般接受入参变量（如颜色、路径），并且在遇到任意 4K/8K 设备超高清极限尺寸屏幕延展被强行放大的时机背景下也是经过图形处理器内核通过再次进行数学重新矢量计算渲染出最精绝的全新像素体图点。做到全视无界，内存消耗恒定，绝对不会产生失真现象。`\n  },\n  {\n    id: 'fe-5-1', type: 'frontend',\n    title: '课程 5.1：引入 Axios 拦截器',\n    category: '模块5：微前端网关与安全拦截', track: '前端架构',\n    moduleNumber: 5, lessonNumber: 1,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 构建健壮可控的 Axios 全面拦截关隘\n\n## 业务上下文\n大型化单页组件系统通常拥散落各地多达两三百个用于对各类远程微服务通信获取的 API 接口函数。若让每一个离散方法独立自身担负向其中写入并解包鉴权请求头（例如植入 \\`Bearer Token\\` 的校验环节）、排查甄别响应网络 401 错乱回流执行身份被重置重登陆等等海量极其累赘琐碎重复的业务关联判定行为。此乃最高危级别的工程混乱代码腐化之源（Code Smell）。\n通过搭建提取至顶层路由环境前哨关卡执行监听和篡改预先操作的 **Axios Interceptors 拦截网系统** 可以执行针对此所有网络交互生命期的绝对霸权把控管理中心能力闭合。\n\n## 代码与配置解析\n\n\\`\\`\\`typescript\nimport axios from 'axios';\n\n// 1. 基干层实例切割化封装\nexport const apiClient = axios.create({\n  baseURL: '/api',\n  timeout: 8000, // 为保障高延迟网络不长时间锁死资源而触发超载熔断截点降落时间限制\n});\n\n// 2. HTTP Request 发射出境关口安检层：为所有的裸求包裹注入并施加环境必须携带信息层级装甲\napiClient.interceptors.request.use(\n  (config) => {\n    // 跨域穿透凭证自备组装\n    const token = localStorage.getItem('jwt');\n    if (token) {\n      config.headers['Authorization'] = \\`Bearer \\${token}\\`;\n    }\n    // 务必返回重组改制体完成握手，否则 Promise 等待链将进入无穷死循挂架空窗\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n// 3. HTTP Response 反扑接收反击安审层：从数据包上获取执行判定状态识别剔除及跳转重路由统帅调度指令\napiClient.interceptors.response.use(\n  (response) => response, \n  (error) => {\n    if (error.response?.status === 401) {\n      console.warn('捕获非法授权异常状态边界响应触发，施行即刻状态凭证清盘并降阶安全引流重定向执行流程');\n      // 切断过时死角伪身状态关联链接源\n      localStorage.removeItem('jwt');\n      window.location.href = '/login';\n    }\n    // 全数暴露并继续层级反击上抛异常供最终组件展示层面实现友好接应拦截化解释错误状态展示\n    return Promise.reject(error);\n  }\n);\n\\`\\`\\`\n\n## 底层原理深度剖析\n**承诺队列链 (Promise Pipeline) 与事件控制循环生命期挂扣**：\nAjax 的发展演进是由原生繁复杂错纠缠不清的 \\`XMLHttpRequest(XHR)\\` 过步进化升级拥抱纯异步调配执行架构 Promise 管理模型的进化演变。而在 Axios 高屋建瓴的事件包装设计思路内部执行中拦截阵列器体系质上被架构被转化为包含一系列首尾环系环环相接的流水线串联长函数组群链条：\\`Promise.resolve(config).then(requestInterceptor).then(dispatchXHR).then(responseInterceptor)\\`。\n在这种流动的隧道传输模型中每一截拦截站层在内部接收并做完操作完自身任务时，一旦漏未加上 \\`return\\` 以往外翻手推出其被持有的最新报文封包或者用 \\`Promise.reject\\` 打断进程反馈等措施举措将致使这个包裹如抛入太空黑体再也没有出站动作结果，前端组件发出指令悬置化死死被按压等待挂死进入空转毁灭死域。这成为诸多拦截器翻车异常最大的血泪大坑点源泉。`\n  },\n  {\n    id: 'fe-5-2', type: 'frontend',\n    title: '课程 5.2：实战集成与安全探讨',\n    category: '模块5：微前端网关与安全拦截', track: '前端架构',\n    moduleNumber: 5, lessonNumber: 2,\n        illustrationUrl: '/illustrations/frontend_architecture.png',\n    startingCode: '', targetCode: '',\n    instructions: `# 请求隔离应用终端交融聚合系统实战演练\n\n## 业务上下文\n最后冲刺的业务将完全仰仗着前面所有构建筑完成的地基：高度集成融合并抽空了全部烦琐环境处理逻辑的网络终端实例系统，进行仅专注于主业务干线本身逻辑纯粹的联调数据贯通调用工作战线展示。从而揭露及验证一个健壮、无需担心状态安全遗祸及高度干净清爽的可调用 API 应用接口结构在端应用侧如何完成使用组建挂钩操作展示过程并进行深入隐秘隐患挖掘探讨。\n\n## 代码与配置解析\n\n\\`\\`\\`tsx\nimport React, { useState } from 'react';\nimport { apiClient } from './apiClient';\n\nexport default function SecuritySandbox() {\n  const [token, setToken] = useState<string | null>(localStorage.getItem('jwt'));\n  const [securedData, setSecuredData] = useState<any>(null);\n\n  // 1. 发起源网端点校验核对授权登入身份：完成基石奠定层操作\n  const handleAuthExchange = async () => {\n    try {\n      // 摒弃了所有的 try catch 对状态代码的多余杂项干预以及 ContentType 预埋等等冗复劳动量工作\n      const res = await apiClient.post('/auth/login', { username: 'admin', password: 'password' });\n      \n      const sessionSeal = res.data.token;\n      localStorage.setItem('jwt', sessionSeal);\n      setToken(sessionSeal);\n    } catch (err) {\n      alert('连接被后台系统环境网关硬生核销拒捕截断.');\n    }\n  };\n\n  // 2. 将核心权限被深度护墙阻隔数据体系实行越权式提取展现使用端测试层功能\n  const pullSensitiveAssets = async () => {\n    try {\n      // 没有任何参数传递干扰以及显性声明请求拦截头部设定内容介入打断本身数据获取动作结构纯洁度呈现性构建\n      const res = await apiClient.get('/users/profile');\n      setSecuredData(res.data);\n    } catch (err) {\n      // 这里只需要负责在控制层留足应对失败异常兜底操作余地，所有的身份销毁刷新拦截重写转引重试体系已于隐秘拦截拦截网中全部自动运转完毕完成终结执行操作闭环无需干预分神分化。\n      console.log('数据流被击溃并由前线代理指挥阵拦截吸收')\n    }\n  };\n\n  return (\n    <div className=\"p-10 border rounded shadow bg-white max-w-lg mx-auto mt-10\">\n      {!token ? (\n        <button onClick={handleAuthExchange} className=\"bg-gray-800 text-white w-full py-4 rounded-lg font-bold\">\n          颁发密钥授权建立核心链接区\n        </button>\n      ) : (\n        <div className=\"space-y-4\">\n          <div className=\"bg-green-50 text-green-700 p-3 rounded border border-green-200 text-sm font-medium\">授权通行环路系统连贯稳定在线运转中...</div>\n          <button onClick={pullSensitiveAssets} className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold transition\">\n            窃取展示保护层内部隐私数据内容展现\n          </button>\n          \n          {securedData && (\n            <pre className=\"text-left bg-gray-900 text-gray-100 p-4 mt-4 text-xs overflow-auto rounded-lg rounded-t-none border-t-4 border-blue-500\">\n               {JSON.stringify(securedData, null, 2)}\n            </pre>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\\`\\`\\`\n\n## 底层原理深度剖析\n**跨站执行剧本恶意入侵截断 (XSS Attack) 防卫隐患安全模型基底结构剖解**：\n我们当下一直于课程演练之中把 JWT 的授权凭单文本通过直接赋值的存储方式安置在普通易操作读取触控获取的 API 接口即刻调用读取暴露点：\\`localStorage\\` 里存储。\n这是前端应用生态圈一个被大面积滥用于基础原型和图纸层设计实现期内的粗陋安全短板重大漏洞结构问题。虽然这种开发使用操作便捷门禁极粗：但这由于可以非常轻易被直接注入 \\`window.localStorage.getItem\\` 即可将所有敏感密钥文本给瞬间夺取全收抽调导出外域去往执行恶意截持攻击。而在防守更周密森严高级化架构成熟金融及政务大型防线体系阵型部署生产生态应用系统环节领域内部。这个通关权限门票都会强制转移依赖放入被加上了极为特殊限制声明特质的 \\`HttpOnly Cookie\\` 隧道中进行运输潜行保护传递操作隐没隐藏遮蔽拦截隐藏处理操作！\n加上此标记等同于给前端在内部环境切除切断了浏览器自身对于其任何的 JS 操作权限操作能力，将读取该密钥内容的职权彻底让渡单发给网络发出动作通信拦截请求。做到：只被带着通信却绝不可能在应用环境体系被读取出的不可见的极致数据物理空间隐蔽安全性防护护栏壁垒拦截机制结构部署。`\n  }\n];\n"
              },
              {
                "name": "lessons.ts",
                "type": "file",
                "path": "frontend/src/data/lessons.ts",
                "language": "typescript",
                "content": "import type { Lesson } from '../types';\nimport { frontendM1M2 } from './frontend-m1-m2';\nimport { frontendM3M5 } from './frontend-m3-m5';\nimport { backendM1M3 } from './backend-m1-m3';\nimport { backendM4M6 } from './backend-m4-m6';\n\nimport { advancedFrontend } from './advanced-frontend';\nimport { advancedBackend } from './backend-advanced';\nimport { devopsAdvanced } from './devops-advanced';\n\n/**\n * 完整课程目录：合并所有模块的课程数据\n *\n * 方向1：超大规模前端架构（React、Next.js、TypeScript）\n *   模块1-5：原基础与架构相关\n *\n * 方向2：弹性企业后端与 DevOps（Spring Boot 3.x）\n *   模块1-6：原 Spring Boot 与容器基础\n * \n * 方向3：全栈进阶与工程化\n *   模块6(横向)：前端深水区高级架构\n *   模块7：微服务进阶、网关与 GraphQL\n *   模块8：自动化测试基建、CI/CD流水线与高级 K8s\n */\nexport const lessons: Lesson[] = [\n    ...frontendM1M2,\n    ...frontendM3M5,\n    ...backendM1M3,\n    ...backendM4M6,\n    ...advancedFrontend,\n    ...advancedBackend,\n    ...devopsAdvanced,\n];\n"
              }
            ]
          },
          {
            "name": "index.css",
            "type": "file",
            "path": "frontend/src/index.css",
            "language": "css",
            "content": "/* =====================================================\n * CodeForge — Global Styles\n * Light theme using Google Material Design palette\n * ===================================================== */\n\n@import \"tailwindcss\";\n\n/* ─── Google Material Color Tokens ─── */\n:root {\n  --g-blue: #4285F4;\n  --g-red: #EA4335;\n  --g-yellow: #FBBC05;\n  --g-green: #34A853;\n\n  --g-bg: #FFFFFF;\n  --g-surface: #F8F9FA;\n  --g-border: #DADCE0;\n\n  --g-text-1: #202124;\n  /* primary text */\n  --g-text-2: #5F6368;\n  /* secondary text */\n  --g-text-3: #80868B;\n  /* tertiary / hint */\n}\n\nhtml,\nbody,\n#root {\n  height: 100%;\n  margin: 0;\n  background: var(--g-bg);\n  color: var(--g-text-1);\n  font-family: 'Google Sans', 'Inter', system-ui, -apple-system, sans-serif;\n  -webkit-font-smoothing: antialiased;\n}\n\n/* ─── Monaco Editor Decoration Classes ─── */\n\n/* Ghost text: the un-typed target code shown as light gray */\n.ghost-text-decoration {\n  color: #C4C7C5 !important;\n  font-style: normal !important;\n}\n\n/* Confirmed text: characters the user typed correctly */\n.confirmed-text-decoration {\n  color: var(--g-text-1) !important;\n  font-weight: 500 !important;\n}\n\n/* Error flash: brief red highlight on wrong keystroke */\n.error-flash-decoration {\n  background-color: rgba(234, 67, 53, 0.15) !important;\n  border-bottom: 2px solid var(--g-red) !important;\n}\n\n/* Inline comment: instructor annotation */\n.comment-decoration {\n  color: var(--g-text-3) !important;\n  font-style: italic !important;\n  opacity: 0.85;\n}\n\n/* ─── Animations ─── */\n@keyframes fade-in {\n  from {\n    opacity: 0;\n    transform: translateY(4px);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.animate-fade-in {\n  animation: fade-in 0.25s ease-out;\n}\n\n/* ─── Scrollbar (subtle light style) ─── */\n::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n  background: var(--g-border);\n  border-radius: 3px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: #BDC1C6;\n}\n\n/* ─── Prose (markdown) overrides for light theme ─── */\n.prose-light h1,\n.prose-light h2,\n.prose-light h3 {\n  color: var(--g-text-1);\n  font-weight: 600;\n}\n\n.prose-light p,\n.prose-light li {\n  color: var(--g-text-2);\n  line-height: 1.75;\n}\n\n.prose-light strong {\n  color: var(--g-text-1);\n}\n\n.prose-light code {\n  color: var(--g-blue);\n  background: #E8F0FE;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-size: 0.85em;\n}\n\n.prose-light a {\n  color: var(--g-blue);\n}\n\n/* ─── Selection ─── */\n::selection {\n  background: rgba(66, 133, 244, 0.2);\n}"
          },
          {
            "name": "main.tsx",
            "type": "file",
            "path": "frontend/src/main.tsx",
            "language": "typescript",
            "content": "import { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\nimport './index.css';\n\ncreateRoot(document.getElementById('root')!).render(\n    <StrictMode>\n        <App />\n    </StrictMode>\n);\n"
          },
          {
            "name": "types.ts",
            "type": "file",
            "path": "frontend/src/types.ts",
            "language": "typescript",
            "content": "/* ============================================================\n * TypeScript interfaces for the CodeForge learning platform\n * ============================================================ */\n\n/** A single lesson in the curriculum */\nexport interface Lesson {\n    id: string;\n    /** Determines which renderer the left pane uses */\n    type: 'frontend' | 'backend';\n    title: string;\n    /** Category label shown in the sidebar (module name) */\n    category: string;\n    /** Track identifier for grouping */\n    track: string;\n    /** Module number within the track */\n    moduleNumber: number;\n    /** Lesson number within the module */\n    lessonNumber: number;\n    /** Markdown-formatted instructions / objectives */\n    instructions: string;\n    /** Mermaid diagram markup (backend lessons) */\n    diagramMarkup?: string;\n    /** Illustration image for the lesson */\n    illustrationUrl?: string;\n    targetCode?: string;\n    startingCode?: string;\n    language?: string;\n    comments?: any[];\n}\n"
          },
          {
            "name": "vite-env.d.ts",
            "type": "file",
            "path": "frontend/src/vite-env.d.ts",
            "language": "typescript",
            "content": "/// <reference types=\"vite/client\" />\n"
          }
        ]
      },
      {
        "name": "tsconfig.json",
        "type": "file",
        "path": "frontend/tsconfig.json",
        "language": "json",
        "content": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2020\",\n    \"useDefineForClassFields\": true,\n    \"lib\": [\"ES2020\", \"DOM\", \"DOM.Iterable\"],\n    \"module\": \"ESNext\",\n    \"skipLibCheck\": true,\n    \"moduleResolution\": \"bundler\",\n    \"allowImportingTsExtensions\": true,\n    \"isolatedModules\": true,\n    \"moduleDetection\": \"force\",\n    \"noEmit\": true,\n    \"jsx\": \"react-jsx\",\n    \"strict\": true,\n    \"noUnusedLocals\": false,\n    \"noUnusedParameters\": false,\n    \"noFallthroughCasesInSwitch\": true,\n    \"forceConsistentCasingInFileNames\": true\n  },\n  \"include\": [\"src\"]\n}\n"
      },
      {
        "name": "tsconfig.server.json",
        "type": "file",
        "path": "frontend/tsconfig.server.json",
        "language": "json",
        "content": "{\n    \"compilerOptions\": {\n        \"target\": \"ES2020\",\n        \"module\": \"ESNext\",\n        \"moduleResolution\": \"bundler\",\n        \"strict\": true,\n        \"esModuleInterop\": true,\n        \"skipLibCheck\": true,\n        \"outDir\": \"./dist-server\",\n        \"rootDir\": \".\",\n        \"declaration\": false,\n        \"forceConsistentCasingInFileNames\": true\n    },\n    \"include\": [\n        \"server.ts\",\n        \"api/**/*.ts\"\n    ]\n}"
      },
      {
        "name": "vite.config.ts",
        "type": "file",
        "path": "frontend/vite.config.ts",
        "language": "typescript",
        "content": "import { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport tailwindcss from '@tailwindcss/vite';\n\nexport default defineConfig({\n    plugins: [react(), tailwindcss()],\n    server: {\n        port: 5173,\n        proxy: {\n            '/api': {\n                target: 'http://localhost:8080',\n                changeOrigin: true,\n            },\n        },\n    },\n});\n"
      }
    ]
  },
  {
    "name": "generate_codebase.js",
    "type": "file",
    "path": "generate_codebase.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst ROOT_DIR = __dirname;\nconst MAX_FILE_SIZE = 150000; // 150KB limit to prevent massive output\n\nconst IGNORED_DIRS = new Set([\n    'node_modules', '.git', '.idea', 'dist', 'build', 'target', '.vscode', '.gemini'\n]);\n\nconst IGNORED_FILES = new Set([\n    'package-lock.json', 'yarn.lock', '.DS_Store', 'mvnw', 'mvnw.cmd'\n]);\n\nconst EXTENSIONS = new Set([\n    '.ts', '.tsx', '.js', '.jsx', '.json', '.html', '.css', '.md', '.java', '.xml', '.yml', '.yaml', '.sh', '.properties'\n]);\n\nfunction getLanguage(fileName) {\n    const ext = path.extname(fileName).toLowerCase();\n    switch (ext) {\n        case '.ts': case '.tsx': return 'typescript';\n        case '.js': case '.jsx': return 'javascript';\n        case '.java': return 'java';\n        case '.json': return 'json';\n        case '.html': return 'html';\n        case '.css': return 'css';\n        case '.md': return 'markdown';\n        case '.xml': return 'xml';\n        case '.yml': case '.yaml': return 'yaml';\n        case '.properties': return 'properties';\n        case '.sh': return 'shell';\n        default: return 'text';\n    }\n}\n\nfunction processDirectory(dirPath, relativePath = '') {\n    const result = [];\n    try {\n        const items = fs.readdirSync(dirPath);\n        for (const item of items) {\n            if (IGNORED_DIRS.has(item) || IGNORED_FILES.has(item)) continue;\n\n            const fullPath = path.join(dirPath, item);\n            const itemRelativePath = path.join(relativePath, item);\n            const stats = fs.statSync(fullPath);\n\n            if (stats.isDirectory()) {\n                const children = processDirectory(fullPath, itemRelativePath);\n                if (children.length > 0) {\n                    result.push({\n                        name: item,\n                        type: 'directory',\n                        path: itemRelativePath,\n                        children\n                    });\n                }\n            } else if (stats.isFile()) {\n                const ext = path.extname(item).toLowerCase();\n                if (EXTENSIONS.has(ext)) {\n                    if (stats.size > MAX_FILE_SIZE) continue;\n                    let content = '';\n                    try {\n                        content = fs.readFileSync(fullPath, 'utf8');\n                    } catch (e) {\n                        continue; // Skip if cant read as utf8\n                    }\n                    result.push({\n                        name: item,\n                        type: 'file',\n                        path: itemRelativePath,\n                        language: getLanguage(item),\n                        content: content\n                    });\n                }\n            }\n        }\n    } catch (error) {\n        console.warn(`Could not read directory ${dirPath}`, error);\n    }\n    return result;\n}\n\nconsole.log('Generating codebase.json...');\nconst tree = processDirectory(ROOT_DIR);\nconst outputFilePath = path.join(ROOT_DIR, 'frontend', 'public', 'codebase.json');\nfs.writeFileSync(outputFilePath, JSON.stringify(tree, null, 2));\nconsole.log(`Saved codebase tree to ${outputFilePath}`);\n"
  },
  {
    "name": "migrate-instructions.js",
    "type": "file",
    "path": "migrate-instructions.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst dataDir = path.join(__dirname, 'frontend/src/data');\nconst files = fs.readdirSync(dataDir).filter(f => f.endsWith('.ts') && f !== 'lessons.ts');\n\nfiles.forEach(file => {\n    const filePath = path.join(dataDir, file);\n    let content = fs.readFileSync(filePath, 'utf8');\n\n    const regex = /instructions:\\s*(`[\\s\\S]*?`),\\s*targetCode:\\s*(`[\\s\\S]*?`),/g;\n\n    let modified = false;\n    content = content.replace(regex, (match, p1, p2) => {\n        if (p1.includes('## 📝 完整参考代码')) {\n            return match;\n        }\n        modified = true;\n\n        let evaledString;\n        try {\n            evaledString = eval(p2);\n        } catch (e) {\n            console.error('Failed to eval p2 in ' + file);\n            return match;\n        }\n\n        // We escape backticks, backslashes and dollar signs so they render verbatim in the markdown text\n        // Note: we need to escape backslashes first so we don't escape our freshly added escapes!\n        let safeContent = evaledString.replace(/\\\\/g, '\\\\\\\\')\n            .replace(/`/g, '\\\\`')\n            .replace(/\\$/g, '\\\\$');\n\n        const newInstructions = p1.substring(0, p1.length - 1) +\n            '\\\\n\\\\n## 📝 完整参考代码\\\\n\\\\`\\\\`\\\\`typescript\\\\n' +\n            safeContent +\n            '\\\\n\\\\`\\\\`\\\\`' + '`'; // close p1\n\n        return `instructions: ${newInstructions},\\n        targetCode: ${p2},`;\n    });\n\n    if (modified) {\n        fs.writeFileSync(filePath, content, 'utf8');\n        console.log(`Updated ${file}`);\n    }\n});\n"
  },
  {
    "name": "remove_analogies.js",
    "type": "file",
    "path": "remove_analogies.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst dataDir = path.join(__dirname, 'frontend/src/data');\nconst files = fs.readdirSync(dataDir).filter(f => f.endsWith('.ts'));\n\nconst replacements = [\n    // Fluff and Analogies Replacements\n    [\"死静态\", \"纯静态\"],\n    [\"一大坨\", \"大量\"],\n    [\"一坨\", \"一部分\"],\n    [\"老掉牙\", \"传统\"],\n    [\"海王模式\", \"统一\"],\n    [\"海王\", \"全局\"],\n    [\"接管接驳\", \"集中接管\"],\n    [\"被打爆\", \"大并发过载\"],\n    [\"必杀技\", \"核心机制\"],\n    [\"天生就是\", \"本身具备\"],\n    [\"大招\", \"高级特性\"],\n    [\"就地处决\", \"直接拦截\"],\n    [\"坠毁\", \"抛出异常\"],\n    [\"纯净得令人心醉\", \"结构清晰\"],\n    [\"臭长\", \"冗长\"],\n    [\"保驾护送\", \"安全传递\"],\n    [\"拿钱\", \"获取数据\"],\n    [\"浩劫\", \"漏洞\"],\n    [\"流氓\", \"恶意\"],\n    [\"偷灌\", \"注入\"],\n    [\"肆虐\", \"执行\"],\n    [\"死锁\", \"固定绑定\"],\n    [\"核聚变\", \"底层逻辑改变\"],\n    [\"大堂\", \"系统首页\"],\n    [\"司令塔\", \"主控视图\"],\n    [\"叫板\", \"发出请求\"],\n    [\"击溃\", \"验证获得响应\"],\n    [\"拿回钥匙\", \"获取令牌\"],\n    [\"收割者\", \"数据获取流程\"],\n    [\"防线\", \"安全防范\"],\n    [\"魔术前缀\", \"授权前缀\"],\n    [\"魔术字\", \"授权前缀\"],\n    [\"魔术\", \"特殊机制\"],\n    [\"魔法\", \"特殊逻辑\"],\n    [\"结界\", \"隔离保护\"],\n    [\"法阵\", \"坐标系\"],\n    [\"汪洋大\", \"庞大的静态\"],\n    [\"汪洋\", \"静态层\"],\n    [\"大海\", \"系统\"],\n    [\"岛屿架构\", \"Islands 架构\"],\n    [\"木乃伊体\", \"无交互结构\"],\n    [\"注水复苏\", \"客户端挂载\"],\n    [\"护城河\", \"防护边界\"],\n    [\"防波堤\", \"防护层\"],\n    [\"客栈大门\", \"系统登录页\"],\n    [\"保卫科\", \"拦截器业务\"],\n    [\"傻瓜组件\", \"上层组件\"],\n    [\"想象\", \"假设\"],\n    [\"仿佛\", \"如同\"],\n    [\"就像\", \"类似于\"],\n    [\"如同\", \"类似\"],\n    [\"秘密武器\", \"核心手段\"],\n    [\"决胜\", \"重构\"],\n    [\"战场\", \"场景\"],\n    [\"无穷无尽\", \"极巨量\"],\n    [\"灾难\", \"错误\"],\n    [\"塌陷\", \"布局失效\"],\n    [\"护心防卫锁\", \"安全拦截器\"],\n    [\"深渊\", \"底端系统\"],\n    [\"极速\", \"高性能\"],\n    [\"兵站\", \"实例\"],\n    [\"护盾\", \"安全代理\"],\n    [\"死令法则\", \"必要约定\"],\n    [\"折断\", \"阻断\"],\n    [\"当空\", \"执行异出\"],\n    [\"深库\", \"本地存储深处\"],\n    [\"印封条\", \"配置属性\"],\n    [\"失忆\", \"无法从 JS 读取\"],\n    [\"森冷\", \"严格\"],\n    [\"庞大\", \"大型化\"],\n    [\"帝国\", \"系统架构\"],\n    [\"海量\", \"大量\"],\n    [\"彻底\", \"完全\"],\n    [\"裸奔的儿童游荡在那荒郊\", \"极度缺乏安全防护\"],\n    [\"裸奔的儿童\", \"无防备状态\"],\n    [\"荒郊\", \"环境\"],\n    [\"踢人\", \"清除状态\"],\n    [\"被无情回溯\", \"触发错误回滚\"],\n    [\"无情回溯\", \"错误回滚\"]\n];\n\nfor (const file of files) {\n    const filePath = path.join(dataDir, file);\n    let content = fs.readFileSync(filePath, 'utf-8');\n\n    for (const [match, replace] of replacements) {\n        const regex = new RegExp(match, 'g');\n        content = content.replace(regex, replace);\n    }\n\n    fs.writeFileSync(filePath, content, 'utf-8');\n    console.log(`Cleaned ${file}`);\n}\n"
  },
  {
    "name": "remove_emojis.js",
    "type": "file",
    "path": "remove_emojis.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst dataDir = path.join(__dirname, 'frontend/src/data');\nconst files = fs.readdirSync(dataDir).filter(f => f.endsWith('.ts'));\n\n// Regex to match emojis commonly used in the codebase\nconst emojiPattern = /[💡🧠🎯🔍🚀✨📝✅⭐🔥⚡🤔🎉❤️🤍✓❓🛠️📚🗄️📲📨📱]/g;\n\n// Analogies to simplify\nconst analogies = [\n    { match: /像安检员一样/g, replace: '作为中间件' },\n    { match: /汪洋大海/g, replace: '系统' },\n    { match: /岛屿架构/g, replace: '独立架构' },\n    { match: /防波堤/g, replace: '防护层' },\n    { match: /海王模式：接管接驳/g, replace: '统一接管' },\n    { match: /护城河/g, replace: '防护体系' },\n    { match: /木乃伊体/g, replace: '静态数据' },\n    { match: /注水复苏/g, replace: '重新激活' },\n    { match: /大招/g, replace: '进阶方案' },\n    { match: /核聚变/g, replace: '底层变革' },\n    { match: /防线/g, replace: '安全机制' },\n    { match: /上帝视角/g, replace: '全局视角' },\n    { match: /上帝引擎/g, replace: '核心引擎' }\n];\n\nfor (const file of files) {\n    const filePath = path.join(dataDir, file);\n    let content = fs.readFileSync(filePath, 'utf-8');\n\n    // Remove emojis\n    content = content.replace(emojiPattern, '');\n\n    // Replace analogies\n    for (const a of analogies) {\n        content = content.replace(a.match, a.replace);\n    }\n\n    fs.writeFileSync(filePath, content, 'utf-8');\n    console.log(`Cleaned ${file}`);\n}\n"
  },
  {
    "name": "strip_legacy.js",
    "type": "file",
    "path": "strip_legacy.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst dataDir = path.join(__dirname, 'frontend', 'src', 'data');\nconst files = fs.readdirSync(dataDir).filter(f => f.endsWith('.ts') && f !== 'lessons.ts' && f !== 'frontend-m1-m2.ts');\n\nfor (const file of files) {\n    const filePath = path.join(dataDir, file);\n    let content = fs.readFileSync(filePath, 'utf8');\n\n    // Remove startingCode: '...', \n    content = content.replace(/startingCode:\\s*('.*?'|\".*?\"|`[\\s\\S]*?`),\\s*/g, '');\n\n    // Remove language: 'typescript',\n    content = content.replace(/language:\\s*('.*?'|\".*?\"),\\s*/g, '');\n\n    // Remove targetCode: `...`,\n    content = content.replace(/targetCode:\\s*`[\\s\\S]*?`,\\s*/g, '');\n\n    // Remove comments: [ ... ],\n    content = content.replace(/comments:\\s*\\[[\\s\\S]*?\\],\\s*/g, '');\n\n    fs.writeFileSync(filePath, content, 'utf8');\n    console.log(`Cleaned ${file}`);\n}\n"
  },
  {
    "name": "update_lessons.js",
    "type": "file",
    "path": "update_lessons.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst srcDir = path.join(__dirname, 'frontend/src/data');\nconst backendDir = path.join(__dirname, 'backend/src/main/java/com/tutorial');\n\nfunction readJavaFiles(files) {\n    return files.map(f => fs.readFileSync(path.join(backendDir, f), 'utf8')).join('\\n\\n');\n}\n\nconst backendMap = {\n    'be-1-1': readJavaFiles(['CodeForgeApplication.java']),\n    'be-1-2': readJavaFiles(['mapper/UserMapper.java', 'service/AuthService.java', 'controller/AuthController.java']),\n    'be-2-1': readJavaFiles(['config/JwtFilter.java']),\n    'be-2-2': readJavaFiles(['service/StockService.java']),\n    'be-3-1': readJavaFiles(['consumer/PaymentConsumer.java']),\n};\n\nfunction processLessonFile(filePath) {\n    let content = fs.readFileSync(filePath, 'utf8');\n\n    // Add illustrationUrl\n    content = content.replace(/(id:\\s*['\"]([^'\"]+)['\"],\\s*type:\\s*['\"](frontend|backend)['\"],\\s*title:.*?\\n\\s*category:.*?track:\\s*['\"](.*?)['\"],\\s*\\n\\s*moduleNumber:\\s*(\\d+).*?\\n)/g, (match, p1, id, type, track, mod) => {\n        let img = '/illustrations/frontend_architecture.png';\n        if (type === 'backend') {\n            if (mod === '2') img = '/illustrations/security_auth.png';\n            else img = '/illustrations/backend_microservices.png';\n        }\n        if (track && track.toLowerCase().includes('devops')) {\n            img = '/illustrations/devops_deployment.png';\n        }\n        // Avoid adding twice\n        if (content.includes(`illustrationUrl: '`)) {\n            // Wait, this global checking is bad.\n        }\n        return match + `        illustrationUrl: '${img}',\\n`;\n    });\n\n    // Replace targetCode for backend lessons\n    for (const [id, javaCode] of Object.entries(backendMap)) {\n        if (content.includes(`id: '${id}'`)) {\n            const regex = new RegExp(`(id: '${id}'[\\\\s\\\\S]*?)targetCode:\\\\s*\\`[\\\\s\\\\S]*?\\`,\\\\n\\\\s*instructions:`, 'g');\n            content = content.replace(regex, `$1targetCode: \\`${javaCode.replace(/`/g, '\\\\`')}\\`,\\n        instructions:`);\n        }\n    }\n\n    fs.writeFileSync(filePath, content);\n    console.log(`Processed ${filePath}`);\n}\n\nconst files = fs.readdirSync(srcDir).filter(f => f.endsWith('.ts') && f !== 'types.ts' && f !== 'lessons.ts');\nfiles.forEach(f => {\n    processLessonFile(path.join(srcDir, f));\n});\n"
  },
  {
    "name": "update_lessons_w3.js",
    "type": "file",
    "path": "update_lessons_w3.js",
    "language": "javascript",
    "content": "const fs = require('fs');\nconst path = require('path');\n\nconst dataDir = path.join(__dirname, 'frontend/src/data');\nconst illustrationsDir = path.join(__dirname, 'frontend/public/illustrations');\n\n// Mapping of title keywords to the illustration type\nconst mapping = {\n    'Hook': 'w3_react_hooks_flow',\n    '状态管理': 'w3_react_hooks_flow',\n    'Zustand': 'w3_react_hooks_flow',\n    'SSG': 'w3_nextjs_ssr_arch',\n    'SSR': 'w3_nextjs_ssr_arch',\n    'Spring Boot 3.5.9': 'w3_springboot_arch',\n    'Kafka': 'w3_kafka_events',\n    'Redis': 'w3_redis_cache',\n    'Testing Library': 'w3_react_testing',\n    'JWT': 'w3_jwt_auth',\n    'Ingress': 'w3_k8s_ingress',\n    '性能优化': 'w3_react_optimizations',\n    'GraphQL': 'w3_graphql',\n    'Saga': 'w3_microservices_saga'\n};\n\n// 1. Get exact file names\nconst exactFiles = fs.readdirSync(illustrationsDir).filter(f => f.startsWith('w3_') && f.endsWith('.png'));\nconst typeToFilename = {};\nfor (const f of exactFiles) {\n    // Extract base type e.g., \"w3_graphql\" from \"w3_graphql_1771635760642.png\"\n    const match = f.match(/^(w3_.+?)_\\d+\\.png$/);\n    if (match) {\n        typeToFilename[match[1]] = `/illustrations/${f}`;\n    }\n}\n\n// 2. Process all data files\nconst files = fs.readdirSync(dataDir).filter(f => f.endsWith('.ts') && f !== 'types.ts' && f !== 'lessons.ts');\n\nfiles.forEach(file => {\n    let filePath = path.join(dataDir, file);\n    let content = fs.readFileSync(filePath, 'utf-8');\n\n    // Simple regex to find title and illustrationUrl in the same object block\n    // We split by object blocks '{ ... }'\n    let updatedContent = content;\n\n    // Process each object block that has a title\n    let match;\n    const titleRegex = /title:\\s*['\"](.*?)['\"]/g;\n    while ((match = titleRegex.exec(content)) !== null) {\n        const title = match[1];\n\n        let foundType = null;\n        for (const [keyword, type] of Object.entries(mapping)) {\n            if (title.includes(keyword)) {\n                foundType = type;\n                break;\n            }\n        }\n\n        if (foundType && typeToFilename[foundType]) {\n            const exactUrl = typeToFilename[foundType];\n\n            // Time to regex replace the illustrationUrl block just for this item\n            // This is tricky, a safer way is to match the exact title and replace the illustrationUrl nearest to it.\n            // But since our files are small, we can just replace all illustrationUrls that come immediately after this title.\n            // Actually, we can just search for the title and the next `illustrationUrl: '...',`\n\n            // Regex to find title followed by anything up to illustrationUrl\n            // Use positive lookbehind if possible or just replace the specific section\n\n            const regexStr = `(title:\\\\s*['\"]${title.replace(/[.*+?^$\\{\\}()|[\\]\\\\]/g, '\\\\$&')}['\"],(?:[\\\\s\\\\S]*?))illustrationUrl:\\\\s*['\"][^'\"]+['\"]`;\n            const blockRegex = new RegExp(regexStr, '');\n\n            updatedContent = updatedContent.replace(blockRegex, `$1illustrationUrl: '${exactUrl}'`);\n        }\n    }\n\n    fs.writeFileSync(filePath, updatedContent, 'utf-8');\n});\n\nconsole.log('Update complete!');\n"
  }
]